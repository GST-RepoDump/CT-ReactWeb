{"ast":null,"code":"(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() : typeof define === 'function' && define.amd ? define(factory) : (global = typeof globalThis !== 'undefined' ? globalThis : global || self, global.clevertap = factory());\n})(this, function () {\n  'use strict';\n\n  function _typeof(obj) {\n    \"@babel/helpers - typeof\";\n\n    if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") {\n      _typeof = function (obj) {\n        return typeof obj;\n      };\n    } else {\n      _typeof = function (obj) {\n        return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n      };\n    }\n\n    return _typeof(obj);\n  }\n\n  function _classCallCheck(instance, Constructor) {\n    if (!(instance instanceof Constructor)) {\n      throw new TypeError(\"Cannot call a class as a function\");\n    }\n  }\n\n  function _defineProperties(target, props) {\n    for (var i = 0; i < props.length; i++) {\n      var descriptor = props[i];\n      descriptor.enumerable = descriptor.enumerable || false;\n      descriptor.configurable = true;\n      if (\"value\" in descriptor) descriptor.writable = true;\n      Object.defineProperty(target, descriptor.key, descriptor);\n    }\n  }\n\n  function _createClass(Constructor, protoProps, staticProps) {\n    if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n    if (staticProps) _defineProperties(Constructor, staticProps);\n    return Constructor;\n  }\n\n  function _defineProperty(obj, key, value) {\n    if (key in obj) {\n      Object.defineProperty(obj, key, {\n        value: value,\n        enumerable: true,\n        configurable: true,\n        writable: true\n      });\n    } else {\n      obj[key] = value;\n    }\n\n    return obj;\n  }\n\n  function ownKeys(object, enumerableOnly) {\n    var keys = Object.keys(object);\n\n    if (Object.getOwnPropertySymbols) {\n      var symbols = Object.getOwnPropertySymbols(object);\n      if (enumerableOnly) symbols = symbols.filter(function (sym) {\n        return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n      });\n      keys.push.apply(keys, symbols);\n    }\n\n    return keys;\n  }\n\n  function _objectSpread2(target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i] != null ? arguments[i] : {};\n\n      if (i % 2) {\n        ownKeys(Object(source), true).forEach(function (key) {\n          _defineProperty(target, key, source[key]);\n        });\n      } else if (Object.getOwnPropertyDescriptors) {\n        Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n      } else {\n        ownKeys(Object(source)).forEach(function (key) {\n          Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n        });\n      }\n    }\n\n    return target;\n  }\n\n  function _inherits(subClass, superClass) {\n    if (typeof superClass !== \"function\" && superClass !== null) {\n      throw new TypeError(\"Super expression must either be null or a function\");\n    }\n\n    subClass.prototype = Object.create(superClass && superClass.prototype, {\n      constructor: {\n        value: subClass,\n        writable: true,\n        configurable: true\n      }\n    });\n    if (superClass) _setPrototypeOf(subClass, superClass);\n  }\n\n  function _getPrototypeOf(o) {\n    _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n      return o.__proto__ || Object.getPrototypeOf(o);\n    };\n    return _getPrototypeOf(o);\n  }\n\n  function _setPrototypeOf(o, p) {\n    _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n      o.__proto__ = p;\n      return o;\n    };\n\n    return _setPrototypeOf(o, p);\n  }\n\n  function _isNativeReflectConstruct() {\n    if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n    if (Reflect.construct.sham) return false;\n    if (typeof Proxy === \"function\") return true;\n\n    try {\n      Date.prototype.toString.call(Reflect.construct(Date, [], function () {}));\n      return true;\n    } catch (e) {\n      return false;\n    }\n  }\n\n  function _construct(Parent, args, Class) {\n    if (_isNativeReflectConstruct()) {\n      _construct = Reflect.construct;\n    } else {\n      _construct = function _construct(Parent, args, Class) {\n        var a = [null];\n        a.push.apply(a, args);\n        var Constructor = Function.bind.apply(Parent, a);\n        var instance = new Constructor();\n        if (Class) _setPrototypeOf(instance, Class.prototype);\n        return instance;\n      };\n    }\n\n    return _construct.apply(null, arguments);\n  }\n\n  function _isNativeFunction(fn) {\n    return Function.toString.call(fn).indexOf(\"[native code]\") !== -1;\n  }\n\n  function _wrapNativeSuper(Class) {\n    var _cache = typeof Map === \"function\" ? new Map() : undefined;\n\n    _wrapNativeSuper = function _wrapNativeSuper(Class) {\n      if (Class === null || !_isNativeFunction(Class)) return Class;\n\n      if (typeof Class !== \"function\") {\n        throw new TypeError(\"Super expression must either be null or a function\");\n      }\n\n      if (typeof _cache !== \"undefined\") {\n        if (_cache.has(Class)) return _cache.get(Class);\n\n        _cache.set(Class, Wrapper);\n      }\n\n      function Wrapper() {\n        return _construct(Class, arguments, _getPrototypeOf(this).constructor);\n      }\n\n      Wrapper.prototype = Object.create(Class.prototype, {\n        constructor: {\n          value: Wrapper,\n          enumerable: false,\n          writable: true,\n          configurable: true\n        }\n      });\n      return _setPrototypeOf(Wrapper, Class);\n    };\n\n    return _wrapNativeSuper(Class);\n  }\n\n  function _assertThisInitialized(self) {\n    if (self === void 0) {\n      throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n    }\n\n    return self;\n  }\n\n  function _possibleConstructorReturn(self, call) {\n    if (call && (typeof call === \"object\" || typeof call === \"function\")) {\n      return call;\n    }\n\n    return _assertThisInitialized(self);\n  }\n\n  function _createSuper(Derived) {\n    var hasNativeReflectConstruct = _isNativeReflectConstruct();\n\n    return function _createSuperInternal() {\n      var Super = _getPrototypeOf(Derived),\n          result;\n\n      if (hasNativeReflectConstruct) {\n        var NewTarget = _getPrototypeOf(this).constructor;\n\n        result = Reflect.construct(Super, arguments, NewTarget);\n      } else {\n        result = Super.apply(this, arguments);\n      }\n\n      return _possibleConstructorReturn(this, result);\n    };\n  }\n\n  function _unsupportedIterableToArray(o, minLen) {\n    if (!o) return;\n    if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n    var n = Object.prototype.toString.call(o).slice(8, -1);\n    if (n === \"Object\" && o.constructor) n = o.constructor.name;\n    if (n === \"Map\" || n === \"Set\") return Array.from(o);\n    if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n  }\n\n  function _arrayLikeToArray(arr, len) {\n    if (len == null || len > arr.length) len = arr.length;\n\n    for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];\n\n    return arr2;\n  }\n\n  function _createForOfIteratorHelper(o, allowArrayLike) {\n    var it;\n\n    if (typeof Symbol === \"undefined\" || o[Symbol.iterator] == null) {\n      if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") {\n        if (it) o = it;\n        var i = 0;\n\n        var F = function () {};\n\n        return {\n          s: F,\n          n: function () {\n            if (i >= o.length) return {\n              done: true\n            };\n            return {\n              done: false,\n              value: o[i++]\n            };\n          },\n          e: function (e) {\n            throw e;\n          },\n          f: F\n        };\n      }\n\n      throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n    }\n\n    var normalCompletion = true,\n        didErr = false,\n        err;\n    return {\n      s: function () {\n        it = o[Symbol.iterator]();\n      },\n      n: function () {\n        var step = it.next();\n        normalCompletion = step.done;\n        return step;\n      },\n      e: function (e) {\n        didErr = true;\n        err = e;\n      },\n      f: function () {\n        try {\n          if (!normalCompletion && it.return != null) it.return();\n        } finally {\n          if (didErr) throw err;\n        }\n      }\n    };\n  }\n\n  var id = 0;\n\n  function _classPrivateFieldLooseKey(name) {\n    return \"__private_\" + id++ + \"_\" + name;\n  }\n\n  function _classPrivateFieldLooseBase(receiver, privateKey) {\n    if (!Object.prototype.hasOwnProperty.call(receiver, privateKey)) {\n      throw new TypeError(\"attempted to use private field on non-instance\");\n    }\n\n    return receiver;\n  }\n\n  var TARGET_DOMAIN = 'clevertap-prod.com';\n  var TARGET_PROTOCOL = 'https:';\n  var DEFAULT_REGION = 'eu1';\n\n  var _accountId = _classPrivateFieldLooseKey(\"accountId\");\n\n  var _region = _classPrivateFieldLooseKey(\"region\");\n\n  var _targetDomain = _classPrivateFieldLooseKey(\"targetDomain\");\n\n  var Account = /*#__PURE__*/function () {\n    function Account() {\n      var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n          id = _ref.id;\n\n      var region = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';\n      var targetDomain = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : TARGET_DOMAIN;\n\n      _classCallCheck(this, Account);\n\n      Object.defineProperty(this, _accountId, {\n        writable: true,\n        value: void 0\n      });\n      Object.defineProperty(this, _region, {\n        writable: true,\n        value: ''\n      });\n      Object.defineProperty(this, _targetDomain, {\n        writable: true,\n        value: TARGET_DOMAIN\n      });\n      this.id = id;\n\n      if (region) {\n        this.region = region;\n      }\n\n      if (targetDomain) {\n        this.targetDomain = targetDomain;\n      }\n    }\n\n    _createClass(Account, [{\n      key: \"id\",\n      get: function get() {\n        return _classPrivateFieldLooseBase(this, _accountId)[_accountId];\n      },\n      set: function set(accountId) {\n        _classPrivateFieldLooseBase(this, _accountId)[_accountId] = accountId;\n      }\n    }, {\n      key: \"region\",\n      get: function get() {\n        return _classPrivateFieldLooseBase(this, _region)[_region];\n      },\n      set: function set(region) {\n        _classPrivateFieldLooseBase(this, _region)[_region] = region;\n      }\n    }, {\n      key: \"targetDomain\",\n      get: function get() {\n        return _classPrivateFieldLooseBase(this, _targetDomain)[_targetDomain];\n      },\n      set: function set(targetDomain) {\n        _classPrivateFieldLooseBase(this, _targetDomain)[_targetDomain] = targetDomain;\n      }\n    }, {\n      key: \"finalTargetDomain\",\n      get: function get() {\n        if (this.region) {\n          return \"\".concat(this.region, \".\").concat(this.targetDomain);\n        } else {\n          if (this.targetDomain === TARGET_DOMAIN) {\n            return \"\".concat(DEFAULT_REGION, \".\").concat(this.targetDomain);\n          }\n\n          return this.targetDomain;\n        }\n      }\n    }, {\n      key: \"dataPostURL\",\n      get: function get() {\n        return \"\".concat(TARGET_PROTOCOL, \"//\").concat(this.finalTargetDomain, \"/a?t=96\");\n      }\n    }, {\n      key: \"recorderURL\",\n      get: function get() {\n        return \"\".concat(TARGET_PROTOCOL, \"//\").concat(this.finalTargetDomain, \"/r?r=1\");\n      }\n    }, {\n      key: \"emailURL\",\n      get: function get() {\n        return \"\".concat(TARGET_PROTOCOL, \"//\").concat(this.finalTargetDomain, \"/e?r=1\");\n      }\n    }]);\n\n    return Account;\n  }();\n\n  var unsupportedKeyCharRegex = new RegExp('^\\\\s+|\\\\\\.|\\:|\\\\\\$|\\'|\\\"|\\\\\\\\|\\\\s+$', 'g');\n  var unsupportedValueCharRegex = new RegExp(\"^\\\\s+|\\'|\\\"|\\\\\\\\|\\\\s+$\", 'g');\n  var singleQuoteRegex = new RegExp('\\'', 'g');\n  var CLEAR = 'clear';\n  var CHARGED_ID = 'Charged ID';\n  var CHARGEDID_COOKIE_NAME = 'WZRK_CHARGED_ID';\n  var GCOOKIE_NAME = 'WZRK_G';\n  var KCOOKIE_NAME = 'WZRK_K';\n  var CAMP_COOKIE_NAME = 'WZRK_CAMP';\n  var SCOOKIE_PREFIX = 'WZRK_S';\n  var SCOOKIE_EXP_TIME_IN_SECS = 60 * 20; // 20 mins\n\n  var EV_COOKIE = 'WZRK_EV';\n  var META_COOKIE = 'WZRK_META';\n  var PR_COOKIE = 'WZRK_PR';\n  var ARP_COOKIE = 'WZRK_ARP';\n  var LCOOKIE_NAME = 'WZRK_L';\n  var GLOBAL = 'global';\n  var DISPLAY = 'display';\n  var WEBPUSH_LS_KEY = 'WZRK_WPR';\n  var OPTOUT_KEY = 'optOut';\n  var CT_OPTOUT_KEY = 'ct_optout';\n  var OPTOUT_COOKIE_ENDSWITH = ':OO';\n  var USEIP_KEY = 'useIP';\n  var LRU_CACHE = 'WZRK_X';\n  var LRU_CACHE_SIZE = 100;\n  var IS_OUL = 'isOUL';\n  var EVT_PUSH = 'push';\n  var EVT_PING = 'ping';\n  var COOKIE_EXPIRY = 86400 * 365 * 10; // 10 Years in seconds\n\n  var MAX_TRIES = 50; // API tries\n\n  var FIRST_PING_FREQ_IN_MILLIS = 2 * 60 * 1000; // 2 mins\n\n  var CONTINUOUS_PING_FREQ_IN_MILLIS = 5 * 60 * 1000; // 5 mins\n\n  var GROUP_SUBSCRIPTION_REQUEST_ID = '2';\n  var categoryLongKey = 'cUsY';\n  var WZRK_PREFIX = 'wzrk_';\n  var WZRK_ID = 'wzrk_id';\n  var NOTIFICATION_VIEWED = 'Notification Viewed';\n  var NOTIFICATION_CLICKED = 'Notification Clicked';\n  var FIRE_PUSH_UNREGISTERED = 'WZRK_FPU';\n  var PUSH_SUBSCRIPTION_DATA = 'WZRK_PSD'; // PUSH SUBSCRIPTION DATA FOR REGISTER/UNREGISTER TOKEN\n\n  var SYSTEM_EVENTS = ['Stayed', 'UTM Visited', 'App Launched', 'Notification Sent', NOTIFICATION_VIEWED, NOTIFICATION_CLICKED];\n\n  var isString = function isString(input) {\n    return typeof input === 'string' || input instanceof String;\n  };\n\n  var isObject = function isObject(input) {\n    // TODO: refine\n    return Object.prototype.toString.call(input) === '[object Object]';\n  };\n\n  var isDateObject = function isDateObject(input) {\n    return _typeof(input) === 'object' && input instanceof Date;\n  };\n\n  var isObjectEmpty = function isObjectEmpty(obj) {\n    for (var prop in obj) {\n      if (obj.hasOwnProperty(prop)) {\n        return false;\n      }\n    }\n\n    return true;\n  };\n\n  var isConvertibleToNumber = function isConvertibleToNumber(n) {\n    return !isNaN(parseFloat(n)) && isFinite(n);\n  };\n\n  var isNumber = function isNumber(n) {\n    return /^-?[\\d.]+(?:e-?\\d+)?$/.test(n) && typeof n === 'number';\n  };\n\n  var isValueValid = function isValueValid(value) {\n    if (value === null || value === undefined || value === 'undefined') {\n      return false;\n    }\n\n    return true;\n  };\n\n  var removeUnsupportedChars = function removeUnsupportedChars(o, logger) {\n    // keys can't be greater than 1024 chars, values can't be greater than 1024 chars\n    if (_typeof(o) === 'object') {\n      for (var key in o) {\n        if (o.hasOwnProperty(key)) {\n          var sanitizedVal = removeUnsupportedChars(o[key], logger);\n          var sanitizedKey = void 0;\n          sanitizedKey = sanitize(key, unsupportedKeyCharRegex);\n\n          if (sanitizedKey.length > 1024) {\n            sanitizedKey = sanitizedKey.substring(0, 1024);\n            logger.reportError(520, sanitizedKey + '... length exceeded 1024 chars. Trimmed.');\n          }\n\n          delete o[key];\n          o[sanitizedKey] = sanitizedVal;\n        }\n      }\n    } else {\n      var val;\n\n      if (isString(o)) {\n        val = sanitize(o, unsupportedValueCharRegex);\n\n        if (val.length > 1024) {\n          val = val.substring(0, 1024);\n          logger.reportError(521, val + '... length exceeded 1024 chars. Trimmed.');\n        }\n      } else {\n        val = o;\n      }\n\n      return val;\n    }\n\n    return o;\n  };\n\n  var sanitize = function sanitize(input, regex) {\n    return input.replace(regex, '');\n  };\n\n  var getToday = function getToday() {\n    var today = new Date();\n    return today.getFullYear() + '' + today.getMonth() + '' + today.getDay();\n  };\n\n  var getNow = function getNow() {\n    return Math.floor(new Date().getTime() / 1000);\n  };\n\n  var convertToWZRKDate = function convertToWZRKDate(dateObj) {\n    return '$D_' + Math.round(dateObj.getTime() / 1000);\n  };\n\n  var setDate = function setDate(dt) {\n    // expecting  yyyymmdd format either as a number or a string\n    if (isDateValid(dt)) {\n      return '$D_' + dt;\n    }\n  };\n\n  var isDateValid = function isDateValid(date) {\n    var matches = /^(\\d{4})(\\d{2})(\\d{2})$/.exec(date);\n    if (matches == null) return false;\n    var d = matches[3];\n    var m = matches[2] - 1;\n    var y = matches[1];\n    var composedDate = new Date(y, m, d); // eslint-disable-next-line eqeqeq\n\n    return composedDate.getDate() == d && composedDate.getMonth() == m && composedDate.getFullYear() == y;\n  };\n\n  var StorageManager$1 = /*#__PURE__*/function () {\n    function StorageManager() {\n      _classCallCheck(this, StorageManager);\n    }\n\n    _createClass(StorageManager, null, [{\n      key: \"save\",\n      value: function save(key, value) {\n        if (!key || !value) {\n          return false;\n        }\n\n        if (this._isLocalStorageSupported()) {\n          localStorage.setItem(key, typeof value === 'string' ? value : JSON.stringify(value));\n          return true;\n        }\n      }\n    }, {\n      key: \"read\",\n      value: function read(key) {\n        if (!key) {\n          return false;\n        }\n\n        var data = null;\n\n        if (this._isLocalStorageSupported()) {\n          data = localStorage.getItem(key);\n        }\n\n        if (data != null) {\n          try {\n            data = JSON.parse(data);\n          } catch (e) {}\n        }\n\n        return data;\n      }\n    }, {\n      key: \"remove\",\n      value: function remove(key) {\n        if (!key) {\n          return false;\n        }\n\n        if (this._isLocalStorageSupported()) {\n          localStorage.removeItem(key);\n          return true;\n        }\n      }\n    }, {\n      key: \"removeCookie\",\n      value: function removeCookie(name, domain) {\n        var cookieStr = name + '=; expires=Thu, 01 Jan 1970 00:00:01 GMT;';\n\n        if (domain) {\n          cookieStr = cookieStr + ' domain=' + domain + '; path=/';\n        }\n\n        document.cookie = cookieStr;\n      }\n    }, {\n      key: \"createCookie\",\n      value: function createCookie(name, value, seconds, domain) {\n        var expires = '';\n        var domainStr = '';\n\n        if (seconds) {\n          var date = new Date();\n          date.setTime(date.getTime() + seconds * 1000);\n          expires = '; expires=' + date.toGMTString();\n        }\n\n        if (domain) {\n          domainStr = '; domain=' + domain;\n        }\n\n        value = encodeURIComponent(value);\n        document.cookie = name + '=' + value + expires + domainStr + '; path=/';\n      }\n    }, {\n      key: \"readCookie\",\n      value: function readCookie(name) {\n        var nameEQ = name + '=';\n        var ca = document.cookie.split(';');\n\n        for (var idx = 0; idx < ca.length; idx++) {\n          var c = ca[idx];\n\n          while (c.charAt(0) === ' ') {\n            c = c.substring(1, c.length);\n          } // eslint-disable-next-line eqeqeq\n\n\n          if (c.indexOf(nameEQ) == 0) {\n            return decodeURIComponent(c.substring(nameEQ.length, c.length));\n          }\n        }\n\n        return null;\n      }\n    }, {\n      key: \"_isLocalStorageSupported\",\n      value: function _isLocalStorageSupported() {\n        return 'localStorage' in window && window.localStorage !== null && typeof window.localStorage.setItem === 'function';\n      }\n    }, {\n      key: \"saveToLSorCookie\",\n      value: function saveToLSorCookie(property, value) {\n        if (value == null) {\n          return;\n        }\n\n        try {\n          if (this._isLocalStorageSupported()) {\n            this.save(property, encodeURIComponent(JSON.stringify(value)));\n          } else {\n            if (property === GCOOKIE_NAME) {\n              this.createCookie(property, encodeURIComponent(value), 0, window.location.hostname);\n            } else {\n              this.createCookie(property, encodeURIComponent(JSON.stringify(value)), 0, window.location.hostname);\n            }\n          }\n\n          $ct.globalCache[property] = value;\n        } catch (e) {}\n      }\n    }, {\n      key: \"readFromLSorCookie\",\n      value: function readFromLSorCookie(property) {\n        var data;\n\n        if ($ct.globalCache.hasOwnProperty(property)) {\n          return $ct.globalCache[property];\n        }\n\n        if (this._isLocalStorageSupported()) {\n          data = this.read(property);\n        } else {\n          data = this.readCookie(property);\n        }\n\n        if (data !== null && data !== undefined && !(typeof data.trim === 'function' && data.trim() === '')) {\n          var value;\n\n          try {\n            value = JSON.parse(decodeURIComponent(data));\n          } catch (err) {\n            value = decodeURIComponent(data);\n          }\n\n          $ct.globalCache[property] = value;\n          return value;\n        }\n      }\n    }, {\n      key: \"createBroadCookie\",\n      value: function createBroadCookie(name, value, seconds, domain) {\n        // sets cookie on the base domain. e.g. if domain is baz.foo.bar.com, set cookie on \".bar.com\"\n        // To update an existing \"broad domain\" cookie, we need to know what domain it was actually set on.\n        // since a retrieved cookie never tells which domain it was set on, we need to set another test cookie\n        // to find out which \"broadest\" domain the cookie was set on. Then delete the test cookie, and use that domain\n        // for updating the actual cookie.\n        if (domain) {\n          var broadDomain = $ct.broadDomain;\n\n          if (broadDomain == null) {\n            // if we don't know the broadDomain yet, then find out\n            var domainParts = domain.split('.');\n            var testBroadDomain = '';\n\n            for (var idx = domainParts.length - 1; idx >= 0; idx--) {\n              if (idx === 0) {\n                testBroadDomain = domainParts[idx] + testBroadDomain;\n              } else {\n                testBroadDomain = '.' + domainParts[idx] + testBroadDomain;\n              } // only needed if the cookie already exists and needs to be updated. See note above.\n\n\n              if (this.readCookie(name)) {\n                // no guarantee that browser will delete cookie, hence create short lived cookies\n                var testCookieName = 'test_' + name + idx;\n                this.createCookie(testCookieName, value, 10, testBroadDomain); // self-destruct after 10 seconds\n\n                if (!this.readCookie(testCookieName)) {\n                  // if test cookie not set, then the actual cookie wouldn't have been set on this domain either.\n                  continue;\n                } else {\n                  // else if cookie set, then delete the test and the original cookie\n                  this.removeCookie(testCookieName, testBroadDomain);\n                }\n              }\n\n              this.createCookie(name, value, seconds, testBroadDomain);\n              var tempCookie = this.readCookie(name); // eslint-disable-next-line eqeqeq\n\n              if (tempCookie == value) {\n                broadDomain = testBroadDomain;\n                $ct.broadDomain = broadDomain;\n                break;\n              }\n            }\n          } else {\n            this.createCookie(name, value, seconds, broadDomain);\n          }\n        } else {\n          this.createCookie(name, value, seconds, domain);\n        }\n      }\n    }, {\n      key: \"getMetaProp\",\n      value: function getMetaProp(property) {\n        var metaObj = this.readFromLSorCookie(META_COOKIE);\n\n        if (metaObj != null) {\n          return metaObj[property];\n        }\n      }\n    }, {\n      key: \"setMetaProp\",\n      value: function setMetaProp(property, value) {\n        if (this._isLocalStorageSupported()) {\n          var wzrkMetaObj = this.readFromLSorCookie(META_COOKIE);\n\n          if (wzrkMetaObj == null) {\n            wzrkMetaObj = {};\n          }\n\n          if (value === undefined) {\n            delete wzrkMetaObj[property];\n          } else {\n            wzrkMetaObj[property] = value;\n          }\n\n          this.saveToLSorCookie(META_COOKIE, wzrkMetaObj);\n        }\n      }\n    }, {\n      key: \"getAndClearMetaProp\",\n      value: function getAndClearMetaProp(property) {\n        var value = this.getMetaProp(property);\n        this.setMetaProp(property, undefined);\n        return value;\n      }\n    }, {\n      key: \"setInstantDeleteFlagInK\",\n      value: function setInstantDeleteFlagInK() {\n        var k = this.readFromLSorCookie(KCOOKIE_NAME);\n\n        if (k == null) {\n          k = {};\n        }\n\n        k.flag = true;\n        this.saveToLSorCookie(KCOOKIE_NAME, k);\n      }\n    }, {\n      key: \"backupEvent\",\n      value: function backupEvent(data, reqNo, logger) {\n        var backupArr = this.readFromLSorCookie(LCOOKIE_NAME);\n\n        if (typeof backupArr === 'undefined') {\n          backupArr = {};\n        }\n\n        backupArr[reqNo] = {\n          q: data\n        };\n        this.saveToLSorCookie(LCOOKIE_NAME, backupArr);\n        logger.debug(\"stored in \".concat(LCOOKIE_NAME, \" reqNo : \").concat(reqNo, \" -> \").concat(data));\n      }\n    }, {\n      key: \"removeBackup\",\n      value: function removeBackup(respNo, logger) {\n        var backupMap = this.readFromLSorCookie(LCOOKIE_NAME);\n\n        if (typeof backupMap !== 'undefined' && backupMap !== null && typeof backupMap[respNo] !== 'undefined') {\n          logger.debug(\"del event: \".concat(respNo, \" data-> \").concat(backupMap[respNo].q));\n          delete backupMap[respNo];\n          this.saveToLSorCookie(LCOOKIE_NAME, backupMap);\n        }\n      }\n    }]);\n\n    return StorageManager;\n  }();\n\n  var $ct = {\n    globalCache: {\n      gcookie: null,\n      REQ_N: 0,\n      RESP_N: 0\n    },\n    LRU_cache: null,\n    globalProfileMap: undefined,\n    globalEventsMap: undefined,\n    blockRequest: false,\n    isOptInRequest: false,\n    broadDomain: null,\n    webPushEnabled: null,\n    campaignDivMap: {},\n    currentSessionId: null,\n    wiz_counter: 0,\n    // to keep track of number of times we load the body\n    notifApi: {\n      notifEnabledFromApi: false\n    },\n    // helper variable to handle race condition and check when notifications were called\n    unsubGroups: [],\n    updatedCategoryLong: null // domain: window.location.hostname, url -> getHostName()\n    // gcookie: -> device\n\n  };\n\n  var _keyOrder = _classPrivateFieldLooseKey(\"keyOrder\");\n\n  var _deleteFromObject = _classPrivateFieldLooseKey(\"deleteFromObject\");\n\n  var LRUCache = /*#__PURE__*/function () {\n    function LRUCache(max) {\n      _classCallCheck(this, LRUCache);\n\n      Object.defineProperty(this, _deleteFromObject, {\n        value: _deleteFromObject2\n      });\n      Object.defineProperty(this, _keyOrder, {\n        writable: true,\n        value: void 0\n      });\n      this.max = max;\n      var lruCache = StorageManager$1.readFromLSorCookie(LRU_CACHE);\n\n      if (lruCache) {\n        var tempLruCache = {};\n        _classPrivateFieldLooseBase(this, _keyOrder)[_keyOrder] = [];\n        lruCache = lruCache.cache;\n\n        for (var entry in lruCache) {\n          if (lruCache.hasOwnProperty(entry)) {\n            tempLruCache[lruCache[entry][0]] = lruCache[entry][1];\n\n            _classPrivateFieldLooseBase(this, _keyOrder)[_keyOrder].push(lruCache[entry][0]);\n          }\n        }\n\n        this.cache = tempLruCache;\n      } else {\n        this.cache = {};\n        _classPrivateFieldLooseBase(this, _keyOrder)[_keyOrder] = [];\n      }\n    }\n\n    _createClass(LRUCache, [{\n      key: \"get\",\n      value: function get(key) {\n        var item = this.cache[key];\n\n        if (item) {\n          this.cache = _classPrivateFieldLooseBase(this, _deleteFromObject)[_deleteFromObject](key, this.cache);\n          this.cache[key] = item;\n\n          _classPrivateFieldLooseBase(this, _keyOrder)[_keyOrder].push(key);\n        }\n\n        this.saveCacheToLS(this.cache);\n        return item;\n      }\n    }, {\n      key: \"set\",\n      value: function set(key, value) {\n        var item = this.cache[key];\n\n        var allKeys = _classPrivateFieldLooseBase(this, _keyOrder)[_keyOrder];\n\n        if (item != null) {\n          this.cache = _classPrivateFieldLooseBase(this, _deleteFromObject)[_deleteFromObject](key, this.cache);\n        } else if (allKeys.length === this.max) {\n          this.cache = _classPrivateFieldLooseBase(this, _deleteFromObject)[_deleteFromObject](allKeys[0], this.cache);\n        }\n\n        this.cache[key] = value;\n\n        if (_classPrivateFieldLooseBase(this, _keyOrder)[_keyOrder][_classPrivateFieldLooseBase(this, _keyOrder)[_keyOrder] - 1] !== key) {\n          _classPrivateFieldLooseBase(this, _keyOrder)[_keyOrder].push(key);\n        }\n\n        this.saveCacheToLS(this.cache);\n      }\n    }, {\n      key: \"saveCacheToLS\",\n      value: function saveCacheToLS(cache) {\n        var objToArray = [];\n\n        var allKeys = _classPrivateFieldLooseBase(this, _keyOrder)[_keyOrder];\n\n        for (var index in allKeys) {\n          if (allKeys.hasOwnProperty(index)) {\n            var temp = [];\n            temp.push(allKeys[index]);\n            temp.push(cache[allKeys[index]]);\n            objToArray.push(temp);\n          }\n        }\n\n        StorageManager$1.saveToLSorCookie(LRU_CACHE, {\n          cache: objToArray\n        });\n      }\n    }, {\n      key: \"getKey\",\n      value: function getKey(value) {\n        if (value === null) {\n          return null;\n        }\n\n        var allKeys = _classPrivateFieldLooseBase(this, _keyOrder)[_keyOrder];\n\n        for (var index in allKeys) {\n          if (allKeys.hasOwnProperty(index)) {\n            if (this.cache[allKeys[index]] === value) {\n              return allKeys[index];\n            }\n          }\n        }\n\n        return null;\n      }\n    }, {\n      key: \"getSecondLastKey\",\n      value: function getSecondLastKey() {\n        var keysArr = _classPrivateFieldLooseBase(this, _keyOrder)[_keyOrder];\n\n        if (keysArr != null && keysArr.length > 1) {\n          return keysArr[keysArr.length - 2];\n        }\n\n        return -1;\n      }\n    }, {\n      key: \"getLastKey\",\n      value: function getLastKey() {\n        var keysLength = _classPrivateFieldLooseBase(this, _keyOrder)[_keyOrder].length;\n\n        if (keysLength) {\n          return _classPrivateFieldLooseBase(this, _keyOrder)[_keyOrder][keysLength - 1];\n        }\n      }\n    }]);\n\n    return LRUCache;\n  }();\n\n  var _deleteFromObject2 = function _deleteFromObject2(key, obj) {\n    var allKeys = JSON.parse(JSON.stringify(_classPrivateFieldLooseBase(this, _keyOrder)[_keyOrder]));\n    var newCache = {};\n    var indexToDelete;\n\n    for (var index in allKeys) {\n      if (allKeys.hasOwnProperty(index)) {\n        if (allKeys[index] !== key) {\n          newCache[allKeys[index]] = obj[allKeys[index]];\n        } else {\n          indexToDelete = index;\n        }\n      }\n    }\n\n    allKeys.splice(indexToDelete, 1);\n    _classPrivateFieldLooseBase(this, _keyOrder)[_keyOrder] = JSON.parse(JSON.stringify(allKeys));\n    return newCache;\n  };\n\n  var _logger = _classPrivateFieldLooseKey(\"logger\");\n\n  var _request = _classPrivateFieldLooseKey(\"request\");\n\n  var _device = _classPrivateFieldLooseKey(\"device\");\n\n  var _session = _classPrivateFieldLooseKey(\"session\");\n\n  var CleverTapAPI = /*#__PURE__*/function () {\n    function CleverTapAPI(_ref) {\n      var logger = _ref.logger,\n          request = _ref.request,\n          device = _ref.device,\n          session = _ref.session;\n\n      _classCallCheck(this, CleverTapAPI);\n\n      Object.defineProperty(this, _logger, {\n        writable: true,\n        value: void 0\n      });\n      Object.defineProperty(this, _request, {\n        writable: true,\n        value: void 0\n      });\n      Object.defineProperty(this, _device, {\n        writable: true,\n        value: void 0\n      });\n      Object.defineProperty(this, _session, {\n        writable: true,\n        value: void 0\n      });\n      _classPrivateFieldLooseBase(this, _logger)[_logger] = logger;\n      _classPrivateFieldLooseBase(this, _request)[_request] = request;\n      _classPrivateFieldLooseBase(this, _device)[_device] = device;\n      _classPrivateFieldLooseBase(this, _session)[_session] = session;\n    }\n\n    _createClass(CleverTapAPI, [{\n      key: \"s\",\n      value: function s(global, session, resume, respNumber, optOutResponse) {\n        // call back function used to store global and session ids for the user\n        if (typeof respNumber === 'undefined') {\n          respNumber = 0;\n        }\n\n        StorageManager$1.removeBackup(respNumber, _classPrivateFieldLooseBase(this, _logger)[_logger]);\n\n        if (respNumber > $ct.globalCache.REQ_N) {\n          // request for some other user so ignore\n          return;\n        }\n\n        if (!isValueValid(_classPrivateFieldLooseBase(this, _device)[_device].gcookie) || resume || typeof optOutResponse === 'boolean') {\n          if (!isValueValid(_classPrivateFieldLooseBase(this, _device)[_device].gcookie)) {\n            // clear useIP meta prop\n            StorageManager$1.getAndClearMetaProp(USEIP_KEY);\n          }\n\n          _classPrivateFieldLooseBase(this, _logger)[_logger].debug(\"Cookie was \".concat(_classPrivateFieldLooseBase(this, _device)[_device].gcookie, \" set to \").concat(global));\n\n          _classPrivateFieldLooseBase(this, _device)[_device].gcookie = global;\n\n          if (global && StorageManager$1._isLocalStorageSupported()) {\n            if ($ct.LRU_CACHE == null) {\n              $ct.LRU_CACHE = new LRUCache(LRU_CACHE_SIZE);\n            }\n\n            var kIdFromLS = StorageManager$1.readFromLSorCookie(KCOOKIE_NAME);\n\n            if (kIdFromLS != null && kIdFromLS.id && resume) {\n              var guidFromLRUCache = $ct.LRU_CACHE.cache[kIdFromLS.id];\n\n              if (!guidFromLRUCache) {\n                StorageManager$1.saveToLSorCookie(FIRE_PUSH_UNREGISTERED, true);\n                $ct.LRU_CACHE.set(kIdFromLS.id, global);\n              }\n            }\n\n            StorageManager$1.saveToLSorCookie(GCOOKIE_NAME, global);\n            var lastK = $ct.LRU_CACHE.getSecondLastKey();\n\n            if (StorageManager$1.readFromLSorCookie(FIRE_PUSH_UNREGISTERED) && lastK !== -1) {\n              var lastGUID = $ct.LRU_CACHE.cache[lastK];\n\n              _classPrivateFieldLooseBase(this, _request)[_request].unregisterTokenForGuid(lastGUID);\n            }\n          }\n\n          StorageManager$1.createBroadCookie(GCOOKIE_NAME, global, COOKIE_EXPIRY, window.location.hostname);\n          StorageManager$1.saveToLSorCookie(GCOOKIE_NAME, global);\n        }\n\n        if (resume) {\n          $ct.blockRequest = false;\n\n          _classPrivateFieldLooseBase(this, _logger)[_logger].debug('Resumed requests');\n        }\n\n        if (StorageManager$1._isLocalStorageSupported()) {\n          _classPrivateFieldLooseBase(this, _session)[_session].manageSession(session);\n        } // session cookie\n\n\n        var obj = _classPrivateFieldLooseBase(this, _session)[_session].getSessionCookieObject(); // for the race-condition where two responses come back with different session ids. don't write the older session id.\n\n\n        if (typeof obj.s === 'undefined' || obj.s <= session) {\n          obj.s = session;\n          obj.t = getNow(); // time of last response from server\n\n          _classPrivateFieldLooseBase(this, _session)[_session].setSessionCookieObject(obj);\n        }\n\n        if (resume && !_classPrivateFieldLooseBase(this, _request)[_request].processingBackup) {\n          _classPrivateFieldLooseBase(this, _request)[_request].processBackupEvents();\n        }\n\n        $ct.globalCache.RESP_N = respNumber;\n      }\n    }]);\n\n    return CleverTapAPI;\n  }();\n\n  var _logger$1 = _classPrivateFieldLooseKey(\"logger\");\n\n  var DeviceManager = /*#__PURE__*/function () {\n    function DeviceManager(_ref) {\n      var logger = _ref.logger;\n\n      _classCallCheck(this, DeviceManager);\n\n      Object.defineProperty(this, _logger$1, {\n        writable: true,\n        value: void 0\n      });\n      this.gcookie = void 0;\n      _classPrivateFieldLooseBase(this, _logger$1)[_logger$1] = logger;\n      this.gcookie = this.getGuid();\n    }\n\n    _createClass(DeviceManager, [{\n      key: \"getGuid\",\n      value: function getGuid() {\n        var guid = null;\n\n        if (isValueValid(this.gcookie)) {\n          return this.gcookie;\n        }\n\n        if (StorageManager$1._isLocalStorageSupported()) {\n          var value = StorageManager$1.read(GCOOKIE_NAME);\n\n          if (isValueValid(value)) {\n            try {\n              guid = JSON.parse(decodeURIComponent(value));\n            } catch (e) {\n              _classPrivateFieldLooseBase(this, _logger$1)[_logger$1].debug('Cannot parse Gcookie from localstorage - must be encoded ' + value); // assumming guids are of size 32. supporting both formats.\n              // guid can have encodedURIComponent or be without it.\n              // 1.56e4078ed15749928c042479ec2b4d47 - breaks on JSON.parse(decodeURIComponent())\n              // 2.%2256e4078ed15749928c042479ec2b4d47%22\n\n\n              if (value.length === 32) {\n                guid = value;\n                StorageManager$1.saveToLSorCookie(GCOOKIE_NAME, value);\n              } else {\n                _classPrivateFieldLooseBase(this, _logger$1)[_logger$1].error('Illegal guid ' + value);\n              }\n            } // Persist to cookie storage if not present there.\n\n\n            if (isValueValid(guid)) {\n              StorageManager$1.createBroadCookie(GCOOKIE_NAME, guid, COOKIE_EXPIRY, window.location.hostname);\n            }\n          }\n        }\n\n        if (!isValueValid(guid)) {\n          guid = StorageManager$1.readCookie(GCOOKIE_NAME);\n\n          if (isValueValid(guid) && (guid.indexOf('%') === 0 || guid.indexOf('\\'') === 0 || guid.indexOf('\"') === 0)) {\n            guid = null;\n          }\n\n          if (isValueValid(guid)) {\n            StorageManager$1.saveToLSorCookie(GCOOKIE_NAME, guid);\n          }\n        }\n\n        return guid;\n      }\n    }]);\n\n    return DeviceManager;\n  }();\n\n  var DATA_NOT_SENT_TEXT = 'This property has been ignored.';\n  var CLEVERTAP_ERROR_PREFIX = 'CleverTap error:'; // Formerly wzrk_error_txt\n\n  var EMBED_ERROR = \"\".concat(CLEVERTAP_ERROR_PREFIX, \" Incorrect embed script.\");\n  var EVENT_ERROR = \"\".concat(CLEVERTAP_ERROR_PREFIX, \" Event structure not valid. \").concat(DATA_NOT_SENT_TEXT);\n  var GENDER_ERROR = \"\".concat(CLEVERTAP_ERROR_PREFIX, \" Gender value should be either M or F. \").concat(DATA_NOT_SENT_TEXT);\n  var EMPLOYED_ERROR = \"\".concat(CLEVERTAP_ERROR_PREFIX, \" Employed value should be either Y or N. \").concat(DATA_NOT_SENT_TEXT);\n  var MARRIED_ERROR = \"\".concat(CLEVERTAP_ERROR_PREFIX, \" Married value should be either Y or N. \").concat(DATA_NOT_SENT_TEXT);\n  var EDUCATION_ERROR = \"\".concat(CLEVERTAP_ERROR_PREFIX, \" Education value should be either School, College or Graduate. \").concat(DATA_NOT_SENT_TEXT);\n  var AGE_ERROR = \"\".concat(CLEVERTAP_ERROR_PREFIX, \" Age value should be a number. \").concat(DATA_NOT_SENT_TEXT);\n  var DOB_ERROR = \"\".concat(CLEVERTAP_ERROR_PREFIX, \" DOB value should be a Date Object\");\n  var ENUM_FORMAT_ERROR = \"\".concat(CLEVERTAP_ERROR_PREFIX, \" setEnum(value). value should be a string or a number\");\n  var PHONE_FORMAT_ERROR = \"\".concat(CLEVERTAP_ERROR_PREFIX, \" Phone number should be formatted as +[country code][number]\");\n\n  var _globalChargedId;\n\n  var isEventStructureFlat = function isEventStructureFlat(eventObj) {\n    // Events cannot have nested structure or Arrays\n    if (isObject(eventObj)) {\n      for (var key in eventObj) {\n        if (eventObj.hasOwnProperty(key)) {\n          if (isObject(eventObj[key]) || Array.isArray(eventObj[key])) {\n            return false;\n          } else if (isDateObject(eventObj[key])) {\n            eventObj[key] = convertToWZRKDate(eventObj[key]);\n          }\n        }\n      }\n\n      return true;\n    }\n\n    return false;\n  };\n\n  var isChargedEventStructureValid = function isChargedEventStructureValid(chargedObj, logger) {\n    if (isObject(chargedObj)) {\n      for (var key in chargedObj) {\n        if (chargedObj.hasOwnProperty(key)) {\n          if (key === 'Items') {\n            if (!Array.isArray(chargedObj[key])) {\n              return false;\n            }\n\n            if (chargedObj[key].length > 16) {\n              logger.reportError(522, 'Charged Items exceed 16 limit. Actual count: ' + chargedObj[key].length + '. Additional items will be dropped.');\n            }\n\n            for (var itemKey in chargedObj[key]) {\n              if (chargedObj[key].hasOwnProperty(itemKey)) {\n                // since default array implementation could be overridden - e.g. Teabox site\n                if (!isObject(chargedObj[key][itemKey]) || !isEventStructureFlat(chargedObj[key][itemKey])) {\n                  return false;\n                }\n              }\n            }\n          } else {\n            if (isObject(chargedObj[key]) || Array.isArray(chargedObj[key])) {\n              return false;\n            } else if (isDateObject(chargedObj[key])) {\n              chargedObj[key] = convertToWZRKDate(chargedObj[key]);\n            }\n          }\n        }\n      }\n\n      if (isString(chargedObj[CHARGED_ID]) || isNumber(chargedObj[CHARGED_ID])) {\n        // save charged Id\n        var chargedId = chargedObj[CHARGED_ID] + ''; // casting chargedId to string\n\n        if (typeof _globalChargedId === 'undefined') {\n          _globalChargedId = StorageManager$1.readFromLSorCookie(CHARGEDID_COOKIE_NAME);\n        }\n\n        if (typeof _globalChargedId !== 'undefined' && _globalChargedId.trim() === chargedId.trim()) {\n          // drop event- duplicate charged id\n          logger.error('Duplicate charged Id - Dropped' + chargedObj);\n          return false;\n        }\n\n        _globalChargedId = chargedId;\n        StorageManager$1.saveToLSorCookie(CHARGEDID_COOKIE_NAME, chargedId);\n      }\n\n      return true;\n    } // if object (chargedObject)\n\n\n    return false;\n  };\n\n  var _logger$2 = _classPrivateFieldLooseKey(\"logger\");\n\n  var _oldValues = _classPrivateFieldLooseKey(\"oldValues\");\n\n  var _request$1 = _classPrivateFieldLooseKey(\"request\");\n\n  var _isPersonalisationActive = _classPrivateFieldLooseKey(\"isPersonalisationActive\");\n\n  var _processEventArray = _classPrivateFieldLooseKey(\"processEventArray\");\n\n  var EventHandler = /*#__PURE__*/function (_Array) {\n    _inherits(EventHandler, _Array);\n\n    var _super = _createSuper(EventHandler);\n\n    function EventHandler(_ref, values) {\n      var _this;\n\n      var logger = _ref.logger,\n          request = _ref.request,\n          isPersonalisationActive = _ref.isPersonalisationActive;\n\n      _classCallCheck(this, EventHandler);\n\n      _this = _super.call(this);\n      Object.defineProperty(_assertThisInitialized(_this), _processEventArray, {\n        value: _processEventArray2\n      });\n      Object.defineProperty(_assertThisInitialized(_this), _logger$2, {\n        writable: true,\n        value: void 0\n      });\n      Object.defineProperty(_assertThisInitialized(_this), _oldValues, {\n        writable: true,\n        value: void 0\n      });\n      Object.defineProperty(_assertThisInitialized(_this), _request$1, {\n        writable: true,\n        value: void 0\n      });\n      Object.defineProperty(_assertThisInitialized(_this), _isPersonalisationActive, {\n        writable: true,\n        value: void 0\n      });\n      _classPrivateFieldLooseBase(_assertThisInitialized(_this), _logger$2)[_logger$2] = logger;\n      _classPrivateFieldLooseBase(_assertThisInitialized(_this), _oldValues)[_oldValues] = values;\n      _classPrivateFieldLooseBase(_assertThisInitialized(_this), _request$1)[_request$1] = request;\n      _classPrivateFieldLooseBase(_assertThisInitialized(_this), _isPersonalisationActive)[_isPersonalisationActive] = isPersonalisationActive;\n      return _this;\n    }\n\n    _createClass(EventHandler, [{\n      key: \"push\",\n      value: function push() {\n        for (var _len = arguments.length, eventsArr = new Array(_len), _key = 0; _key < _len; _key++) {\n          eventsArr[_key] = arguments[_key];\n        }\n\n        _classPrivateFieldLooseBase(this, _processEventArray)[_processEventArray](eventsArr);\n\n        return 0;\n      }\n    }, {\n      key: \"_processOldValues\",\n      value: function _processOldValues() {\n        if (_classPrivateFieldLooseBase(this, _oldValues)[_oldValues]) {\n          _classPrivateFieldLooseBase(this, _processEventArray)[_processEventArray](_classPrivateFieldLooseBase(this, _oldValues)[_oldValues]);\n        }\n\n        _classPrivateFieldLooseBase(this, _oldValues)[_oldValues] = null;\n      }\n    }, {\n      key: \"getDetails\",\n      value: function getDetails(evtName) {\n        if (!_classPrivateFieldLooseBase(this, _isPersonalisationActive)[_isPersonalisationActive]()) {\n          return;\n        }\n\n        if (typeof $ct.globalEventsMap === 'undefined') {\n          $ct.globalEventsMap = StorageManager$1.readFromLSorCookie(EV_COOKIE);\n        }\n\n        if (typeof $ct.globalEventsMap === 'undefined') {\n          return;\n        }\n\n        var evtObj = $ct.globalEventsMap[evtName];\n        var respObj = {};\n\n        if (typeof evtObj !== 'undefined') {\n          respObj.firstTime = new Date(evtObj[1] * 1000);\n          respObj.lastTime = new Date(evtObj[2] * 1000);\n          respObj.count = evtObj[0];\n          return respObj;\n        }\n      }\n    }]);\n\n    return EventHandler;\n  }( /*#__PURE__*/_wrapNativeSuper(Array));\n\n  var _processEventArray2 = function _processEventArray2(eventsArr) {\n    if (Array.isArray(eventsArr)) {\n      while (eventsArr.length > 0) {\n        var eventName = eventsArr.shift();\n\n        if (!isString(eventName)) {\n          _classPrivateFieldLooseBase(this, _logger$2)[_logger$2].error(EVENT_ERROR);\n\n          continue;\n        }\n\n        if (eventName.length > 1024) {\n          eventName = eventName.substring(0, 1024);\n\n          _classPrivateFieldLooseBase(this, _logger$2)[_logger$2].reportError(510, eventName + '... length exceeded 1024 chars. Trimmed.');\n        }\n\n        if (SYSTEM_EVENTS.includes(eventName)) {\n          _classPrivateFieldLooseBase(this, _logger$2)[_logger$2].reportError(513, eventName + ' is a restricted system event. It cannot be used as an event name.');\n\n          continue;\n        }\n\n        var data = {};\n        data.type = 'event';\n        data.evtName = sanitize(eventName, unsupportedKeyCharRegex);\n\n        if (eventsArr.length !== 0) {\n          var eventObj = eventsArr.shift();\n\n          if (!isObject(eventObj)) {\n            // put it back if it is not an object\n            eventsArr.unshift(eventObj);\n          } else {\n            // check Charged Event vs. other events.\n            if (eventName === 'Charged') {\n              if (!isChargedEventStructureValid(eventObj, _classPrivateFieldLooseBase(this, _logger$2)[_logger$2])) {\n                _classPrivateFieldLooseBase(this, _logger$2)[_logger$2].reportError(511, 'Charged event structure invalid. Not sent.');\n\n                continue;\n              }\n            } else {\n              if (!isEventStructureFlat(eventObj)) {\n                _classPrivateFieldLooseBase(this, _logger$2)[_logger$2].reportError(512, eventName + ' event structure invalid. Not sent.');\n\n                continue;\n              }\n            }\n\n            data.evtData = eventObj;\n          }\n        }\n\n        _classPrivateFieldLooseBase(this, _request$1)[_request$1].processEvent(data);\n      }\n    }\n  };\n\n  var getURLParams = function getURLParams(url) {\n    var urlParams = {};\n    var idx = url.indexOf('?');\n\n    if (idx > 1) {\n      var uri = url.substring(idx + 1);\n      var match;\n      var pl = /\\+/g; // Regex for replacing addition symbol with a space\n\n      var search = /([^&=]+)=?([^&]*)/g;\n\n      var decode = function decode(s) {\n        var replacement = s.replace(pl, ' ');\n\n        try {\n          replacement = decodeURIComponent(replacement);\n        } catch (e) {// eat\n        }\n\n        return replacement;\n      };\n\n      match = search.exec(uri);\n\n      while (match) {\n        urlParams[decode(match[1])] = decode(match[2]);\n        match = search.exec(uri);\n      }\n    }\n\n    return urlParams;\n  };\n\n  var getDomain = function getDomain(url) {\n    if (url === '') return '';\n    var a = document.createElement('a');\n    a.href = url;\n    return a.hostname;\n  };\n\n  var addToURL = function addToURL(url, k, v) {\n    return url + '&' + k + '=' + encodeURIComponent(v);\n  };\n\n  var getHostName = function getHostName() {\n    return window.location.hostname;\n  };\n  /* eslint-disable */\n\n\n  var urlBase64ToUint8Array = function urlBase64ToUint8Array(base64String) {\n    var padding = '='.repeat((4 - base64String.length % 4) % 4);\n    var base64 = (base64String + padding).replace(/\\-/g, '+').replace(/_/g, '/');\n    var rawData = window.atob(base64);\n    var processedData = [];\n\n    for (var i = 0; i < rawData.length; i++) {\n      processedData.push(rawData.charCodeAt(i));\n    }\n\n    return new Uint8Array(processedData);\n  };\n\n  var compressData = function compressData(dataObject, logger) {\n    logger && typeof logger.debug === 'function' && logger.debug('dobj:' + dataObject);\n    return compressToBase64(dataObject);\n  };\n\n  var compress = function compress(uncompressed) {\n    if (uncompressed == null) return '';\n    var i,\n        value,\n        context_dictionary = {},\n        context_dictionaryToCreate = {},\n        context_c = '',\n        context_wc = '',\n        context_w = '',\n        context_enlargeIn = 2,\n        // Compensate for the first entry which should not count\n    context_dictSize = 3,\n        context_numBits = 2,\n        context_data_string = '',\n        context_data_val = 0,\n        context_data_position = 0,\n        ii,\n        f = String.fromCharCode;\n\n    for (ii = 0; ii < uncompressed.length; ii += 1) {\n      context_c = uncompressed.charAt(ii);\n\n      if (!Object.prototype.hasOwnProperty.call(context_dictionary, context_c)) {\n        context_dictionary[context_c] = context_dictSize++;\n        context_dictionaryToCreate[context_c] = true;\n      }\n\n      context_wc = context_w + context_c;\n\n      if (Object.prototype.hasOwnProperty.call(context_dictionary, context_wc)) {\n        context_w = context_wc;\n      } else {\n        if (Object.prototype.hasOwnProperty.call(context_dictionaryToCreate, context_w)) {\n          if (context_w.charCodeAt(0) < 256) {\n            for (i = 0; i < context_numBits; i++) {\n              context_data_val = context_data_val << 1;\n\n              if (context_data_position == 15) {\n                context_data_position = 0;\n                context_data_string += f(context_data_val);\n                context_data_val = 0;\n              } else {\n                context_data_position++;\n              }\n            }\n\n            value = context_w.charCodeAt(0);\n\n            for (i = 0; i < 8; i++) {\n              context_data_val = context_data_val << 1 | value & 1;\n\n              if (context_data_position == 15) {\n                context_data_position = 0;\n                context_data_string += f(context_data_val);\n                context_data_val = 0;\n              } else {\n                context_data_position++;\n              }\n\n              value = value >> 1;\n            }\n          } else {\n            value = 1;\n\n            for (i = 0; i < context_numBits; i++) {\n              context_data_val = context_data_val << 1 | value;\n\n              if (context_data_position == 15) {\n                context_data_position = 0;\n                context_data_string += f(context_data_val);\n                context_data_val = 0;\n              } else {\n                context_data_position++;\n              }\n\n              value = 0;\n            }\n\n            value = context_w.charCodeAt(0);\n\n            for (i = 0; i < 16; i++) {\n              context_data_val = context_data_val << 1 | value & 1;\n\n              if (context_data_position == 15) {\n                context_data_position = 0;\n                context_data_string += f(context_data_val);\n                context_data_val = 0;\n              } else {\n                context_data_position++;\n              }\n\n              value = value >> 1;\n            }\n          }\n\n          context_enlargeIn--;\n\n          if (context_enlargeIn == 0) {\n            context_enlargeIn = Math.pow(2, context_numBits);\n            context_numBits++;\n          }\n\n          delete context_dictionaryToCreate[context_w];\n        } else {\n          value = context_dictionary[context_w];\n\n          for (i = 0; i < context_numBits; i++) {\n            context_data_val = context_data_val << 1 | value & 1;\n\n            if (context_data_position == 15) {\n              context_data_position = 0;\n              context_data_string += f(context_data_val);\n              context_data_val = 0;\n            } else {\n              context_data_position++;\n            }\n\n            value = value >> 1;\n          }\n        }\n\n        context_enlargeIn--;\n\n        if (context_enlargeIn == 0) {\n          context_enlargeIn = Math.pow(2, context_numBits);\n          context_numBits++;\n        } // Add wc to the dictionary.\n\n\n        context_dictionary[context_wc] = context_dictSize++;\n        context_w = String(context_c);\n      }\n    } // Output the code for w.\n\n\n    if (context_w !== '') {\n      if (Object.prototype.hasOwnProperty.call(context_dictionaryToCreate, context_w)) {\n        if (context_w.charCodeAt(0) < 256) {\n          for (i = 0; i < context_numBits; i++) {\n            context_data_val = context_data_val << 1;\n\n            if (context_data_position == 15) {\n              context_data_position = 0;\n              context_data_string += f(context_data_val);\n              context_data_val = 0;\n            } else {\n              context_data_position++;\n            }\n          }\n\n          value = context_w.charCodeAt(0);\n\n          for (i = 0; i < 8; i++) {\n            context_data_val = context_data_val << 1 | value & 1;\n\n            if (context_data_position == 15) {\n              context_data_position = 0;\n              context_data_string += f(context_data_val);\n              context_data_val = 0;\n            } else {\n              context_data_position++;\n            }\n\n            value = value >> 1;\n          }\n        } else {\n          value = 1;\n\n          for (i = 0; i < context_numBits; i++) {\n            context_data_val = context_data_val << 1 | value;\n\n            if (context_data_position == 15) {\n              context_data_position = 0;\n              context_data_string += f(context_data_val);\n              context_data_val = 0;\n            } else {\n              context_data_position++;\n            }\n\n            value = 0;\n          }\n\n          value = context_w.charCodeAt(0);\n\n          for (i = 0; i < 16; i++) {\n            context_data_val = context_data_val << 1 | value & 1;\n\n            if (context_data_position == 15) {\n              context_data_position = 0;\n              context_data_string += f(context_data_val);\n              context_data_val = 0;\n            } else {\n              context_data_position++;\n            }\n\n            value = value >> 1;\n          }\n        }\n\n        context_enlargeIn--;\n\n        if (context_enlargeIn == 0) {\n          context_enlargeIn = Math.pow(2, context_numBits);\n          context_numBits++;\n        }\n\n        delete context_dictionaryToCreate[context_w];\n      } else {\n        value = context_dictionary[context_w];\n\n        for (i = 0; i < context_numBits; i++) {\n          context_data_val = context_data_val << 1 | value & 1;\n\n          if (context_data_position == 15) {\n            context_data_position = 0;\n            context_data_string += f(context_data_val);\n            context_data_val = 0;\n          } else {\n            context_data_position++;\n          }\n\n          value = value >> 1;\n        }\n      }\n\n      context_enlargeIn--;\n\n      if (context_enlargeIn == 0) {\n        context_enlargeIn = Math.pow(2, context_numBits);\n        context_numBits++;\n      }\n    } // Mark the end of the stream\n\n\n    value = 2;\n\n    for (i = 0; i < context_numBits; i++) {\n      context_data_val = context_data_val << 1 | value & 1;\n\n      if (context_data_position == 15) {\n        context_data_position = 0;\n        context_data_string += f(context_data_val);\n        context_data_val = 0;\n      } else {\n        context_data_position++;\n      }\n\n      value = value >> 1;\n    } // Flush the last char\n\n\n    while (true) {\n      context_data_val = context_data_val << 1;\n\n      if (context_data_position == 15) {\n        context_data_string += f(context_data_val);\n        break;\n      } else context_data_position++;\n    }\n\n    return context_data_string;\n  };\n\n  var getKeyStr = function getKeyStr() {\n    var key = '';\n    var i = 0;\n\n    for (i = 0; i <= 25; i++) {\n      key = key + String.fromCharCode(i + 65);\n    }\n\n    for (i = 0; i <= 25; i++) {\n      key = key + String.fromCharCode(i + 97);\n    }\n\n    for (i = 0; i < 10; i++) {\n      key = key + i;\n    }\n\n    return key + '+/=';\n  };\n\n  var _keyStr = getKeyStr();\n\n  var compressToBase64 = function compressToBase64(input) {\n    if (input == null) return '';\n    var output = '';\n    var chr1, chr2, chr3, enc1, enc2, enc3, enc4;\n    var i = 0;\n    input = compress(input);\n\n    while (i < input.length * 2) {\n      if (i % 2 == 0) {\n        chr1 = input.charCodeAt(i / 2) >> 8;\n        chr2 = input.charCodeAt(i / 2) & 255;\n        if (i / 2 + 1 < input.length) chr3 = input.charCodeAt(i / 2 + 1) >> 8;else chr3 = NaN;\n      } else {\n        chr1 = input.charCodeAt((i - 1) / 2) & 255;\n\n        if ((i + 1) / 2 < input.length) {\n          chr2 = input.charCodeAt((i + 1) / 2) >> 8;\n          chr3 = input.charCodeAt((i + 1) / 2) & 255;\n        } else chr2 = chr3 = NaN;\n      }\n\n      i += 3;\n      enc1 = chr1 >> 2;\n      enc2 = (chr1 & 3) << 4 | chr2 >> 4;\n      enc3 = (chr2 & 15) << 2 | chr3 >> 6;\n      enc4 = chr3 & 63;\n\n      if (isNaN(chr2)) {\n        enc3 = enc4 = 64;\n      } else if (isNaN(chr3)) {\n        enc4 = 64;\n      }\n\n      output = output + _keyStr.charAt(enc1) + _keyStr.charAt(enc2) + _keyStr.charAt(enc3) + _keyStr.charAt(enc4);\n    }\n\n    return output;\n  };\n\n  var _fireRequest = _classPrivateFieldLooseKey(\"fireRequest\");\n\n  var _dropRequestDueToOptOut = _classPrivateFieldLooseKey(\"dropRequestDueToOptOut\");\n\n  var _addUseIPToRequest = _classPrivateFieldLooseKey(\"addUseIPToRequest\");\n\n  var _addARPToRequest = _classPrivateFieldLooseKey(\"addARPToRequest\");\n\n  var RequestDispatcher = /*#__PURE__*/function () {\n    function RequestDispatcher() {\n      _classCallCheck(this, RequestDispatcher);\n    }\n\n    _createClass(RequestDispatcher, null, [{\n      key: \"fireRequest\",\n      value: function fireRequest(url, skipARP, sendOULFlag) {\n        _classPrivateFieldLooseBase(this, _fireRequest)[_fireRequest](url, 1, skipARP, sendOULFlag);\n      }\n    }]);\n\n    return RequestDispatcher;\n  }();\n\n  var _addARPToRequest2 = function _addARPToRequest2(url, skipResARP) {\n    if (skipResARP === true) {\n      var _arp = {};\n      _arp.skipResARP = true;\n      return addToURL(url, 'arp', compressData(JSON.stringify(_arp), this.logger));\n    }\n\n    if (StorageManager$1._isLocalStorageSupported() && typeof localStorage.getItem(ARP_COOKIE) !== 'undefined' && localStorage.getItem(ARP_COOKIE) !== null) {\n      return addToURL(url, 'arp', compressData(JSON.stringify(StorageManager$1.readFromLSorCookie(ARP_COOKIE)), this.logger));\n    }\n\n    return url;\n  };\n\n  var _addUseIPToRequest2 = function _addUseIPToRequest2(pageLoadUrl) {\n    var useIP = StorageManager$1.getMetaProp(USEIP_KEY);\n\n    if (typeof useIP !== 'boolean') {\n      useIP = false;\n    }\n\n    return addToURL(pageLoadUrl, USEIP_KEY, useIP ? 'true' : 'false');\n  };\n\n  var _dropRequestDueToOptOut2 = function _dropRequestDueToOptOut2() {\n    if ($ct.isOptInRequest || !isValueValid(this.device.gcookie) || !isString(this.device.gcookie)) {\n      $ct.isOptInRequest = false;\n      return false;\n    }\n\n    return this.device.gcookie.slice(-3) === OPTOUT_COOKIE_ENDSWITH;\n  };\n\n  var _fireRequest2 = function _fireRequest2(url, tries, skipARP, sendOULFlag) {\n    var _this = this,\n        _window$clevertap,\n        _window$wizrocket;\n\n    if (_classPrivateFieldLooseBase(this, _dropRequestDueToOptOut)[_dropRequestDueToOptOut]()) {\n      this.logger.debug('req dropped due to optout cookie: ' + this.device.gcookie);\n      return;\n    }\n\n    if (!isValueValid(this.device.gcookie) && $ct.globalCache.RESP_N < $ct.globalCache.REQ_N - 1 && tries < MAX_TRIES) {\n      setTimeout(function () {\n        _this.logger.debug(\"retrying fire request for url: \".concat(url, \", tries: \").concat(tries));\n\n        _classPrivateFieldLooseBase(_this, _fireRequest)[_fireRequest](url, tries + 1, skipARP, sendOULFlag);\n      }, 50);\n      return;\n    }\n\n    if (!sendOULFlag) {\n      if (isValueValid(this.device.gcookie)) {\n        // add cookie to url\n        url = addToURL(url, 'gc', this.device.gcookie);\n      }\n\n      url = _classPrivateFieldLooseBase(this, _addARPToRequest)[_addARPToRequest](url, skipARP);\n    }\n\n    url = _classPrivateFieldLooseBase(this, _addUseIPToRequest)[_addUseIPToRequest](url);\n    url = addToURL(url, 'r', new Date().getTime()); // add epoch to beat caching of the URL\n    // TODO: Figure out a better way to handle plugin check\n\n    if (((_window$clevertap = window.clevertap) === null || _window$clevertap === void 0 ? void 0 : _window$clevertap.hasOwnProperty('plugin')) || ((_window$wizrocket = window.wizrocket) === null || _window$wizrocket === void 0 ? void 0 : _window$wizrocket.hasOwnProperty('plugin'))) {\n      // used to add plugin name in request parameter\n      var plugin = window.clevertap.plugin || window.wizrocket.plugin;\n      url = addToURL(url, 'ct_pl', plugin);\n    }\n\n    if (url.indexOf('chrome-extension:') !== -1) {\n      url = url.replace('chrome-extension:', 'https:');\n    } // TODO: Try using Function constructor instead of appending script.\n\n\n    var ctCbScripts = document.getElementsByClassName('ct-jp-cb');\n\n    while (ctCbScripts[0]) {\n      ctCbScripts[0].parentNode.removeChild(ctCbScripts[0]);\n    }\n\n    var s = document.createElement('script');\n    s.setAttribute('type', 'text/javascript');\n    s.setAttribute('src', url);\n    s.setAttribute('class', 'ct-jp-cb');\n    s.setAttribute('rel', 'nofollow');\n    s.async = true;\n    document.getElementsByTagName('head')[0].appendChild(s);\n    this.logger.debug('req snt -> url: ' + url);\n  };\n\n  RequestDispatcher.logger = void 0;\n  RequestDispatcher.device = void 0;\n  Object.defineProperty(RequestDispatcher, _fireRequest, {\n    value: _fireRequest2\n  });\n  Object.defineProperty(RequestDispatcher, _dropRequestDueToOptOut, {\n    value: _dropRequestDueToOptOut2\n  });\n  Object.defineProperty(RequestDispatcher, _addUseIPToRequest, {\n    value: _addUseIPToRequest2\n  });\n  Object.defineProperty(RequestDispatcher, _addARPToRequest, {\n    value: _addARPToRequest2\n  }); // CleverTap specific utilities\n\n  var getCampaignObject = function getCampaignObject() {\n    var campObj = {};\n\n    if (StorageManager$1._isLocalStorageSupported()) {\n      campObj = StorageManager$1.read(CAMP_COOKIE_NAME);\n\n      if (campObj != null) {\n        campObj = JSON.parse(decodeURIComponent(campObj).replace(singleQuoteRegex, '\\\"'));\n      } else {\n        campObj = {};\n      }\n    }\n\n    return campObj;\n  };\n\n  var saveCampaignObject = function saveCampaignObject(campaignObj) {\n    if (StorageManager$1._isLocalStorageSupported()) {\n      var campObj = JSON.stringify(campaignObj);\n      StorageManager$1.save(CAMP_COOKIE_NAME, encodeURIComponent(campObj));\n    }\n  };\n\n  var getCampaignObjForLc = function getCampaignObjForLc() {\n    var campObj = {};\n\n    if (StorageManager$1._isLocalStorageSupported()) {\n      campObj = getCampaignObject();\n      var resultObj = [];\n      var globalObj = campObj.global;\n      var today = getToday();\n      var dailyObj = campObj[today];\n\n      if (typeof globalObj !== 'undefined') {\n        var campaignIdArray = Object.keys(globalObj);\n\n        for (var index in campaignIdArray) {\n          if (campaignIdArray.hasOwnProperty(index)) {\n            var dailyC = 0;\n            var totalC = 0;\n            var campaignId = campaignIdArray[index];\n\n            if (campaignId === 'tc') {\n              continue;\n            }\n\n            if (typeof dailyObj !== 'undefined' && typeof dailyObj[campaignId] !== 'undefined') {\n              dailyC = dailyObj[campaignId];\n            }\n\n            if (typeof globalObj !== 'undefined' && typeof globalObj[campaignId] !== 'undefined') {\n              totalC = globalObj[campaignId];\n            }\n\n            var element = [campaignId, dailyC, totalC];\n            resultObj.push(element);\n          }\n        }\n      }\n\n      var todayC = 0;\n\n      if (typeof dailyObj !== 'undefined' && typeof dailyObj.tc !== 'undefined') {\n        todayC = dailyObj.tc;\n      }\n\n      resultObj = {\n        wmp: todayC,\n        tlc: resultObj\n      };\n      return resultObj;\n    }\n  };\n\n  var isProfileValid = function isProfileValid(profileObj, _ref) {\n    var logger = _ref.logger;\n    var valid = false;\n\n    if (isObject(profileObj)) {\n      for (var profileKey in profileObj) {\n        if (profileObj.hasOwnProperty(profileKey)) {\n          valid = true;\n          var profileVal = profileObj[profileKey];\n\n          if (profileVal == null) {\n            delete profileObj[profileKey];\n            continue;\n          }\n\n          if (profileKey === 'Gender' && !profileVal.match(/^M$|^F$/)) {\n            valid = false;\n            logger.error(GENDER_ERROR);\n          }\n\n          if (profileKey === 'Employed' && !profileVal.match(/^Y$|^N$/)) {\n            valid = false;\n            logger.error(EMPLOYED_ERROR);\n          }\n\n          if (profileKey === 'Married' && !profileVal.match(/^Y$|^N$/)) {\n            valid = false;\n            logger.error(MARRIED_ERROR);\n          }\n\n          if (profileKey === 'Education' && !profileVal.match(/^School$|^College$|^Graduate$/)) {\n            valid = false;\n            logger.error(EDUCATION_ERROR);\n          }\n\n          if (profileKey === 'Age' && profileVal != null) {\n            if (isConvertibleToNumber(profileVal)) {\n              profileObj.Age = +profileVal;\n            } else {\n              valid = false;\n              logger.error(AGE_ERROR);\n            }\n          } // dob will come in like this - $dt_19470815 or dateObject\n\n\n          if (profileKey === 'DOB') {\n            if ((!/^\\$D_/.test(profileVal) || (profileVal + '').length !== 11) && !isDateObject(profileVal)) {\n              valid = false;\n              logger.error(DOB_ERROR);\n            }\n\n            if (isDateObject(profileVal)) {\n              profileObj[profileKey] = convertToWZRKDate(profileVal);\n            }\n          } else if (isDateObject(profileVal)) {\n            profileObj[profileKey] = convertToWZRKDate(profileVal);\n          }\n\n          if (profileKey === 'Phone' && !isObjectEmpty(profileVal)) {\n            if (profileVal.length > 8 && profileVal.charAt(0) === '+') {\n              // valid phone number\n              profileVal = profileVal.substring(1, profileVal.length);\n\n              if (isConvertibleToNumber(profileVal)) {\n                profileObj.Phone = +profileVal;\n              } else {\n                valid = false;\n                logger.error(PHONE_FORMAT_ERROR + '. Removed.');\n              }\n            } else {\n              valid = false;\n              logger.error(PHONE_FORMAT_ERROR + '. Removed.');\n            }\n          }\n\n          if (!valid) {\n            delete profileObj[profileKey];\n          }\n        }\n      }\n    }\n\n    return valid;\n  };\n\n  var processFBUserObj = function processFBUserObj(user) {\n    var profileData = {};\n    profileData.Name = user.name;\n\n    if (user.id != null) {\n      profileData.FBID = user.id + '';\n    } // Feb 2014 - FB announced over 58 gender options, hence we specifically look for male or female. Rest we don't care.\n\n\n    if (user.gender === 'male') {\n      profileData.Gender = 'M';\n    } else if (user.gender === 'female') {\n      profileData.Gender = 'F';\n    } else {\n      profileData.Gender = 'O';\n    }\n\n    var getHighestEducation = function getHighestEducation(eduArr) {\n      if (eduArr != null) {\n        var college = '';\n        var highschool = '';\n\n        for (var i = 0; i < eduArr.length; i++) {\n          var _edu = eduArr[i];\n\n          if (_edu.type != null) {\n            var type = _edu.type;\n\n            if (type === 'Graduate School') {\n              return 'Graduate';\n            } else if (type === 'College') {\n              college = '1';\n            } else if (type === 'High School') {\n              highschool = '1';\n            }\n          }\n        }\n\n        if (college === '1') {\n          return 'College';\n        } else if (highschool === '1') {\n          return 'School';\n        }\n      }\n    };\n\n    if (user.relationship_status != null) {\n      profileData.Married = 'N';\n\n      if (user.relationship_status === 'Married') {\n        profileData.Married = 'Y';\n      }\n    }\n\n    var edu = getHighestEducation(user.education);\n\n    if (edu != null) {\n      profileData.Education = edu;\n    }\n\n    var work = user.work != null ? user.work.length : 0;\n\n    if (work > 0) {\n      profileData.Employed = 'Y';\n    } else {\n      profileData.Employed = 'N';\n    }\n\n    if (user.email != null) {\n      profileData.Email = user.email;\n    }\n\n    if (user.birthday != null) {\n      var mmddyy = user.birthday.split('/'); // comes in as \"08/15/1947\"\n\n      profileData.DOB = setDate(mmddyy[2] + mmddyy[0] + mmddyy[1]);\n    }\n\n    return profileData;\n  };\n\n  var processGPlusUserObj = function processGPlusUserObj(user, _ref2) {\n    var logger = _ref2.logger;\n    var profileData = {};\n\n    if (user.displayName != null) {\n      profileData.Name = user.displayName;\n    }\n\n    if (user.id != null) {\n      profileData.GPID = user.id + '';\n    }\n\n    if (user.gender != null) {\n      if (user.gender === 'male') {\n        profileData.Gender = 'M';\n      } else if (user.gender === 'female') {\n        profileData.Gender = 'F';\n      } else if (user.gender === 'other') {\n        profileData.Gender = 'O';\n      }\n    }\n\n    if (user.image != null) {\n      if (user.image.isDefault === false) {\n        profileData.Photo = user.image.url.split('?sz')[0];\n      }\n    }\n\n    if (user.emails != null) {\n      for (var emailIdx = 0; emailIdx < user.emails.length; emailIdx++) {\n        var emailObj = user.emails[emailIdx];\n\n        if (emailObj.type === 'account') {\n          profileData.Email = emailObj.value;\n        }\n      }\n    }\n\n    if (user.organizations != null) {\n      profileData.Employed = 'N';\n\n      for (var i = 0; i < user.organizations.length; i++) {\n        var orgObj = user.organizations[i];\n\n        if (orgObj.type === 'work') {\n          profileData.Employed = 'Y';\n        }\n      }\n    }\n\n    if (user.birthday != null) {\n      var yyyymmdd = user.birthday.split('-'); // comes in as \"1976-07-27\"\n\n      profileData.DOB = setDate(yyyymmdd[0] + yyyymmdd[1] + yyyymmdd[2]);\n    }\n\n    if (user.relationshipStatus != null) {\n      profileData.Married = 'N';\n\n      if (user.relationshipStatus === 'married') {\n        profileData.Married = 'Y';\n      }\n    }\n\n    logger.debug('gplus usr profile ' + JSON.stringify(profileData));\n    return profileData;\n  };\n\n  var addToLocalProfileMap = function addToLocalProfileMap(profileObj, override) {\n    if (StorageManager$1._isLocalStorageSupported()) {\n      if ($ct.globalProfileMap == null) {\n        $ct.globalProfileMap = StorageManager$1.readFromLSorCookie(PR_COOKIE);\n\n        if ($ct.globalProfileMap == null) {\n          $ct.globalProfileMap = {};\n        }\n      } // Move props from custom bucket to outside.\n\n\n      if (profileObj._custom != null) {\n        var keys = profileObj._custom;\n\n        for (var key in keys) {\n          if (keys.hasOwnProperty(key)) {\n            profileObj[key] = keys[key];\n          }\n        }\n\n        delete profileObj._custom;\n      }\n\n      for (var prop in profileObj) {\n        if (profileObj.hasOwnProperty(prop)) {\n          if ($ct.globalProfileMap.hasOwnProperty(prop) && !override) {\n            continue;\n          }\n\n          $ct.globalProfileMap[prop] = profileObj[prop];\n        }\n      }\n\n      if ($ct.globalProfileMap._custom != null) {\n        delete $ct.globalProfileMap._custom;\n      }\n\n      StorageManager$1.saveToLSorCookie(PR_COOKIE, $ct.globalProfileMap);\n    }\n  };\n\n  var closeIframe = function closeIframe(campaignId, divIdIgnored, currentSessionId) {\n    if (campaignId != null && campaignId !== '-1') {\n      if (StorageManager$1._isLocalStorageSupported()) {\n        var campaignObj = getCampaignObject();\n        var sessionCampaignObj = campaignObj[currentSessionId];\n\n        if (sessionCampaignObj == null) {\n          sessionCampaignObj = {};\n          campaignObj[currentSessionId] = sessionCampaignObj;\n        }\n\n        sessionCampaignObj[campaignId] = 'dnd';\n        saveCampaignObject(campaignObj);\n      }\n    }\n\n    if ($ct.campaignDivMap != null) {\n      var divId = $ct.campaignDivMap[campaignId];\n\n      if (divId != null) {\n        document.getElementById(divId).style.display = 'none';\n\n        if (divId === 'intentPreview') {\n          if (document.getElementById('intentOpacityDiv') != null) {\n            document.getElementById('intentOpacityDiv').style.display = 'none';\n          }\n        }\n      }\n    }\n  };\n\n  var arp = function arp(jsonMap) {\n    // For unregister calls dont set arp in LS\n    if (jsonMap.skipResARP != null && jsonMap.skipResARP) {\n      console.debug('Update ARP Request rejected', jsonMap);\n      return null;\n    }\n\n    var isOULARP = !!(jsonMap[IS_OUL] != null && jsonMap[IS_OUL] === true);\n\n    if (StorageManager$1._isLocalStorageSupported()) {\n      try {\n        var arpFromStorage = StorageManager$1.readFromLSorCookie(ARP_COOKIE);\n\n        if (arpFromStorage == null || isOULARP) {\n          arpFromStorage = {};\n        }\n\n        for (var key in jsonMap) {\n          if (jsonMap.hasOwnProperty(key)) {\n            if (jsonMap[key] === -1) {\n              delete arpFromStorage[key];\n            } else {\n              arpFromStorage[key] = jsonMap[key];\n            }\n          }\n        }\n\n        StorageManager$1.saveToLSorCookie(ARP_COOKIE, arpFromStorage);\n      } catch (e) {\n        console.error('Unable to parse ARP JSON: ' + e);\n      }\n    }\n  };\n\n  var setEnum = function setEnum(enumVal, logger) {\n    if (isString(enumVal) || isNumber(enumVal)) {\n      return '$E_' + enumVal;\n    }\n\n    logger.error(ENUM_FORMAT_ERROR);\n  };\n\n  var handleEmailSubscription = function handleEmailSubscription(subscription, reEncoded, fetchGroups, account, logger) {\n    var urlParamsAsIs = getURLParams(location.href); // can't use url_params as it is in lowercase above\n\n    var encodedEmailId = urlParamsAsIs.e;\n    var encodedProfileProps = urlParamsAsIs.p;\n\n    if (typeof encodedEmailId !== 'undefined') {\n      var data = {};\n      data.id = account.id; // accountId\n\n      data.unsubGroups = $ct.unsubGroups; // unsubscribe groups\n\n      if ($ct.updatedCategoryLong) {\n        data[categoryLongKey] = $ct.updatedCategoryLong;\n      }\n\n      var url = account.emailURL;\n\n      if (fetchGroups) {\n        url = addToURL(url, 'fetchGroups', fetchGroups);\n      }\n\n      if (reEncoded) {\n        url = addToURL(url, 'encoded', reEncoded);\n      }\n\n      url = addToURL(url, 'e', encodedEmailId);\n      url = addToURL(url, 'd', compressData(JSON.stringify(data), logger));\n\n      if (encodedProfileProps) {\n        url = addToURL(url, 'p', encodedProfileProps);\n      }\n\n      if (subscription !== '-1') {\n        url = addToURL(url, 'sub', subscription);\n      }\n\n      RequestDispatcher.fireRequest(url);\n    }\n  };\n\n  var _logger$3 = _classPrivateFieldLooseKey(\"logger\");\n\n  var _request$2 = _classPrivateFieldLooseKey(\"request\");\n\n  var _account = _classPrivateFieldLooseKey(\"account\");\n\n  var _oldValues$1 = _classPrivateFieldLooseKey(\"oldValues\");\n\n  var _isPersonalisationActive$1 = _classPrivateFieldLooseKey(\"isPersonalisationActive\");\n\n  var _processProfileArray = _classPrivateFieldLooseKey(\"processProfileArray\");\n\n  var ProfileHandler = /*#__PURE__*/function (_Array) {\n    _inherits(ProfileHandler, _Array);\n\n    var _super = _createSuper(ProfileHandler);\n\n    function ProfileHandler(_ref, values) {\n      var _this;\n\n      var logger = _ref.logger,\n          request = _ref.request,\n          account = _ref.account,\n          isPersonalisationActive = _ref.isPersonalisationActive;\n\n      _classCallCheck(this, ProfileHandler);\n\n      _this = _super.call(this);\n      Object.defineProperty(_assertThisInitialized(_this), _processProfileArray, {\n        value: _processProfileArray2\n      });\n      Object.defineProperty(_assertThisInitialized(_this), _logger$3, {\n        writable: true,\n        value: void 0\n      });\n      Object.defineProperty(_assertThisInitialized(_this), _request$2, {\n        writable: true,\n        value: void 0\n      });\n      Object.defineProperty(_assertThisInitialized(_this), _account, {\n        writable: true,\n        value: void 0\n      });\n      Object.defineProperty(_assertThisInitialized(_this), _oldValues$1, {\n        writable: true,\n        value: void 0\n      });\n      Object.defineProperty(_assertThisInitialized(_this), _isPersonalisationActive$1, {\n        writable: true,\n        value: void 0\n      });\n      _classPrivateFieldLooseBase(_assertThisInitialized(_this), _logger$3)[_logger$3] = logger;\n      _classPrivateFieldLooseBase(_assertThisInitialized(_this), _request$2)[_request$2] = request;\n      _classPrivateFieldLooseBase(_assertThisInitialized(_this), _account)[_account] = account;\n      _classPrivateFieldLooseBase(_assertThisInitialized(_this), _oldValues$1)[_oldValues$1] = values;\n      _classPrivateFieldLooseBase(_assertThisInitialized(_this), _isPersonalisationActive$1)[_isPersonalisationActive$1] = isPersonalisationActive;\n      return _this;\n    }\n\n    _createClass(ProfileHandler, [{\n      key: \"push\",\n      value: function push() {\n        for (var _len = arguments.length, profilesArr = new Array(_len), _key = 0; _key < _len; _key++) {\n          profilesArr[_key] = arguments[_key];\n        }\n\n        _classPrivateFieldLooseBase(this, _processProfileArray)[_processProfileArray](profilesArr);\n\n        return 0;\n      }\n    }, {\n      key: \"_processOldValues\",\n      value: function _processOldValues() {\n        if (_classPrivateFieldLooseBase(this, _oldValues$1)[_oldValues$1]) {\n          _classPrivateFieldLooseBase(this, _processProfileArray)[_processProfileArray](_classPrivateFieldLooseBase(this, _oldValues$1)[_oldValues$1]);\n        }\n\n        _classPrivateFieldLooseBase(this, _oldValues$1)[_oldValues$1] = null;\n      }\n    }, {\n      key: \"getAttribute\",\n      value: function getAttribute(propName) {\n        if (!_classPrivateFieldLooseBase(this, _isPersonalisationActive$1)[_isPersonalisationActive$1]()) {\n          return;\n        }\n\n        if ($ct.globalProfileMap == null) {\n          $ct.globalProfileMap = StorageManager.readFromLSorCookie(PR_COOKIE);\n        }\n\n        if ($ct.globalProfileMap != null) {\n          return $ct.globalProfileMap[propName];\n        }\n      }\n    }]);\n\n    return ProfileHandler;\n  }( /*#__PURE__*/_wrapNativeSuper(Array));\n\n  var _processProfileArray2 = function _processProfileArray2(profileArr) {\n    if (Array.isArray(profileArr) && profileArr.length > 0) {\n      for (var index in profileArr) {\n        if (profileArr.hasOwnProperty(index)) {\n          var outerObj = profileArr[index];\n          var data = {};\n          var profileObj = void 0;\n\n          if (outerObj.Site != null) {\n            // organic data from the site\n            profileObj = outerObj.Site;\n\n            if (isObjectEmpty(profileObj) || !isProfileValid(profileObj, {\n              logger: _classPrivateFieldLooseBase(this, _logger$3)[_logger$3]\n            })) {\n              return;\n            }\n          } else if (outerObj.Facebook != null) {\n            // fb connect data\n            var FbProfileObj = outerObj.Facebook; // make sure that the object contains any data at all\n\n            if (!isObjectEmpty(FbProfileObj) && !FbProfileObj.error) {\n              profileObj = processFBUserObj(FbProfileObj);\n            }\n          } else if (outerObj['Google Plus'] != null) {\n            var GPlusProfileObj = outerObj['Google Plus'];\n\n            if (!isObjectEmpty(GPlusProfileObj) && !GPlusProfileObj.error) {\n              profileObj = processGPlusUserObj(GPlusProfileObj, {\n                logger: _classPrivateFieldLooseBase(this, _logger$3)[_logger$3]\n              });\n            }\n          }\n\n          if (profileObj != null && !isObjectEmpty(profileObj)) {\n            // profile got set from above\n            data.type = 'profile';\n\n            if (profileObj.tz == null) {\n              // try to auto capture user timezone if not present\n              profileObj.tz = new Date().toString().match(/([A-Z]+[\\+-][0-9]+)/)[1];\n            }\n\n            data.profile = profileObj;\n            addToLocalProfileMap(profileObj, true);\n            data = _classPrivateFieldLooseBase(this, _request$2)[_request$2].addSystemDataToObject(data, undefined);\n\n            _classPrivateFieldLooseBase(this, _request$2)[_request$2].addFlags(data);\n\n            var compressedData = compressData(JSON.stringify(data), _classPrivateFieldLooseBase(this, _logger$3)[_logger$3]);\n\n            var pageLoadUrl = _classPrivateFieldLooseBase(this, _account)[_account].dataPostURL;\n\n            pageLoadUrl = addToURL(pageLoadUrl, 'type', EVT_PUSH);\n            pageLoadUrl = addToURL(pageLoadUrl, 'd', compressedData);\n\n            _classPrivateFieldLooseBase(this, _request$2)[_request$2].saveAndFireRequest(pageLoadUrl, $ct.blockRequeust);\n          }\n        }\n      }\n    }\n  };\n\n  var _request$3 = _classPrivateFieldLooseKey(\"request\");\n\n  var _logger$4 = _classPrivateFieldLooseKey(\"logger\");\n\n  var _account$1 = _classPrivateFieldLooseKey(\"account\");\n\n  var _session$1 = _classPrivateFieldLooseKey(\"session\");\n\n  var _oldValues$2 = _classPrivateFieldLooseKey(\"oldValues\");\n\n  var _device$1 = _classPrivateFieldLooseKey(\"device\");\n\n  var _processOUL = _classPrivateFieldLooseKey(\"processOUL\");\n\n  var _handleCookieFromCache = _classPrivateFieldLooseKey(\"handleCookieFromCache\");\n\n  var _deleteUser = _classPrivateFieldLooseKey(\"deleteUser\");\n\n  var _processLoginArray = _classPrivateFieldLooseKey(\"processLoginArray\");\n\n  var UserLoginHandler = /*#__PURE__*/function (_Array) {\n    _inherits(UserLoginHandler, _Array);\n\n    var _super = _createSuper(UserLoginHandler);\n\n    function UserLoginHandler(_ref, values) {\n      var _this;\n\n      var request = _ref.request,\n          account = _ref.account,\n          session = _ref.session,\n          logger = _ref.logger,\n          device = _ref.device;\n\n      _classCallCheck(this, UserLoginHandler);\n\n      _this = _super.call(this);\n      Object.defineProperty(_assertThisInitialized(_this), _processLoginArray, {\n        value: _processLoginArray2\n      });\n      Object.defineProperty(_assertThisInitialized(_this), _deleteUser, {\n        value: _deleteUser2\n      });\n      Object.defineProperty(_assertThisInitialized(_this), _handleCookieFromCache, {\n        value: _handleCookieFromCache2\n      });\n      Object.defineProperty(_assertThisInitialized(_this), _processOUL, {\n        value: _processOUL2\n      });\n      Object.defineProperty(_assertThisInitialized(_this), _request$3, {\n        writable: true,\n        value: void 0\n      });\n      Object.defineProperty(_assertThisInitialized(_this), _logger$4, {\n        writable: true,\n        value: void 0\n      });\n      Object.defineProperty(_assertThisInitialized(_this), _account$1, {\n        writable: true,\n        value: void 0\n      });\n      Object.defineProperty(_assertThisInitialized(_this), _session$1, {\n        writable: true,\n        value: void 0\n      });\n      Object.defineProperty(_assertThisInitialized(_this), _oldValues$2, {\n        writable: true,\n        value: void 0\n      });\n      Object.defineProperty(_assertThisInitialized(_this), _device$1, {\n        writable: true,\n        value: void 0\n      });\n      _classPrivateFieldLooseBase(_assertThisInitialized(_this), _request$3)[_request$3] = request;\n      _classPrivateFieldLooseBase(_assertThisInitialized(_this), _account$1)[_account$1] = account;\n      _classPrivateFieldLooseBase(_assertThisInitialized(_this), _session$1)[_session$1] = session;\n      _classPrivateFieldLooseBase(_assertThisInitialized(_this), _logger$4)[_logger$4] = logger;\n      _classPrivateFieldLooseBase(_assertThisInitialized(_this), _oldValues$2)[_oldValues$2] = values;\n      _classPrivateFieldLooseBase(_assertThisInitialized(_this), _device$1)[_device$1] = device;\n      return _this;\n    }\n\n    _createClass(UserLoginHandler, [{\n      key: \"clear\",\n      value: function clear() {\n        _classPrivateFieldLooseBase(this, _logger$4)[_logger$4].debug('clear called. Reset flag has been set.');\n\n        _classPrivateFieldLooseBase(this, _deleteUser)[_deleteUser]();\n\n        StorageManager$1.setMetaProp(CLEAR, true);\n      }\n    }, {\n      key: \"push\",\n      value: function push() {\n        for (var _len = arguments.length, profilesArr = new Array(_len), _key = 0; _key < _len; _key++) {\n          profilesArr[_key] = arguments[_key];\n        }\n\n        _classPrivateFieldLooseBase(this, _processLoginArray)[_processLoginArray](profilesArr);\n\n        return 0;\n      }\n    }, {\n      key: \"_processOldValues\",\n      value: function _processOldValues() {\n        if (_classPrivateFieldLooseBase(this, _oldValues$2)[_oldValues$2]) {\n          _classPrivateFieldLooseBase(this, _processLoginArray)[_processLoginArray](_classPrivateFieldLooseBase(this, _oldValues$2)[_oldValues$2]);\n        }\n\n        _classPrivateFieldLooseBase(this, _oldValues$2)[_oldValues$2] = null;\n      }\n    }]);\n\n    return UserLoginHandler;\n  }( /*#__PURE__*/_wrapNativeSuper(Array));\n\n  var _processOUL2 = function _processOUL2(profileArr) {\n    var _this2 = this;\n\n    var sendOULFlag = true;\n    StorageManager$1.saveToLSorCookie(FIRE_PUSH_UNREGISTERED, sendOULFlag);\n\n    var addToK = function addToK(ids) {\n      var k = StorageManager$1.readFromLSorCookie(KCOOKIE_NAME);\n      var g = StorageManager$1.readFromLSorCookie(GCOOKIE_NAME);\n      var kId;\n\n      if (k == null) {\n        k = {};\n        kId = ids;\n      } else {\n        /* check if already exists */\n        kId = k.id;\n        var anonymousUser = false;\n        var foundInCache = false;\n\n        if (kId == null) {\n          kId = ids[0];\n          anonymousUser = true;\n        }\n\n        if ($ct.LRU_CACHE == null && StorageManager$1._isLocalStorageSupported()) {\n          $ct.LRU_CACHE = new LRUCache(LRU_CACHE_SIZE);\n        }\n\n        if (anonymousUser) {\n          if (g != null) {\n            $ct.LRU_CACHE.set(kId, g);\n            $ct.blockRequeust = false;\n          }\n        } else {\n          for (var idx in ids) {\n            if (ids.hasOwnProperty(idx)) {\n              var id = ids[idx];\n\n              if ($ct.LRU_CACHE.cache[id]) {\n                kId = id;\n                foundInCache = true;\n                break;\n              }\n            }\n          }\n        }\n\n        if (foundInCache) {\n          if (kId !== $ct.LRU_CACHE.getLastKey()) {\n            // New User found\n            _classPrivateFieldLooseBase(_this2, _handleCookieFromCache)[_handleCookieFromCache]();\n          } else {\n            sendOULFlag = false;\n            StorageManager$1.saveToLSorCookie(FIRE_PUSH_UNREGISTERED, sendOULFlag);\n          }\n\n          var gFromCache = $ct.LRU_CACHE.get(kId);\n          $ct.LRU_CACHE.set(kId, gFromCache);\n          StorageManager$1.saveToLSorCookie(GCOOKIE_NAME, gFromCache);\n          _classPrivateFieldLooseBase(_this2, _device$1)[_device$1].gcookie = gFromCache;\n          var lastK = $ct.LRU_CACHE.getSecondLastKey();\n\n          if (StorageManager$1.readFromLSorCookie(FIRE_PUSH_UNREGISTERED) && lastK !== -1) {\n            // CACHED OLD USER FOUND. TRANSFER PUSH TOKEN TO THIS USER\n            var lastGUID = $ct.LRU_CACHE.cache[lastK];\n\n            _classPrivateFieldLooseBase(_this2, _request$3)[_request$3].unregisterTokenForGuid(lastGUID);\n          }\n        } else {\n          if (!anonymousUser) {\n            _this2.clear();\n          } else {\n            if (g != null) {\n              _classPrivateFieldLooseBase(_this2, _device$1)[_device$1].gcookie = g;\n              StorageManager$1.saveToLSorCookie(GCOOKIE_NAME, g);\n              sendOULFlag = false;\n            }\n          }\n\n          StorageManager$1.saveToLSorCookie(FIRE_PUSH_UNREGISTERED, false);\n          kId = ids[0];\n        }\n      }\n\n      k.id = kId;\n      StorageManager$1.saveToLSorCookie(KCOOKIE_NAME, k);\n    };\n\n    if (Array.isArray(profileArr) && profileArr.length > 0) {\n      for (var index in profileArr) {\n        if (profileArr.hasOwnProperty(index)) {\n          var outerObj = profileArr[index];\n          var data = {};\n          var profileObj = void 0;\n\n          if (outerObj.Site != null) {\n            // organic data from the site\n            profileObj = outerObj.Site;\n\n            if (isObjectEmpty(profileObj) || !isProfileValid(profileObj, {\n              logger: _classPrivateFieldLooseBase(this, _logger$4)[_logger$4]\n            })) {\n              return;\n            }\n          } else if (outerObj.Facebook != null) {\n            // fb connect data\n            var FbProfileObj = outerObj.Facebook; // make sure that the object contains any data at all\n\n            if (!isObjectEmpty(FbProfileObj) && !FbProfileObj.error) {\n              profileObj = processFBUserObj(FbProfileObj);\n            }\n          } else if (outerObj['Google Plus'] != null) {\n            var GPlusProfileObj = outerObj['Google Plus'];\n\n            if (isObjectEmpty(GPlusProfileObj) && !GPlusProfileObj.error) {\n              profileObj = processGPlusUserObj(GPlusProfileObj, {\n                logger: _classPrivateFieldLooseBase(this, _logger$4)[_logger$4]\n              });\n            }\n          }\n\n          if (profileObj != null && !isObjectEmpty(profileObj)) {\n            // profile got set from above\n            data.type = 'profile';\n\n            if (profileObj.tz == null) {\n              // try to auto capture user timezone if not present\n              profileObj.tz = new Date().toString().match(/([A-Z]+[\\+-][0-9]+)/)[1];\n            }\n\n            data.profile = profileObj;\n            var ids = [];\n\n            if (StorageManager$1._isLocalStorageSupported()) {\n              if (profileObj.Identity != null) {\n                ids.push(profileObj.Identity);\n              }\n\n              if (profileObj.Email != null) {\n                ids.push(profileObj.Email);\n              }\n\n              if (profileObj.GPID != null) {\n                ids.push('GP:' + profileObj.GPID);\n              }\n\n              if (profileObj.FBID != null) {\n                ids.push('FB:' + profileObj.FBID);\n              }\n\n              if (ids.length > 0) {\n                addToK(ids);\n              }\n            }\n\n            addToLocalProfileMap(profileObj, true);\n            data = _classPrivateFieldLooseBase(this, _request$3)[_request$3].addSystemDataToObject(data, undefined);\n\n            _classPrivateFieldLooseBase(this, _request$3)[_request$3].addFlags(data); // Adding 'isOUL' flag in true for OUL cases which.\n            // This flag tells LC to create a new arp object.\n            // Also we will receive the same flag in response arp which tells to delete existing arp object.\n\n\n            if (sendOULFlag) {\n              data[IS_OUL] = true;\n            }\n\n            var compressedData = compressData(JSON.stringify(data), _classPrivateFieldLooseBase(this, _logger$4)[_logger$4]);\n\n            var pageLoadUrl = _classPrivateFieldLooseBase(this, _account$1)[_account$1].dataPostURL;\n\n            pageLoadUrl = addToURL(pageLoadUrl, 'type', EVT_PUSH);\n            pageLoadUrl = addToURL(pageLoadUrl, 'd', compressedData); // Whenever sendOULFlag is true then dont send arp and gcookie (guid in memory in the request)\n            // Also when this flag is set we will get another flag from LC in arp which tells us to delete arp\n            // stored in the cache and replace it with the response arp.\n\n            _classPrivateFieldLooseBase(this, _request$3)[_request$3].saveAndFireRequest(pageLoadUrl, $ct.blockRequeust, sendOULFlag);\n          }\n        }\n      }\n    }\n  };\n\n  var _handleCookieFromCache2 = function _handleCookieFromCache2() {\n    $ct.blockRequeust = false;\n    console.debug('Block request is false');\n\n    if (StorageManager$1._isLocalStorageSupported()) {\n      delete localStorage[PR_COOKIE];\n      delete localStorage[EV_COOKIE];\n      delete localStorage[META_COOKIE];\n      delete localStorage[ARP_COOKIE];\n      delete localStorage[CAMP_COOKIE_NAME];\n      delete localStorage[CHARGEDID_COOKIE_NAME];\n    }\n\n    StorageManager$1.removeCookie(CAMP_COOKIE_NAME, getHostName());\n    StorageManager$1.removeCookie(_classPrivateFieldLooseBase(this, _session$1)[_session$1].cookieName, $ct.broadDomain);\n    StorageManager$1.removeCookie(ARP_COOKIE, $ct.broadDomain);\n\n    _classPrivateFieldLooseBase(this, _session$1)[_session$1].setSessionCookieObject('');\n  };\n\n  var _deleteUser2 = function _deleteUser2() {\n    $ct.blockRequeust = true;\n\n    _classPrivateFieldLooseBase(this, _logger$4)[_logger$4].debug('Block request is true');\n\n    $ct.globalCache = {};\n\n    if (StorageManager$1._isLocalStorageSupported()) {\n      delete localStorage[GCOOKIE_NAME];\n      delete localStorage[KCOOKIE_NAME];\n      delete localStorage[PR_COOKIE];\n      delete localStorage[EV_COOKIE];\n      delete localStorage[META_COOKIE];\n      delete localStorage[ARP_COOKIE];\n      delete localStorage[CAMP_COOKIE_NAME];\n      delete localStorage[CHARGEDID_COOKIE_NAME];\n    }\n\n    StorageManager$1.removeCookie(GCOOKIE_NAME, $ct.broadDomain);\n    StorageManager$1.removeCookie(CAMP_COOKIE_NAME, getHostName());\n    StorageManager$1.removeCookie(KCOOKIE_NAME, getHostName());\n    StorageManager$1.removeCookie(_classPrivateFieldLooseBase(this, _session$1)[_session$1].cookieName, $ct.broadDomain);\n    StorageManager$1.removeCookie(ARP_COOKIE, $ct.broadDomain);\n    _classPrivateFieldLooseBase(this, _device$1)[_device$1].gcookie = null;\n\n    _classPrivateFieldLooseBase(this, _session$1)[_session$1].setSessionCookieObject('');\n  };\n\n  var _processLoginArray2 = function _processLoginArray2(loginArr) {\n    if (Array.isArray(loginArr) && loginArr.length > 0) {\n      var profileObj = loginArr.pop();\n      var processProfile = profileObj != null && isObject(profileObj) && (profileObj.Site != null && Object.keys(profileObj.Site).length > 0 || profileObj.Facebook != null && Object.keys(profileObj.Facebook).length > 0 || profileObj['Google Plus'] != null && Object.keys(profileObj['Google Plus']).length > 0);\n\n      if (processProfile) {\n        StorageManager$1.setInstantDeleteFlagInK();\n\n        try {\n          _classPrivateFieldLooseBase(this, _processOUL)[_processOUL]([profileObj]);\n        } catch (e) {\n          _classPrivateFieldLooseBase(this, _logger$4)[_logger$4].debug(e);\n        }\n      } else {\n        _classPrivateFieldLooseBase(this, _logger$4)[_logger$4].error('Profile object is in incorrect format');\n      }\n    }\n  };\n\n  var _tr = function _tr(msg, _ref) {\n    var device = _ref.device,\n        session = _ref.session,\n        request = _ref.request,\n        logger = _ref.logger;\n    var _device = device;\n    var _session = session;\n    var _request = request;\n    var _logger = logger;\n    var _wizCounter = 0;\n\n    var doCampHouseKeeping = function doCampHouseKeeping(targetingMsgJson) {\n      var campaignId = targetingMsgJson.wzrk_id.split('_')[0];\n      var today = getToday();\n\n      var incrCount = function incrCount(obj, campaignId, excludeFromFreqCaps) {\n        var currentCount = 0;\n        var totalCount = 0;\n\n        if (obj[campaignId] != null) {\n          currentCount = obj[campaignId];\n        }\n\n        currentCount++;\n\n        if (obj.tc != null) {\n          totalCount = obj.tc;\n        } // if exclude from caps then dont add to total counts\n\n\n        if (excludeFromFreqCaps < 0) {\n          totalCount++;\n        }\n\n        obj.tc = totalCount;\n        obj[campaignId] = currentCount;\n      };\n\n      if (StorageManager$1._isLocalStorageSupported()) {\n        delete sessionStorage[CAMP_COOKIE_NAME];\n        var campObj = getCampaignObject(); // global session limit. default is 1\n\n        if (targetingMsgJson[DISPLAY].wmc == null) {\n          targetingMsgJson[DISPLAY].wmc = 1;\n        }\n\n        var excludeFromFreqCaps = -1;\n        var campaignSessionLimit = -1;\n        var campaignDailyLimit = -1;\n        var campaignTotalLimit = -1;\n        var totalDailyLimit = -1;\n        var totalSessionLimit = -1;\n\n        if (targetingMsgJson[DISPLAY].efc != null) {\n          excludeFromFreqCaps = parseInt(targetingMsgJson[DISPLAY].efc, 10);\n        }\n\n        if (targetingMsgJson[DISPLAY].mdc != null) {\n          campaignSessionLimit = parseInt(targetingMsgJson[DISPLAY].mdc, 10);\n        }\n\n        if (targetingMsgJson[DISPLAY].tdc != null) {\n          campaignDailyLimit = parseInt(targetingMsgJson[DISPLAY].tdc, 10);\n        }\n\n        if (targetingMsgJson[DISPLAY].tlc != null) {\n          campaignTotalLimit = parseInt(targetingMsgJson[DISPLAY].tlc, 10);\n        }\n\n        if (targetingMsgJson[DISPLAY].wmp != null) {\n          totalDailyLimit = parseInt(targetingMsgJson[DISPLAY].wmp, 10);\n        }\n\n        if (targetingMsgJson[DISPLAY].wmc != null) {\n          totalSessionLimit = parseInt(targetingMsgJson[DISPLAY].wmc, 10);\n        } // session level capping\n\n\n        var _sessionObj = campObj[_session.sessionId];\n\n        if (_sessionObj) {\n          var campaignSessionCount = _sessionObj[campaignId];\n          var totalSessionCount = _sessionObj.tc; // dnd\n\n          if (campaignSessionCount === 'dnd') {\n            return false;\n          } // session\n\n\n          if (totalSessionLimit > 0 && totalSessionCount >= totalSessionLimit && excludeFromFreqCaps < 0) {\n            return false;\n          } // campaign session\n\n\n          if (campaignSessionLimit > 0 && campaignSessionCount >= campaignSessionLimit) {\n            return false;\n          }\n        } else {\n          _sessionObj = {};\n          campObj[_session.sessionId] = _sessionObj;\n        } // daily level capping\n\n\n        var dailyObj = campObj[today];\n\n        if (dailyObj != null) {\n          var campaignDailyCount = dailyObj[campaignId];\n          var totalDailyCount = dailyObj.tc; // daily\n\n          if (totalDailyLimit > 0 && totalDailyCount >= totalDailyLimit && excludeFromFreqCaps < 0) {\n            return false;\n          } // campaign daily\n\n\n          if (campaignDailyLimit > 0 && campaignDailyCount >= campaignDailyLimit) {\n            return false;\n          }\n        } else {\n          dailyObj = {};\n          campObj[today] = dailyObj;\n        }\n\n        var globalObj = campObj[GLOBAL];\n\n        if (globalObj != null) {\n          var campaignTotalCount = globalObj[campaignId]; // campaign total\n\n          if (campaignTotalLimit > 0 && campaignTotalCount >= campaignTotalLimit) {\n            return false;\n          }\n        } else {\n          globalObj = {};\n          campObj[GLOBAL] = globalObj;\n        }\n      } // delay\n\n\n      if (targetingMsgJson[DISPLAY].delay != null && targetingMsgJson[DISPLAY].delay > 0) {\n        var delay = targetingMsgJson[DISPLAY].delay;\n        targetingMsgJson[DISPLAY].delay = 0;\n        setTimeout(_tr, delay * 1000, msg, {\n          device: _device,\n          session: _session,\n          request: _request,\n          logger: _logger\n        });\n        return false;\n      }\n\n      var sessionObj = _session.getSessionCookieObject();\n\n      incrCount(sessionObj, campaignId, excludeFromFreqCaps);\n      incrCount(dailyObj, campaignId, excludeFromFreqCaps);\n      incrCount(globalObj, campaignId, excludeFromFreqCaps); // get ride of stale sessions and day entries\n\n      var newCampObj = {};\n      newCampObj[_session.sessionId] = sessionObj;\n      newCampObj[today] = dailyObj;\n      newCampObj[GLOBAL] = globalObj;\n      saveCampaignObject(newCampObj);\n    };\n\n    var getCookieParams = function getCookieParams() {\n      var gcookie = _device.getGuid();\n\n      var scookieObj = _session.getSessionCookieObject();\n\n      return '&t=wc&d=' + encodeURIComponent(compressToBase64(gcookie + '|' + scookieObj.p + '|' + scookieObj.s));\n    };\n\n    var setupClickEvent = function setupClickEvent(onClick, targetingMsgJson, contentDiv, divId, isLegacy) {\n      if (onClick !== '' && onClick != null) {\n        var ctaElement;\n        var jsCTAElements;\n\n        if (isLegacy) {\n          ctaElement = contentDiv;\n        } else {\n          jsCTAElements = contentDiv.getElementsByClassName('jsCT_CTA');\n\n          if (jsCTAElements != null && jsCTAElements.length === 1) {\n            ctaElement = jsCTAElements[0];\n          }\n        }\n\n        var jsFunc = targetingMsgJson.display.jsFunc;\n        var isPreview = targetingMsgJson.display.preview;\n\n        if (isPreview == null) {\n          onClick += getCookieParams();\n        }\n\n        if (ctaElement != null) {\n          ctaElement.onclick = function () {\n            // invoke js function call\n            if (jsFunc != null) {\n              // track notification clicked event\n              if (isPreview == null) {\n                RequestDispatcher.fireRequest(onClick);\n              }\n\n              invokeExternalJs(jsFunc, targetingMsgJson); // close iframe. using -1 for no campaignId\n\n              closeIframe('-1', divId, _session.sessionId);\n              return;\n            } // pass on the gcookie|page|scookieId for capturing the click event\n\n\n            if (targetingMsgJson.display.window === 1) {\n              window.open(onClick, '_blank');\n            } else {\n              window.location = onClick;\n            }\n          };\n        }\n      }\n    };\n\n    var invokeExternalJs = function invokeExternalJs(jsFunc, targetingMsgJson) {\n      var func = window.parent[jsFunc];\n\n      if (typeof func === 'function') {\n        if (targetingMsgJson.display.kv != null) {\n          func(targetingMsgJson.display.kv);\n        } else {\n          func();\n        }\n      }\n    };\n\n    var setupClickUrl = function setupClickUrl(onClick, targetingMsgJson, contentDiv, divId, isLegacy) {\n      incrementImpression(targetingMsgJson);\n      setupClickEvent(onClick, targetingMsgJson, contentDiv, divId, isLegacy);\n    };\n\n    var incrementImpression = function incrementImpression(targetingMsgJson) {\n      var data = {};\n      data.type = 'event';\n      data.evtName = NOTIFICATION_VIEWED;\n      data.evtData = _defineProperty({}, WZRK_ID, targetingMsgJson.wzrk_id);\n\n      _request.processEvent(data);\n    };\n\n    var renderFooterNotification = function renderFooterNotification(targetingMsgJson) {\n      var campaignId = targetingMsgJson.wzrk_id.split('_')[0];\n      var displayObj = targetingMsgJson.display;\n\n      if (displayObj.layout === 1) {\n        return showExitIntent(undefined, targetingMsgJson);\n      }\n\n      if (doCampHouseKeeping(targetingMsgJson) === false) {\n        return;\n      }\n\n      var divId = 'wizParDiv' + displayObj.layout;\n\n      if (document.getElementById(divId) != null) {\n        return;\n      }\n\n      $ct.campaignDivMap[campaignId] = divId;\n      var isBanner = displayObj.layout === 2;\n      var msgDiv = document.createElement('div');\n      msgDiv.id = divId;\n      var viewHeight = window.innerHeight;\n      var viewWidth = window.innerWidth;\n      var legacy = false;\n\n      if (!isBanner) {\n        var marginBottom = viewHeight * 5 / 100;\n        var contentHeight = 10;\n        var right = viewWidth * 5 / 100;\n        var bottomPosition = contentHeight + marginBottom;\n        var width = viewWidth * 30 / 100 + 20;\n        var widthPerct = 'width:30%;'; // for small devices  - mobile phones\n\n        if ((/mobile/i.test(navigator.userAgent) || /mini/i.test(navigator.userAgent)) && /iPad/i.test(navigator.userAgent) === false) {\n          width = viewWidth * 85 / 100 + 20;\n          right = viewWidth * 5 / 100;\n          bottomPosition = viewHeight * 5 / 100;\n          widthPerct = 'width:80%;'; // medium devices - tablets\n        } else if ('ontouchstart' in window || /tablet/i.test(navigator.userAgent)) {\n          width = viewWidth * 50 / 100 + 20;\n          right = viewWidth * 5 / 100;\n          bottomPosition = viewHeight * 5 / 100;\n          widthPerct = 'width:50%;';\n        } // legacy footer notif\n\n\n        if (displayObj.proto == null) {\n          legacy = true;\n          msgDiv.setAttribute('style', 'display:block;overflow:hidden; bottom:' + bottomPosition + 'px !important;width:' + width + 'px !important;right:' + right + 'px !important;position:fixed;z-index:2147483647;');\n        } else {\n          msgDiv.setAttribute('style', widthPerct + displayObj.iFrameStyle);\n        }\n      } else {\n        msgDiv.setAttribute('style', displayObj.iFrameStyle);\n      }\n\n      document.body.appendChild(msgDiv);\n      var iframe = document.createElement('iframe');\n      var borderRadius = displayObj.br === false ? '0' : '8';\n      iframe.frameborder = '0px';\n      iframe.marginheight = '0px';\n      iframe.marginwidth = '0px';\n      iframe.scrolling = 'no';\n      iframe.id = 'wiz-iframe';\n      var onClick = targetingMsgJson.display.onClick;\n      var pointerCss = '';\n\n      if (onClick !== '' && onClick != null) {\n        pointerCss = 'cursor:pointer;';\n      }\n\n      var html; // direct html\n\n      if (targetingMsgJson.msgContent.type === 1) {\n        html = targetingMsgJson.msgContent.html;\n        html = html.replace(/##campaignId##/g, campaignId);\n      } else {\n        var css = '' + '<style type=\"text/css\">' + 'body{margin:0;padding:0;}' + '#contentDiv.wzrk{overflow:hidden;padding:0;text-align:center;' + pointerCss + '}' + '#contentDiv.wzrk td{padding:15px 10px;}' + '.wzrkPPtitle{font-weight: bold;font-size: 16px;font-family:arial;padding-bottom:10px;word-break: break-word;}' + '.wzrkPPdscr{font-size: 14px;font-family:arial;line-height:16px;word-break: break-word;display:inline-block;}' + '.PL15{padding-left:15px;}' + '.wzrkPPwarp{margin:20px 20px 0 5px;padding:0px;border-radius: ' + borderRadius + 'px;box-shadow: 1px 1px 5px #888888;}' + 'a.wzrkClose{cursor:pointer;position: absolute;top: 11px;right: 11px;z-index: 2147483647;font-size:19px;font-family:arial;font-weight:bold;text-decoration: none;width: 25px;/*height: 25px;*/text-align: center; -webkit-appearance: none; line-height: 25px;' + 'background: #353535;border: #fff 2px solid;border-radius: 100%;box-shadow: #777 2px 2px 2px;color:#fff;}' + 'a:hover.wzrkClose{background-color:#d1914a !important;color:#fff !important; -webkit-appearance: none;}' + 'td{vertical-align:top;}' + 'td.imgTd{border-top-left-radius:8px;border-bottom-left-radius:8px;}' + '</style>';\n        var bgColor, textColor, btnBg, leftTd, btColor;\n\n        if (targetingMsgJson.display.theme === 'dark') {\n          bgColor = '#2d2d2e';\n          textColor = '#eaeaea';\n          btnBg = '#353535';\n          leftTd = '#353535';\n          btColor = '#ffffff';\n        } else {\n          bgColor = '#ffffff';\n          textColor = '#000000';\n          leftTd = '#f4f4f4';\n          btnBg = '#a5a6a6';\n          btColor = '#ffffff';\n        }\n\n        var titleText = targetingMsgJson.msgContent.title;\n        var descriptionText = targetingMsgJson.msgContent.description;\n        var imageTd = '';\n\n        if (targetingMsgJson.msgContent.imageUrl != null && targetingMsgJson.msgContent.imageUrl !== '') {\n          imageTd = \"<td class='imgTd' style='background-color:\" + leftTd + \"'><img src='\" + targetingMsgJson.msgContent.imageUrl + \"' height='60' width='60'></td>\";\n        }\n\n        var onClickStr = 'parent.$WZRK_WR.closeIframe(' + campaignId + \",'\" + divId + \"');\";\n        var title = \"<div class='wzrkPPwarp' style='color:\" + textColor + ';background-color:' + bgColor + \";'>\" + \"<a href='javascript:void(0);' onclick=\" + onClickStr + \" class='wzrkClose' style='background-color:\" + btnBg + ';color:' + btColor + \"'>&times;</a>\" + \"<div id='contentDiv' class='wzrk'>\" + \"<table cellpadding='0' cellspacing='0' border='0'>\" + // \"<tr><td colspan='2'></td></tr>\"+\n        '<tr>' + imageTd + \"<td style='vertical-align:top;'>\" + \"<div class='wzrkPPtitle' style='color:\" + textColor + \"'>\" + titleText + '</div>';\n        var body = \"<div class='wzrkPPdscr' style='color:\" + textColor + \"'>\" + descriptionText + '<div></td></tr></table></div>';\n        html = css + title + body;\n      }\n\n      iframe.setAttribute('style', 'z-index: 2147483647; display:block; width: 100% !important; border:0px !important; border-color:none !important;');\n      msgDiv.appendChild(iframe);\n      var ifrm = iframe.contentWindow ? iframe.contentWindow : iframe.contentDocument.document ? iframe.contentDocument.document : iframe.contentDocument;\n      var doc = ifrm.document;\n      doc.open();\n      doc.write(html);\n      doc.close();\n\n      var adjustIFrameHeight = function adjustIFrameHeight() {\n        // adjust iframe and body height of html inside correctly\n        contentHeight = document.getElementById('wiz-iframe').contentDocument.getElementById('contentDiv').scrollHeight;\n\n        if (displayObj['custom-editor'] !== true && !isBanner) {\n          contentHeight += 25;\n        }\n\n        document.getElementById('wiz-iframe').contentDocument.body.style.margin = '0px';\n        document.getElementById('wiz-iframe').style.height = contentHeight + 'px';\n      };\n\n      var ua = navigator.userAgent.toLowerCase();\n\n      if (ua.indexOf('safari') !== -1) {\n        if (ua.indexOf('chrome') > -1) {\n          iframe.onload = function () {\n            adjustIFrameHeight();\n            var contentDiv = document.getElementById('wiz-iframe').contentDocument.getElementById('contentDiv');\n            setupClickUrl(onClick, targetingMsgJson, contentDiv, divId, legacy);\n          };\n        } else {\n          var inDoc = iframe.contentDocument || iframe.contentWindow;\n          if (inDoc.document) inDoc = inDoc.document; // safari iphone 7+ needs this.\n\n          adjustIFrameHeight();\n\n          var _timer = setInterval(function () {\n            if (inDoc.readyState === 'complete') {\n              clearInterval(_timer); // adjust iframe and body height of html inside correctly\n\n              adjustIFrameHeight();\n              var contentDiv = document.getElementById('wiz-iframe').contentDocument.getElementById('contentDiv');\n              setupClickUrl(onClick, targetingMsgJson, contentDiv, divId, legacy);\n            }\n          }, 10);\n        }\n      } else {\n        iframe.onload = function () {\n          // adjust iframe and body height of html inside correctly\n          adjustIFrameHeight();\n          var contentDiv = document.getElementById('wiz-iframe').contentDocument.getElementById('contentDiv');\n          setupClickUrl(onClick, targetingMsgJson, contentDiv, divId, legacy);\n        };\n      }\n    };\n\n    var _callBackCalled = false;\n\n    var showFooterNotification = function showFooterNotification(targetingMsgJson) {\n      var onClick = targetingMsgJson.display.onClick; // TODO: Needs wizrocket as a global variable\n\n      if (window.clevertap.hasOwnProperty('notificationCallback') && typeof window.clevertap.notificationCallback !== 'undefined' && typeof window.clevertap.notificationCallback === 'function') {\n        var notificationCallback = window.clevertap.notificationCallback;\n\n        if (!_callBackCalled) {\n          var inaObj = {};\n          inaObj.msgContent = targetingMsgJson.msgContent;\n          inaObj.msgId = targetingMsgJson.wzrk_id;\n\n          if (targetingMsgJson.display.kv != null) {\n            inaObj.kv = targetingMsgJson.display.kv;\n          }\n\n          window.clevertap.raiseNotificationClicked = function () {\n            if (onClick !== '' && onClick != null) {\n              var jsFunc = targetingMsgJson.display.jsFunc;\n              onClick += getCookieParams(); // invoke js function call\n\n              if (jsFunc != null) {\n                // track notification clicked event\n                RequestDispatcher.fireRequest(onClick);\n                invokeExternalJs(jsFunc, targetingMsgJson);\n                return;\n              } // pass on the gcookie|page|scookieId for capturing the click event\n\n\n              if (targetingMsgJson.display.window === 1) {\n                window.open(onClick, '_blank');\n              } else {\n                window.location = onClick;\n              }\n            }\n          };\n\n          window.clevertap.raiseNotificationViewed = function () {\n            incrementImpression(targetingMsgJson);\n          };\n\n          notificationCallback(inaObj);\n          _callBackCalled = true;\n        }\n      } else {\n        renderFooterNotification(targetingMsgJson);\n\n        if (window.clevertap.hasOwnProperty('popupCallback') && typeof window.clevertap.popupCallback !== 'undefined' && typeof window.clevertap.popupCallback === 'function') {\n          var popupCallback = window.clevertap.popupCallback;\n          var _inaObj = {};\n          _inaObj.msgContent = targetingMsgJson.msgContent;\n          _inaObj.msgId = targetingMsgJson.wzrk_id;\n          var msgCTkv = [];\n\n          for (var wzrkPrefixKey in targetingMsgJson) {\n            // ADD WZRK PREFIX KEY VALUE PAIRS\n            if (wzrkPrefixKey.startsWith(WZRK_PREFIX) && wzrkPrefixKey !== WZRK_ID) {\n              var wzrkJson = _defineProperty({}, wzrkPrefixKey, targetingMsgJson[wzrkPrefixKey]);\n\n              msgCTkv.push(wzrkJson);\n            }\n          }\n\n          if (msgCTkv.length > 0) {\n            _inaObj.msgCTkv = msgCTkv;\n          }\n\n          if (targetingMsgJson.display.kv != null) {\n            _inaObj.kv = targetingMsgJson.display.kv;\n          } // PUBLIC API TO RECORD CLICKED EVENT\n\n\n          window.clevertap.raisePopupNotificationClicked = function (notificationData) {\n            if (!notificationData || !notificationData.msgId) {\n              return;\n            }\n\n            var eventData = {};\n            eventData.type = 'event';\n            eventData.evtName = NOTIFICATION_CLICKED;\n            eventData.evtData = _defineProperty({}, WZRK_ID, notificationData.msgId); // WZRK PREFIX KEY VALUE PAIRS\n\n            if (notificationData.msgCTkv) {\n              var _iterator = _createForOfIteratorHelper(notificationData.msgCTkv),\n                  _step;\n\n              try {\n                for (_iterator.s(); !(_step = _iterator.n()).done;) {\n                  var wzrkPrefixObj = _step.value;\n                  eventData.evtData = _objectSpread2(_objectSpread2({}, eventData.evtData), wzrkPrefixObj);\n                }\n              } catch (err) {\n                _iterator.e(err);\n              } finally {\n                _iterator.f();\n              }\n            }\n\n            _request.processEvent(eventData);\n          };\n\n          popupCallback(_inaObj);\n        }\n      }\n    };\n\n    var exitintentObj;\n\n    var showExitIntent = function showExitIntent(event, targetObj) {\n      var targetingMsgJson;\n\n      if (event != null && event.clientY > 0) {\n        return;\n      }\n\n      if (targetObj == null) {\n        targetingMsgJson = exitintentObj;\n      } else {\n        targetingMsgJson = targetObj;\n      }\n\n      if (document.getElementById('intentPreview') != null) {\n        return;\n      } // dont show exit intent on tablet/mobile - only on desktop\n\n\n      if (targetingMsgJson.display.layout == null && (/mobile/i.test(navigator.userAgent) || /mini/i.test(navigator.userAgent) || /iPad/i.test(navigator.userAgent) || 'ontouchstart' in window || /tablet/i.test(navigator.userAgent))) {\n        return;\n      }\n\n      var campaignId = targetingMsgJson.wzrk_id.split('_')[0];\n\n      if (doCampHouseKeeping(targetingMsgJson) === false) {\n        return;\n      }\n\n      $ct.campaignDivMap[campaignId] = 'intentPreview';\n      var legacy = false;\n      var opacityDiv = document.createElement('div');\n      opacityDiv.id = 'intentOpacityDiv';\n      opacityDiv.setAttribute('style', 'position: fixed;top: 0;bottom: 0;left: 0;width: 100%;height: 100%;z-index: 2147483646;background: rgba(0,0,0,0.7);');\n      document.body.appendChild(opacityDiv);\n      var msgDiv = document.createElement('div');\n      msgDiv.id = 'intentPreview';\n\n      if (targetingMsgJson.display.proto == null) {\n        legacy = true;\n        msgDiv.setAttribute('style', 'display:block;overflow:hidden;top:55% !important;left:50% !important;position:fixed;z-index:2147483647;width:600px !important;height:600px !important;margin:-300px 0 0 -300px !important;');\n      } else {\n        msgDiv.setAttribute('style', targetingMsgJson.display.iFrameStyle);\n      }\n\n      document.body.appendChild(msgDiv);\n      var iframe = document.createElement('iframe');\n      var borderRadius = targetingMsgJson.display.br === false ? '0' : '8';\n      iframe.frameborder = '0px';\n      iframe.marginheight = '0px';\n      iframe.marginwidth = '0px';\n      iframe.scrolling = 'no';\n      iframe.id = 'wiz-iframe-intent';\n      var onClick = targetingMsgJson.display.onClick;\n      var pointerCss = '';\n\n      if (onClick !== '' && onClick != null) {\n        pointerCss = 'cursor:pointer;';\n      }\n\n      var html; // direct html\n\n      if (targetingMsgJson.msgContent.type === 1) {\n        html = targetingMsgJson.msgContent.html;\n        html = html.replace(/##campaignId##/g, campaignId);\n      } else {\n        var css = '' + '<style type=\"text/css\">' + 'body{margin:0;padding:0;}' + '#contentDiv.wzrk{overflow:hidden;padding:0 0 20px 0;text-align:center;' + pointerCss + '}' + '#contentDiv.wzrk td{padding:15px 10px;}' + '.wzrkPPtitle{font-weight: bold;font-size: 24px;font-family:arial;word-break: break-word;padding-top:20px;}' + '.wzrkPPdscr{font-size: 14px;font-family:arial;line-height:16px;word-break: break-word;display:inline-block;padding:20px 20px 0 20px;line-height:20px;}' + '.PL15{padding-left:15px;}' + '.wzrkPPwarp{margin:20px 20px 0 5px;padding:0px;border-radius: ' + borderRadius + 'px;box-shadow: 1px 1px 5px #888888;}' + 'a.wzrkClose{cursor:pointer;position: absolute;top: 11px;right: 11px;z-index: 2147483647;font-size:19px;font-family:arial;font-weight:bold;text-decoration: none;width: 25px;/*height: 25px;*/text-align: center; -webkit-appearance: none; line-height: 25px;' + 'background: #353535;border: #fff 2px solid;border-radius: 100%;box-shadow: #777 2px 2px 2px;color:#fff;}' + 'a:hover.wzrkClose{background-color:#d1914a !important;color:#fff !important; -webkit-appearance: none;}' + '#contentDiv .button{padding-top:20px;}' + '#contentDiv .button a{font-size: 14px;font-weight:bold;font-family:arial;text-align:center;display:inline-block;text-decoration:none;padding:0 30px;height:40px;line-height:40px;background:#ea693b;color:#fff;border-radius:4px;-webkit-border-radius:4px;-moz-border-radius:4px;}' + '</style>';\n        var bgColor, textColor, btnBg, btColor;\n\n        if (targetingMsgJson.display.theme === 'dark') {\n          bgColor = '#2d2d2e';\n          textColor = '#eaeaea';\n          btnBg = '#353535';\n          btColor = '#ffffff';\n        } else {\n          bgColor = '#ffffff';\n          textColor = '#000000';\n          btnBg = '#a5a6a6';\n          btColor = '#ffffff';\n        }\n\n        var titleText = targetingMsgJson.msgContent.title;\n        var descriptionText = targetingMsgJson.msgContent.description;\n        var ctaText = '';\n\n        if (targetingMsgJson.msgContent.ctaText != null && targetingMsgJson.msgContent.ctaText !== '') {\n          ctaText = \"<div class='button'><a href='#'>\" + targetingMsgJson.msgContent.ctaText + '</a></div>';\n        }\n\n        var imageTd = '';\n\n        if (targetingMsgJson.msgContent.imageUrl != null && targetingMsgJson.msgContent.imageUrl !== '') {\n          imageTd = \"<div style='padding-top:20px;'><img src='\" + targetingMsgJson.msgContent.imageUrl + \"' width='500' alt=\" + titleText + ' /></div>';\n        }\n\n        var onClickStr = 'parent.$WZRK_WR.closeIframe(' + campaignId + \",'intentPreview');\";\n        var title = \"<div class='wzrkPPwarp' style='color:\" + textColor + ';background-color:' + bgColor + \";'>\" + \"<a href='javascript:void(0);' onclick=\" + onClickStr + \" class='wzrkClose' style='background-color:\" + btnBg + ';color:' + btColor + \"'>&times;</a>\" + \"<div id='contentDiv' class='wzrk'>\" + \"<div class='wzrkPPtitle' style='color:\" + textColor + \"'>\" + titleText + '</div>';\n        var body = \"<div class='wzrkPPdscr' style='color:\" + textColor + \"'>\" + descriptionText + '</div>' + imageTd + ctaText + '</div></div>';\n        html = css + title + body;\n      }\n\n      iframe.setAttribute('style', 'z-index: 2147483647; display:block; height: 100% !important; width: 100% !important;min-height:80px !important;border:0px !important; border-color:none !important;');\n      msgDiv.appendChild(iframe);\n      var ifrm = iframe.contentWindow ? iframe.contentWindow : iframe.contentDocument.document ? iframe.contentDocument.document : iframe.contentDocument;\n      var doc = ifrm.document;\n      doc.open();\n      doc.write(html);\n      doc.close();\n      var contentDiv = document.getElementById('wiz-iframe-intent').contentDocument.getElementById('contentDiv');\n      setupClickUrl(onClick, targetingMsgJson, contentDiv, 'intentPreview', legacy);\n    };\n\n    if (!document.body) {\n      if (_wizCounter < 6) {\n        _wizCounter++;\n        setTimeout(_tr, 1000, msg, {\n          device: _device,\n          session: _session,\n          request: _request,\n          logger: _logger\n        });\n      }\n\n      return;\n    }\n\n    if (msg.inapp_notifs != null) {\n      for (var index = 0; index < msg.inapp_notifs.length; index++) {\n        var targetNotif = msg.inapp_notifs[index];\n\n        if (targetNotif.display.wtarget_type == null || targetNotif.display.wtarget_type === 0) {\n          showFooterNotification(targetNotif);\n        } else if (targetNotif.display.wtarget_type === 1) {\n          // if display['wtarget_type']==1 then exit intent\n          exitintentObj = targetNotif;\n          window.document.body.onmouseleave = showExitIntent;\n        }\n      }\n    }\n\n    var mergeEventMap = function mergeEventMap(newEvtMap) {\n      if ($ct.globalEventsMap == null) {\n        $ct.globalEventsMap = StorageManager$1.readFromLSorCookie(EV_COOKIE);\n\n        if ($ct.globalEventsMap == null) {\n          $ct.globalEventsMap = newEvtMap;\n          return;\n        }\n      }\n\n      for (var key in newEvtMap) {\n        if (newEvtMap.hasOwnProperty(key)) {\n          var oldEvtObj = $ct.globalEventsMap[key];\n          var newEvtObj = newEvtMap[key];\n\n          if ($ct.globalEventsMap[key] != null) {\n            if (newEvtObj[0] != null && newEvtObj[0] > oldEvtObj[0]) {\n              $ct.globalEventsMap[key] = newEvtObj;\n            }\n          } else {\n            $ct.globalEventsMap[key] = newEvtObj;\n          }\n        }\n      }\n    };\n\n    if (StorageManager$1._isLocalStorageSupported()) {\n      try {\n        if (msg.evpr != null) {\n          var eventsMap = msg.evpr.events;\n          var profileMap = msg.evpr.profile;\n          var syncExpiry = msg.evpr.expires_in;\n          var now = getNow();\n          StorageManager$1.setMetaProp('lsTime', now);\n          StorageManager$1.setMetaProp('exTs', syncExpiry);\n          mergeEventMap(eventsMap);\n          StorageManager$1.saveToLSorCookie(EV_COOKIE, $ct.globalEventsMap);\n\n          if ($ct.globalProfileMap == null) {\n            addToLocalProfileMap(profileMap, true);\n          } else {\n            addToLocalProfileMap(profileMap, false);\n          }\n        }\n\n        if (msg.arp != null) {\n          arp(msg.arp);\n        }\n\n        if (msg.inapp_stale != null) {\n          var campObj = getCampaignObject();\n          var globalObj = campObj.global;\n\n          if (globalObj != null) {\n            for (var idx in msg.inapp_stale) {\n              if (msg.inapp_stale.hasOwnProperty(idx)) {\n                delete globalObj[msg.inapp_stale[idx]];\n              }\n            }\n          }\n\n          saveCampaignObject(campObj);\n        }\n      } catch (e) {\n        _logger.error('Unable to persist evrp/arp: ' + e);\n      }\n    }\n  };\n\n  var _isPersonalisationActive$2 = _classPrivateFieldLooseKey(\"isPersonalisationActive\");\n\n  var User = /*#__PURE__*/function () {\n    function User(_ref) {\n      var isPersonalisationActive = _ref.isPersonalisationActive;\n\n      _classCallCheck(this, User);\n\n      Object.defineProperty(this, _isPersonalisationActive$2, {\n        writable: true,\n        value: void 0\n      });\n      _classPrivateFieldLooseBase(this, _isPersonalisationActive$2)[_isPersonalisationActive$2] = isPersonalisationActive;\n    }\n\n    _createClass(User, [{\n      key: \"getTotalVisits\",\n      value: function getTotalVisits() {\n        if (!_classPrivateFieldLooseBase(this, _isPersonalisationActive$2)[_isPersonalisationActive$2]()) {\n          return;\n        }\n\n        var visitCount = StorageManager$1.getMetaProp('sc');\n\n        if (visitCount == null) {\n          visitCount = 1;\n        }\n\n        return visitCount;\n      }\n    }, {\n      key: \"getLastVisit\",\n      value: function getLastVisit() {\n        if (!_classPrivateFieldLooseBase(this, _isPersonalisationActive$2)[_isPersonalisationActive$2]()) {\n          return;\n        }\n\n        var prevSession = StorageManager$1.getMetaProp('ps');\n\n        if (prevSession != null) {\n          return new Date(prevSession * 1000);\n        }\n      }\n    }]);\n\n    return User;\n  }();\n\n  var logLevels = {\n    DISABLE: 0,\n    ERROR: 1,\n    INFO: 2,\n    DEBUG: 3\n  };\n\n  var _logLevel = _classPrivateFieldLooseKey(\"logLevel\");\n\n  var _log = _classPrivateFieldLooseKey(\"log\");\n\n  var _isLegacyDebug = _classPrivateFieldLooseKey(\"isLegacyDebug\");\n\n  var Logger = /*#__PURE__*/function () {\n    function Logger(logLevel) {\n      _classCallCheck(this, Logger);\n\n      Object.defineProperty(this, _isLegacyDebug, {\n        get: _get_isLegacyDebug,\n        set: void 0\n      });\n      Object.defineProperty(this, _log, {\n        value: _log2\n      });\n      Object.defineProperty(this, _logLevel, {\n        writable: true,\n        value: void 0\n      });\n      this.wzrkError = {};\n      _classPrivateFieldLooseBase(this, _logLevel)[_logLevel] = logLevel == null ? logLevel : logLevels.INFO;\n      this.wzrkError = {};\n    }\n\n    _createClass(Logger, [{\n      key: \"error\",\n      value: function error(message) {\n        if (_classPrivateFieldLooseBase(this, _logLevel)[_logLevel] >= logLevels.ERROR) {\n          _classPrivateFieldLooseBase(this, _log)[_log]('error', message);\n        }\n      }\n    }, {\n      key: \"info\",\n      value: function info(message) {\n        if (_classPrivateFieldLooseBase(this, _logLevel)[_logLevel] >= logLevels.INFO) {\n          _classPrivateFieldLooseBase(this, _log)[_log]('log', message);\n        }\n      }\n    }, {\n      key: \"debug\",\n      value: function debug(message) {\n        if (_classPrivateFieldLooseBase(this, _logLevel)[_logLevel] >= logLevels.DEBUG || _classPrivateFieldLooseBase(this, _isLegacyDebug)[_isLegacyDebug]) {\n          _classPrivateFieldLooseBase(this, _log)[_log]('debug', message);\n        }\n      }\n    }, {\n      key: \"reportError\",\n      value: function reportError(code, description) {\n        this.wzrkError.c = code;\n        this.wzrkError.d = description;\n        this.error(\"\".concat(CLEVERTAP_ERROR_PREFIX, \" \").concat(code, \": \").concat(description));\n      }\n    }, {\n      key: \"logLevel\",\n      get: function get() {\n        return _classPrivateFieldLooseBase(this, _logLevel)[_logLevel];\n      },\n      set: function set(logLevel) {\n        _classPrivateFieldLooseBase(this, _logLevel)[_logLevel] = logLevel;\n      }\n    }]);\n\n    return Logger;\n  }();\n\n  var _log2 = function _log2(level, message) {\n    if (window.console) {\n      try {\n        var ts = new Date().getTime();\n        console[level](\"CleverTap [\".concat(ts, \"]: \").concat(message));\n      } catch (e) {}\n    }\n  };\n\n  var _get_isLegacyDebug = function _get_isLegacyDebug() {\n    return typeof sessionStorage !== 'undefined' && sessionStorage.WZRK_D === '';\n  };\n\n  var _logger$5 = _classPrivateFieldLooseKey(\"logger\");\n\n  var _sessionId = _classPrivateFieldLooseKey(\"sessionId\");\n\n  var _isPersonalisationActive$3 = _classPrivateFieldLooseKey(\"isPersonalisationActive\");\n\n  var SessionManager = /*#__PURE__*/function () {\n    // SCOOKIE_NAME\n    function SessionManager(_ref) {\n      var logger = _ref.logger,\n          isPersonalisationActive = _ref.isPersonalisationActive;\n\n      _classCallCheck(this, SessionManager);\n\n      Object.defineProperty(this, _logger$5, {\n        writable: true,\n        value: void 0\n      });\n      Object.defineProperty(this, _sessionId, {\n        writable: true,\n        value: void 0\n      });\n      Object.defineProperty(this, _isPersonalisationActive$3, {\n        writable: true,\n        value: void 0\n      });\n      this.cookieName = void 0;\n      this.scookieObj = void 0;\n      this.sessionId = StorageManager$1.getMetaProp('cs');\n      _classPrivateFieldLooseBase(this, _logger$5)[_logger$5] = logger;\n      _classPrivateFieldLooseBase(this, _isPersonalisationActive$3)[_isPersonalisationActive$3] = isPersonalisationActive;\n    }\n\n    _createClass(SessionManager, [{\n      key: \"getSessionCookieObject\",\n      value: function getSessionCookieObject() {\n        var scookieStr = StorageManager$1.readCookie(this.cookieName);\n        var obj = {};\n\n        if (scookieStr != null) {\n          // converting back single quotes to double for JSON parsing - http://www.iandevlin.com/blog/2012/04/html5/cookies-json-localstorage-and-opera\n          scookieStr = scookieStr.replace(singleQuoteRegex, '\"');\n          obj = JSON.parse(scookieStr);\n\n          if (!isObject(obj)) {\n            obj = {};\n          } else {\n            if (typeof obj.t !== 'undefined') {\n              // check time elapsed since last request\n              var lastTime = obj.t;\n              var now = getNow();\n\n              if (now - lastTime > SCOOKIE_EXP_TIME_IN_SECS + 60) {\n                // adding 60 seconds to compensate for in-journey requests\n                // ideally the cookie should've died after SCOOKIE_EXP_TIME_IN_SECS but it's still around as we can read\n                // hence we shouldn't use it.\n                obj = {};\n              }\n            }\n          }\n        }\n\n        this.scookieObj = obj;\n        return obj;\n      }\n    }, {\n      key: \"setSessionCookieObject\",\n      value: function setSessionCookieObject(obj) {\n        var objStr = JSON.stringify(obj);\n        StorageManager$1.createBroadCookie(this.cookieName, objStr, SCOOKIE_EXP_TIME_IN_SECS, getHostName());\n      }\n    }, {\n      key: \"manageSession\",\n      value: function manageSession(session) {\n        // first time. check if current session id in localstorage is same\n        // if not same then prev = current and current = this new session\n        if (typeof this.sessionId === 'undefined' || this.sessionId !== session) {\n          var currentSessionInLS = StorageManager$1.getMetaProp('cs'); // if sessionId in meta is undefined - set current to both\n\n          if (typeof currentSessionInLS === 'undefined') {\n            StorageManager$1.setMetaProp('ps', session);\n            StorageManager$1.setMetaProp('cs', session);\n            StorageManager$1.setMetaProp('sc', 1);\n          } else if (currentSessionInLS !== session) {\n            // not same as session in local storage. new session\n            StorageManager$1.setMetaProp('ps', currentSessionInLS);\n            StorageManager$1.setMetaProp('cs', session);\n            var sessionCount = StorageManager$1.getMetaProp('sc');\n\n            if (typeof sessionCount === 'undefined') {\n              sessionCount = 0;\n            }\n\n            StorageManager$1.setMetaProp('sc', sessionCount + 1);\n          }\n\n          this.sessionId = session;\n        }\n      }\n    }, {\n      key: \"getTimeElapsed\",\n      value: function getTimeElapsed() {\n        if (!_classPrivateFieldLooseBase(this, _isPersonalisationActive$3)[_isPersonalisationActive$3]()) {\n          return;\n        }\n\n        if (this.scookieObj != null) {\n          // TODO: check logic?\n          this.scookieObj = this.getSessionCookieObject();\n        }\n\n        var sessionStart = this.scookieObj.s;\n\n        if (sessionStart != null) {\n          var ts = getNow();\n          return Math.floor(ts - sessionStart);\n        }\n      }\n    }, {\n      key: \"getPageCount\",\n      value: function getPageCount() {\n        if (!_classPrivateFieldLooseBase(this, _isPersonalisationActive$3)[_isPersonalisationActive$3]()) {\n          return;\n        }\n\n        if (this.scookieObj != null) {\n          // TODO: check logic\n          this.scookieObj = this.getSessionCookieObject();\n        }\n\n        return this.scookieObj.p;\n      }\n    }, {\n      key: \"sessionId\",\n      get: function get() {\n        return _classPrivateFieldLooseBase(this, _sessionId)[_sessionId];\n      },\n      set: function set(sessionId) {\n        _classPrivateFieldLooseBase(this, _sessionId)[_sessionId] = sessionId;\n      }\n    }]);\n\n    return SessionManager;\n  }();\n\n  var seqNo = 0;\n  var requestTime = 0;\n\n  var _logger$6 = _classPrivateFieldLooseKey(\"logger\");\n\n  var _account$2 = _classPrivateFieldLooseKey(\"account\");\n\n  var _device$2 = _classPrivateFieldLooseKey(\"device\");\n\n  var _session$2 = _classPrivateFieldLooseKey(\"session\");\n\n  var _isPersonalisationActive$4 = _classPrivateFieldLooseKey(\"isPersonalisationActive\");\n\n  var _clearCookie = _classPrivateFieldLooseKey(\"clearCookie\");\n\n  var _addToLocalEventMap = _classPrivateFieldLooseKey(\"addToLocalEventMap\");\n\n  var RequestManager = /*#__PURE__*/function () {\n    function RequestManager(_ref) {\n      var logger = _ref.logger,\n          account = _ref.account,\n          device = _ref.device,\n          session = _ref.session,\n          isPersonalisationActive = _ref.isPersonalisationActive;\n\n      _classCallCheck(this, RequestManager);\n\n      Object.defineProperty(this, _addToLocalEventMap, {\n        value: _addToLocalEventMap2\n      });\n      Object.defineProperty(this, _logger$6, {\n        writable: true,\n        value: void 0\n      });\n      Object.defineProperty(this, _account$2, {\n        writable: true,\n        value: void 0\n      });\n      Object.defineProperty(this, _device$2, {\n        writable: true,\n        value: void 0\n      });\n      Object.defineProperty(this, _session$2, {\n        writable: true,\n        value: void 0\n      });\n      Object.defineProperty(this, _isPersonalisationActive$4, {\n        writable: true,\n        value: void 0\n      });\n      Object.defineProperty(this, _clearCookie, {\n        writable: true,\n        value: false\n      });\n      this.processingBackup = false;\n      _classPrivateFieldLooseBase(this, _logger$6)[_logger$6] = logger;\n      _classPrivateFieldLooseBase(this, _account$2)[_account$2] = account;\n      _classPrivateFieldLooseBase(this, _device$2)[_device$2] = device;\n      _classPrivateFieldLooseBase(this, _session$2)[_session$2] = session;\n      _classPrivateFieldLooseBase(this, _isPersonalisationActive$4)[_isPersonalisationActive$4] = isPersonalisationActive;\n      RequestDispatcher.logger = logger;\n      RequestDispatcher.device = device;\n    }\n\n    _createClass(RequestManager, [{\n      key: \"processBackupEvents\",\n      value: function processBackupEvents() {\n        var backupMap = StorageManager$1.readFromLSorCookie(LCOOKIE_NAME);\n\n        if (typeof backupMap === 'undefined' || backupMap === null) {\n          return;\n        }\n\n        this.processingBackup = true;\n\n        for (var idx in backupMap) {\n          if (backupMap.hasOwnProperty(idx)) {\n            var backupEvent = backupMap[idx];\n\n            if (typeof backupEvent.fired === 'undefined') {\n              _classPrivateFieldLooseBase(this, _logger$6)[_logger$6].debug('Processing backup event : ' + backupEvent.q);\n\n              if (typeof backupEvent.q !== 'undefined') {\n                RequestDispatcher.fireRequest(backupEvent.q);\n              }\n\n              backupEvent.fired = true;\n            }\n          }\n        }\n\n        StorageManager$1.saveToLSorCookie(LCOOKIE_NAME, backupMap);\n        this.processingBackup = false;\n      }\n    }, {\n      key: \"addSystemDataToObject\",\n      value: function addSystemDataToObject(dataObject, ignoreTrim) {\n        // ignore trim for chrome notifications; undefined everywhere else\n        if (typeof ignoreTrim === 'undefined') {\n          dataObject = removeUnsupportedChars(dataObject, _classPrivateFieldLooseBase(this, _logger$6)[_logger$6]);\n        }\n\n        if (!isObjectEmpty(_classPrivateFieldLooseBase(this, _logger$6)[_logger$6].wzrkError)) {\n          dataObject.wzrk_error = _classPrivateFieldLooseBase(this, _logger$6)[_logger$6].wzrkError;\n          _classPrivateFieldLooseBase(this, _logger$6)[_logger$6].wzrkError = {};\n        }\n\n        dataObject.id = _classPrivateFieldLooseBase(this, _account$2)[_account$2].id;\n\n        if (isValueValid(_classPrivateFieldLooseBase(this, _device$2)[_device$2].gcookie)) {\n          dataObject.g = _classPrivateFieldLooseBase(this, _device$2)[_device$2].gcookie;\n        }\n\n        var obj = _classPrivateFieldLooseBase(this, _session$2)[_session$2].getSessionCookieObject();\n\n        dataObject.s = obj.s; // session cookie\n\n        dataObject.pg = typeof obj.p === 'undefined' ? 1 : obj.p; // Page count\n\n        return dataObject;\n      }\n    }, {\n      key: \"addFlags\",\n      value: function addFlags(data) {\n        // check if cookie should be cleared.\n        _classPrivateFieldLooseBase(this, _clearCookie)[_clearCookie] = StorageManager$1.getAndClearMetaProp(CLEAR);\n\n        if (_classPrivateFieldLooseBase(this, _clearCookie)[_clearCookie] !== undefined && _classPrivateFieldLooseBase(this, _clearCookie)[_clearCookie]) {\n          data.rc = true;\n\n          _classPrivateFieldLooseBase(this, _logger$6)[_logger$6].debug('reset cookie sent in request and cleared from meta for future requests.');\n        }\n\n        if (_classPrivateFieldLooseBase(this, _isPersonalisationActive$4)[_isPersonalisationActive$4]()) {\n          var lastSyncTime = StorageManager$1.getMetaProp('lsTime');\n          var expirySeconds = StorageManager$1.getMetaProp('exTs'); // dsync not found in local storage - get data from server\n\n          if (typeof lastSyncTime === 'undefined' || typeof expirySeconds === 'undefined') {\n            data.dsync = true;\n            return;\n          }\n\n          var now = getNow(); // last sync time has expired - get fresh data from server\n\n          if (lastSyncTime + expirySeconds < now) {\n            data.dsync = true;\n          }\n        }\n      }\n    }, {\n      key: \"saveAndFireRequest\",\n      value: function saveAndFireRequest(url, override, sendOULFlag) {\n        var now = getNow();\n        url = addToURL(url, 'rn', ++$ct.globalCache.REQ_N);\n        var data = url + '&i=' + now + '&sn=' + seqNo;\n        StorageManager$1.backupEvent(data, $ct.globalCache.REQ_N, _classPrivateFieldLooseBase(this, _logger$6)[_logger$6]);\n\n        if (!$ct.blockRequest || override || _classPrivateFieldLooseBase(this, _clearCookie)[_clearCookie] !== undefined && _classPrivateFieldLooseBase(this, _clearCookie)[_clearCookie]) {\n          if (now === requestTime) {\n            seqNo++;\n          } else {\n            requestTime = now;\n            seqNo = 0;\n          }\n\n          RequestDispatcher.fireRequest(data, false, sendOULFlag);\n        } else {\n          _classPrivateFieldLooseBase(this, _logger$6)[_logger$6].debug(\"Not fired due to block request - \".concat($ct.blockRequest, \" or clearCookie - \").concat(_classPrivateFieldLooseBase(this, _clearCookie)[_clearCookie]));\n        }\n      }\n    }, {\n      key: \"unregisterTokenForGuid\",\n      value: function unregisterTokenForGuid(givenGUID) {\n        var data = {};\n        data.type = 'data';\n\n        if (isValueValid(givenGUID)) {\n          data.g = givenGUID;\n        }\n\n        data.action = 'unregister';\n        data.id = _classPrivateFieldLooseBase(this, _account$2)[_account$2].id;\n\n        var obj = _classPrivateFieldLooseBase(this, _session$2)[_session$2].getSessionCookieObject();\n\n        data.s = obj.s; // session cookie\n\n        var compressedData = compressData(JSON.stringify(data), _classPrivateFieldLooseBase(this, _logger$6)[_logger$6]);\n\n        var pageLoadUrl = _classPrivateFieldLooseBase(this, _account$2)[_account$2].dataPostURL;\n\n        pageLoadUrl = addToURL(pageLoadUrl, 'type', 'data');\n        pageLoadUrl = addToURL(pageLoadUrl, 'd', compressedData);\n        StorageManager$1.saveToLSorCookie(FIRE_PUSH_UNREGISTERED, false);\n        RequestDispatcher.fireRequest(pageLoadUrl, true); // REGISTER TOKEN\n\n        var payload = StorageManager$1.readFromLSorCookie(PUSH_SUBSCRIPTION_DATA);\n        this.registerToken(payload);\n      }\n    }, {\n      key: \"registerToken\",\n      value: function registerToken(payload) {\n        if (!payload) return;\n        payload = this.addSystemDataToObject(payload, true);\n        payload = JSON.stringify(payload);\n\n        var pageLoadUrl = _classPrivateFieldLooseBase(this, _account$2)[_account$2].dataPostURL;\n\n        pageLoadUrl = addToURL(pageLoadUrl, 'type', 'data');\n        pageLoadUrl = addToURL(pageLoadUrl, 'd', compressData(payload, _classPrivateFieldLooseBase(this, _logger$6)[_logger$6]));\n        RequestDispatcher.fireRequest(pageLoadUrl); // set in localstorage\n\n        StorageManager$1.save(WEBPUSH_LS_KEY, 'ok');\n      }\n    }, {\n      key: \"processEvent\",\n      value: function processEvent(data) {\n        _classPrivateFieldLooseBase(this, _addToLocalEventMap)[_addToLocalEventMap](data.evtName);\n\n        data = this.addSystemDataToObject(data, undefined);\n        this.addFlags(data);\n        data[CAMP_COOKIE_NAME] = getCampaignObjForLc();\n        var compressedData = compressData(JSON.stringify(data), _classPrivateFieldLooseBase(this, _logger$6)[_logger$6]);\n\n        var pageLoadUrl = _classPrivateFieldLooseBase(this, _account$2)[_account$2].dataPostURL;\n\n        pageLoadUrl = addToURL(pageLoadUrl, 'type', EVT_PUSH);\n        pageLoadUrl = addToURL(pageLoadUrl, 'd', compressedData);\n        this.saveAndFireRequest(pageLoadUrl, false);\n      }\n    }]);\n\n    return RequestManager;\n  }();\n\n  var _addToLocalEventMap2 = function _addToLocalEventMap2(evtName) {\n    if (StorageManager$1._isLocalStorageSupported()) {\n      if (typeof $ct.globalEventsMap === 'undefined') {\n        $ct.globalEventsMap = StorageManager$1.readFromLSorCookie(EV_COOKIE);\n\n        if (typeof $ct.globalEventsMap === 'undefined') {\n          $ct.globalEventsMap = {};\n        }\n      }\n\n      var nowTs = getNow();\n      var evtDetail = $ct.globalEventsMap[evtName];\n\n      if (typeof evtDetail !== 'undefined') {\n        evtDetail[2] = nowTs;\n        evtDetail[0]++;\n      } else {\n        evtDetail = [];\n        evtDetail.push(1);\n        evtDetail.push(nowTs);\n        evtDetail.push(nowTs);\n      }\n\n      $ct.globalEventsMap[evtName] = evtDetail;\n      StorageManager$1.saveToLSorCookie(EV_COOKIE, $ct.globalEventsMap);\n    }\n  };\n\n  var _request$4 = _classPrivateFieldLooseKey(\"request\");\n\n  var _account$3 = _classPrivateFieldLooseKey(\"account\");\n\n  var _oldValues$3 = _classPrivateFieldLooseKey(\"oldValues\");\n\n  var _logger$7 = _classPrivateFieldLooseKey(\"logger\");\n\n  var _processPrivacyArray = _classPrivateFieldLooseKey(\"processPrivacyArray\");\n\n  var Privacy = /*#__PURE__*/function (_Array) {\n    _inherits(Privacy, _Array);\n\n    var _super = _createSuper(Privacy);\n\n    function Privacy(_ref, values) {\n      var _this;\n\n      var request = _ref.request,\n          account = _ref.account,\n          logger = _ref.logger;\n\n      _classCallCheck(this, Privacy);\n\n      _this = _super.call(this);\n      Object.defineProperty(_assertThisInitialized(_this), _processPrivacyArray, {\n        value: _processPrivacyArray2\n      });\n      Object.defineProperty(_assertThisInitialized(_this), _request$4, {\n        writable: true,\n        value: void 0\n      });\n      Object.defineProperty(_assertThisInitialized(_this), _account$3, {\n        writable: true,\n        value: void 0\n      });\n      Object.defineProperty(_assertThisInitialized(_this), _oldValues$3, {\n        writable: true,\n        value: void 0\n      });\n      Object.defineProperty(_assertThisInitialized(_this), _logger$7, {\n        writable: true,\n        value: void 0\n      });\n      _classPrivateFieldLooseBase(_assertThisInitialized(_this), _logger$7)[_logger$7] = logger;\n      _classPrivateFieldLooseBase(_assertThisInitialized(_this), _request$4)[_request$4] = request;\n      _classPrivateFieldLooseBase(_assertThisInitialized(_this), _account$3)[_account$3] = account;\n      _classPrivateFieldLooseBase(_assertThisInitialized(_this), _oldValues$3)[_oldValues$3] = values;\n      return _this;\n    }\n\n    _createClass(Privacy, [{\n      key: \"push\",\n      value: function push() {\n        for (var _len = arguments.length, privacyArr = new Array(_len), _key = 0; _key < _len; _key++) {\n          privacyArr[_key] = arguments[_key];\n        }\n\n        _classPrivateFieldLooseBase(this, _processPrivacyArray)[_processPrivacyArray](privacyArr);\n\n        return 0;\n      }\n    }, {\n      key: \"_processOldValues\",\n      value: function _processOldValues() {\n        if (_classPrivateFieldLooseBase(this, _oldValues$3)[_oldValues$3]) {\n          _classPrivateFieldLooseBase(this, _processPrivacyArray)[_processPrivacyArray](_classPrivateFieldLooseBase(this, _oldValues$3)[_oldValues$3]);\n        }\n\n        _classPrivateFieldLooseBase(this, _oldValues$3)[_oldValues$3] = null;\n      }\n    }]);\n\n    return Privacy;\n  }( /*#__PURE__*/_wrapNativeSuper(Array));\n\n  var _processPrivacyArray2 = function _processPrivacyArray2(privacyArr) {\n    if (Array.isArray(privacyArr) && privacyArr.length > 0) {\n      var privacyObj = privacyArr[0];\n      var data = {};\n      var profileObj = {};\n      var optOut = false;\n\n      if (privacyObj.hasOwnProperty(OPTOUT_KEY)) {\n        optOut = privacyObj[OPTOUT_KEY];\n\n        if (typeof optOut === 'boolean') {\n          profileObj[CT_OPTOUT_KEY] = optOut; // should be true when user wants to opt in\n\n          $ct.isOptInRequest = !optOut;\n        }\n      }\n\n      if (privacyObj.hasOwnProperty(USEIP_KEY)) {\n        var useIP = privacyObj[USEIP_KEY];\n        var shouldUseIP = typeof useIP === 'boolean' ? useIP : false;\n        StorageManager$1.setMetaProp(USEIP_KEY, shouldUseIP);\n      }\n\n      if (!isObjectEmpty(profileObj)) {\n        data.type = 'profile';\n        data.profile = profileObj;\n        data = _classPrivateFieldLooseBase(this, _request$4)[_request$4].addSystemDataToObject(data, undefined);\n        var compressedData = compressData(JSON.stringify(data), _classPrivateFieldLooseBase(this, _logger$7)[_logger$7]);\n\n        var pageLoadUrl = _classPrivateFieldLooseBase(this, _account$3)[_account$3].dataPostURL;\n\n        pageLoadUrl = addToURL(pageLoadUrl, 'type', EVT_PUSH);\n        pageLoadUrl = addToURL(pageLoadUrl, 'd', compressedData);\n        pageLoadUrl = addToURL(pageLoadUrl, OPTOUT_KEY, optOut ? 'true' : 'false');\n\n        _classPrivateFieldLooseBase(this, _request$4)[_request$4].saveAndFireRequest(pageLoadUrl, $ct.blockRequeust);\n      }\n    }\n  };\n\n  var _oldValues$4 = _classPrivateFieldLooseKey(\"oldValues\");\n\n  var _logger$8 = _classPrivateFieldLooseKey(\"logger\");\n\n  var _request$5 = _classPrivateFieldLooseKey(\"request\");\n\n  var _account$4 = _classPrivateFieldLooseKey(\"account\");\n\n  var _wizAlertJSPath = _classPrivateFieldLooseKey(\"wizAlertJSPath\");\n\n  var _fcmPublicKey = _classPrivateFieldLooseKey(\"fcmPublicKey\");\n\n  var _setUpWebPush = _classPrivateFieldLooseKey(\"setUpWebPush\");\n\n  var _setUpWebPushNotifications = _classPrivateFieldLooseKey(\"setUpWebPushNotifications\");\n\n  var _setApplicationServerKey = _classPrivateFieldLooseKey(\"setApplicationServerKey\");\n\n  var _setUpSafariNotifications = _classPrivateFieldLooseKey(\"setUpSafariNotifications\");\n\n  var _setUpChromeFirefoxNotifications = _classPrivateFieldLooseKey(\"setUpChromeFirefoxNotifications\");\n\n  var _addWizAlertJS = _classPrivateFieldLooseKey(\"addWizAlertJS\");\n\n  var _removeWizAlertJS = _classPrivateFieldLooseKey(\"removeWizAlertJS\");\n\n  var _handleNotificationRegistration = _classPrivateFieldLooseKey(\"handleNotificationRegistration\");\n\n  var NotificationHandler = /*#__PURE__*/function (_Array) {\n    _inherits(NotificationHandler, _Array);\n\n    var _super = _createSuper(NotificationHandler);\n\n    function NotificationHandler(_ref, values) {\n      var _this;\n\n      var logger = _ref.logger,\n          session = _ref.session,\n          request = _ref.request,\n          account = _ref.account;\n\n      _classCallCheck(this, NotificationHandler);\n\n      _this = _super.call(this);\n      Object.defineProperty(_assertThisInitialized(_this), _handleNotificationRegistration, {\n        value: _handleNotificationRegistration2\n      });\n      Object.defineProperty(_assertThisInitialized(_this), _removeWizAlertJS, {\n        value: _removeWizAlertJS2\n      });\n      Object.defineProperty(_assertThisInitialized(_this), _addWizAlertJS, {\n        value: _addWizAlertJS2\n      });\n      Object.defineProperty(_assertThisInitialized(_this), _setUpChromeFirefoxNotifications, {\n        value: _setUpChromeFirefoxNotifications2\n      });\n      Object.defineProperty(_assertThisInitialized(_this), _setUpSafariNotifications, {\n        value: _setUpSafariNotifications2\n      });\n      Object.defineProperty(_assertThisInitialized(_this), _setApplicationServerKey, {\n        value: _setApplicationServerKey2\n      });\n      Object.defineProperty(_assertThisInitialized(_this), _setUpWebPushNotifications, {\n        value: _setUpWebPushNotifications2\n      });\n      Object.defineProperty(_assertThisInitialized(_this), _setUpWebPush, {\n        value: _setUpWebPush2\n      });\n      Object.defineProperty(_assertThisInitialized(_this), _oldValues$4, {\n        writable: true,\n        value: void 0\n      });\n      Object.defineProperty(_assertThisInitialized(_this), _logger$8, {\n        writable: true,\n        value: void 0\n      });\n      Object.defineProperty(_assertThisInitialized(_this), _request$5, {\n        writable: true,\n        value: void 0\n      });\n      Object.defineProperty(_assertThisInitialized(_this), _account$4, {\n        writable: true,\n        value: void 0\n      });\n      Object.defineProperty(_assertThisInitialized(_this), _wizAlertJSPath, {\n        writable: true,\n        value: void 0\n      });\n      Object.defineProperty(_assertThisInitialized(_this), _fcmPublicKey, {\n        writable: true,\n        value: void 0\n      });\n      _classPrivateFieldLooseBase(_assertThisInitialized(_this), _wizAlertJSPath)[_wizAlertJSPath] = 'https://d2r1yp2w7bby2u.cloudfront.net/js/wzrk_dialog.min.js';\n      _classPrivateFieldLooseBase(_assertThisInitialized(_this), _fcmPublicKey)[_fcmPublicKey] = null;\n      _classPrivateFieldLooseBase(_assertThisInitialized(_this), _oldValues$4)[_oldValues$4] = values;\n      _classPrivateFieldLooseBase(_assertThisInitialized(_this), _logger$8)[_logger$8] = logger;\n      _classPrivateFieldLooseBase(_assertThisInitialized(_this), _request$5)[_request$5] = request;\n      _classPrivateFieldLooseBase(_assertThisInitialized(_this), _account$4)[_account$4] = account;\n      return _this;\n    }\n\n    _createClass(NotificationHandler, [{\n      key: \"push\",\n      value: function push() {\n        for (var _len = arguments.length, displayArgs = new Array(_len), _key = 0; _key < _len; _key++) {\n          displayArgs[_key] = arguments[_key];\n        }\n\n        _classPrivateFieldLooseBase(this, _setUpWebPush)[_setUpWebPush](displayArgs);\n\n        return 0;\n      }\n    }, {\n      key: \"_processOldValues\",\n      value: function _processOldValues() {\n        if (_classPrivateFieldLooseBase(this, _oldValues$4)[_oldValues$4]) {\n          _classPrivateFieldLooseBase(this, _setUpWebPush)[_setUpWebPush](_classPrivateFieldLooseBase(this, _oldValues$4)[_oldValues$4]);\n        }\n\n        _classPrivateFieldLooseBase(this, _oldValues$4)[_oldValues$4] = null;\n      }\n    }, {\n      key: \"_enableWebPush\",\n      value: function _enableWebPush(enabled, applicationServerKey) {\n        $ct.webPushEnabled = enabled;\n\n        if (applicationServerKey != null) {\n          _classPrivateFieldLooseBase(this, _setApplicationServerKey)[_setApplicationServerKey](applicationServerKey);\n        }\n\n        if ($ct.webPushEnabled && $ct.notifApi.notifEnabledFromApi) {\n          _classPrivateFieldLooseBase(this, _handleNotificationRegistration)[_handleNotificationRegistration]($ct.notifApi.displayArgs);\n        } else if (!$ct.webPushEnabled && $ct.notifApi.notifEnabledFromApi) {\n          _classPrivateFieldLooseBase(this, _logger$8)[_logger$8].error('Ensure that web push notifications are fully enabled and integrated before requesting them');\n        }\n      }\n    }]);\n\n    return NotificationHandler;\n  }( /*#__PURE__*/_wrapNativeSuper(Array));\n\n  var _setUpWebPush2 = function _setUpWebPush2(displayArgs) {\n    if ($ct.webPushEnabled && displayArgs.length > 0) {\n      _classPrivateFieldLooseBase(this, _handleNotificationRegistration)[_handleNotificationRegistration](displayArgs);\n    } else if ($ct.webPushEnabled == null && displayArgs.length > 0) {\n      $ct.notifApi.notifEnabledFromApi = true;\n      $ct.notifApi.displayArgs = displayArgs.slice();\n    } else if ($ct.webPushEnabled === false && displayArgs.length > 0) {\n      _classPrivateFieldLooseBase(this, _logger$8)[_logger$8].error('Make sure push notifications are fully enabled and integrated');\n    }\n  };\n\n  var _setUpWebPushNotifications2 = function _setUpWebPushNotifications2(subscriptionCallback, serviceWorkerPath, apnsWebPushId, apnsServiceUrl) {\n    if (navigator.userAgent.indexOf('Chrome') !== -1 || navigator.userAgent.indexOf('Firefox') !== -1) {\n      _classPrivateFieldLooseBase(this, _setUpChromeFirefoxNotifications)[_setUpChromeFirefoxNotifications](subscriptionCallback, serviceWorkerPath);\n    } else if (navigator.userAgent.indexOf('Safari') !== -1) {\n      _classPrivateFieldLooseBase(this, _setUpSafariNotifications)[_setUpSafariNotifications](subscriptionCallback, apnsWebPushId, apnsServiceUrl);\n    }\n  };\n\n  var _setApplicationServerKey2 = function _setApplicationServerKey2(applicationServerKey) {\n    _classPrivateFieldLooseBase(this, _fcmPublicKey)[_fcmPublicKey] = applicationServerKey;\n  };\n\n  var _setUpSafariNotifications2 = function _setUpSafariNotifications2(subscriptionCallback, apnsWebPushId, apnsServiceUrl) {\n    var _this2 = this; // ensure that proper arguments are passed\n\n\n    if (typeof apnsWebPushId === 'undefined') {\n      _classPrivateFieldLooseBase(this, _logger$8)[_logger$8].error('Ensure that APNS Web Push ID is supplied');\n    }\n\n    if (typeof apnsServiceUrl === 'undefined') {\n      _classPrivateFieldLooseBase(this, _logger$8)[_logger$8].error('Ensure that APNS Web Push service path is supplied');\n    }\n\n    if ('safari' in window && 'pushNotification' in window.safari) {\n      window.safari.pushNotification.requestPermission(apnsServiceUrl, apnsWebPushId, {}, function (subscription) {\n        if (subscription.permission === 'granted') {\n          var subscriptionData = JSON.parse(JSON.stringify(subscription));\n          subscriptionData.endpoint = subscription.deviceToken;\n          subscriptionData.browser = 'Safari';\n          StorageManager$1.saveToLSorCookie(PUSH_SUBSCRIPTION_DATA, subscriptionData);\n\n          _classPrivateFieldLooseBase(_this2, _request$5)[_request$5].registerToken(subscriptionData);\n\n          _classPrivateFieldLooseBase(_this2, _logger$8)[_logger$8].info('Safari Web Push registered. Device Token: ' + subscription.deviceToken);\n        } else if (subscription.permission === 'denied') {\n          _classPrivateFieldLooseBase(_this2, _logger$8)[_logger$8].info('Error subscribing to Safari web push');\n        }\n      });\n    }\n  };\n\n  var _setUpChromeFirefoxNotifications2 = function _setUpChromeFirefoxNotifications2(subscriptionCallback, serviceWorkerPath) {\n    var _this3 = this;\n\n    var registrationScope = '';\n\n    if ('serviceWorker' in navigator) {\n      navigator.serviceWorker.register(serviceWorkerPath).then(function (registration) {\n        if (typeof __wzrk_account_id !== 'undefined') {\n          // eslint-disable-line\n          // shopify accounts , since the service worker is not at root, serviceWorker.ready is never resolved.\n          // hence add a timeout and hope serviceWroker is ready within that time.\n          return new Promise(function (resolve) {\n            return setTimeout(function () {\n              return resolve(registration);\n            }, 5000);\n          });\n        }\n\n        registrationScope = registration.scope; // IF SERVICE WORKER IS AT ROOT, RETURN THE READY PROMISE\n        // ELSE IF CHROME RETURN PROMISE AFTER 5 SECONDS\n        // OR getRegistrations PROMISE IF ITS FIREFOX\n\n        var rootDirRegex = /^(\\.?)(\\/?)([^/]*).js$/;\n        var isServiceWorkerAtRoot = rootDirRegex.test(serviceWorkerPath);\n\n        if (isServiceWorkerAtRoot) {\n          return navigator.serviceWorker.ready;\n        } else {\n          if (navigator.userAgent.indexOf('Chrome') !== -1) {\n            return new Promise(function (resolve) {\n              return setTimeout(function () {\n                return resolve(registration);\n              }, 5000);\n            });\n          } else {\n            return navigator.serviceWorker.getRegistrations();\n          }\n        }\n      }).then(function (serviceWorkerRegistration) {\n        // ITS AN ARRAY IN CASE OF FIREFOX, SO USE THE REGISTRATION WITH PROPER SCOPE\n        if (navigator.userAgent.indexOf('Firefox') !== -1 && Array.isArray(serviceWorkerRegistration)) {\n          serviceWorkerRegistration = serviceWorkerRegistration.filter(function (i) {\n            return i.scope === registrationScope;\n          })[0];\n        }\n\n        var subscribeObj = {\n          userVisibleOnly: true\n        };\n\n        if (_classPrivateFieldLooseBase(_this3, _fcmPublicKey)[_fcmPublicKey] != null) {\n          subscribeObj.applicationServerKey = urlBase64ToUint8Array(_classPrivateFieldLooseBase(_this3, _fcmPublicKey)[_fcmPublicKey]);\n        }\n\n        serviceWorkerRegistration.pushManager.subscribe(subscribeObj).then(function (subscription) {\n          _classPrivateFieldLooseBase(_this3, _logger$8)[_logger$8].info('Service Worker registered. Endpoint: ' + subscription.endpoint); // convert the subscription keys to strings; this sets it up nicely for pushing to LC\n\n\n          var subscriptionData = JSON.parse(JSON.stringify(subscription)); // remove the common chrome/firefox endpoint at the beginning of the token\n\n          if (navigator.userAgent.indexOf('Chrome') !== -1) {\n            subscriptionData.endpoint = subscriptionData.endpoint.split('/').pop();\n            subscriptionData.browser = 'Chrome';\n          } else if (navigator.userAgent.indexOf('Firefox') !== -1) {\n            subscriptionData.endpoint = subscriptionData.endpoint.split('/').pop();\n            subscriptionData.browser = 'Firefox';\n          }\n\n          StorageManager$1.saveToLSorCookie(PUSH_SUBSCRIPTION_DATA, subscriptionData); // var shouldSendToken = typeof sessionObj['p'] === STRING_CONSTANTS.UNDEFINED || sessionObj['p'] === 1\n\n          {\n            _classPrivateFieldLooseBase(_this3, _request$5)[_request$5].registerToken(subscriptionData);\n          }\n\n          if (typeof subscriptionCallback !== 'undefined' && typeof subscriptionCallback === 'function') {\n            subscriptionCallback();\n          }\n        }).catch(function (error) {\n          _classPrivateFieldLooseBase(_this3, _logger$8)[_logger$8].error('Error subscribing: ' + error); // unsubscribe from webpush if error\n\n\n          serviceWorkerRegistration.pushManager.getSubscription().then(function (subscription) {\n            if (subscription !== null) {\n              subscription.unsubscribe().then(function (successful) {\n                // You've successfully unsubscribed\n                _classPrivateFieldLooseBase(_this3, _logger$8)[_logger$8].info('Unsubscription successful');\n              }).catch(function (e) {\n                // Unsubscription failed\n                _classPrivateFieldLooseBase(_this3, _logger$8)[_logger$8].error('Error unsubscribing: ' + e);\n              });\n            }\n          });\n        });\n      }).catch(function (err) {\n        _classPrivateFieldLooseBase(_this3, _logger$8)[_logger$8].error('error registering service worker: ' + err);\n      });\n    }\n  };\n\n  var _addWizAlertJS2 = function _addWizAlertJS2() {\n    var scriptTag = document.createElement('script');\n    scriptTag.setAttribute('type', 'text/javascript');\n    scriptTag.setAttribute('id', 'wzrk-alert-js');\n    scriptTag.setAttribute('src', _classPrivateFieldLooseBase(this, _wizAlertJSPath)[_wizAlertJSPath]); // add the script tag to the end of the body\n\n    document.getElementsByTagName('body')[0].appendChild(scriptTag);\n    return scriptTag;\n  };\n\n  var _removeWizAlertJS2 = function _removeWizAlertJS2() {\n    var scriptTag = document.getElementById('wzrk-alert-js');\n    scriptTag.parentNode.removeChild(scriptTag);\n  };\n\n  var _handleNotificationRegistration2 = function _handleNotificationRegistration2(displayArgs) {\n    var _this4 = this; // make sure everything is specified\n\n\n    var titleText;\n    var bodyText;\n    var okButtonText;\n    var rejectButtonText;\n    var okButtonColor;\n    var skipDialog;\n    var askAgainTimeInSeconds;\n    var okCallback;\n    var rejectCallback;\n    var subscriptionCallback;\n    var hidePoweredByCT;\n    var serviceWorkerPath;\n    var httpsPopupPath;\n    var httpsIframePath;\n    var apnsWebPushId;\n    var apnsWebPushServiceUrl;\n\n    if (displayArgs.length === 1) {\n      if (isObject(displayArgs[0])) {\n        var notifObj = displayArgs[0];\n        titleText = notifObj.titleText;\n        bodyText = notifObj.bodyText;\n        okButtonText = notifObj.okButtonText;\n        rejectButtonText = notifObj.rejectButtonText;\n        okButtonColor = notifObj.okButtonColor;\n        skipDialog = notifObj.skipDialog;\n        askAgainTimeInSeconds = notifObj.askAgainTimeInSeconds;\n        okCallback = notifObj.okCallback;\n        rejectCallback = notifObj.rejectCallback;\n        subscriptionCallback = notifObj.subscriptionCallback;\n        hidePoweredByCT = notifObj.hidePoweredByCT;\n        serviceWorkerPath = notifObj.serviceWorkerPath;\n        httpsPopupPath = notifObj.httpsPopupPath;\n        httpsIframePath = notifObj.httpsIframePath;\n        apnsWebPushId = notifObj.apnsWebPushId;\n        apnsWebPushServiceUrl = notifObj.apnsWebPushServiceUrl;\n      }\n    } else {\n      titleText = displayArgs[0];\n      bodyText = displayArgs[1];\n      okButtonText = displayArgs[2];\n      rejectButtonText = displayArgs[3];\n      okButtonColor = displayArgs[4];\n      skipDialog = displayArgs[5];\n      askAgainTimeInSeconds = displayArgs[6];\n    }\n\n    if (skipDialog == null) {\n      skipDialog = false;\n    }\n\n    if (hidePoweredByCT == null) {\n      hidePoweredByCT = false;\n    }\n\n    if (serviceWorkerPath == null) {\n      serviceWorkerPath = '/clevertap_sw.js';\n    } // ensure that the browser supports notifications\n\n\n    if (typeof navigator.serviceWorker === 'undefined') {\n      return;\n    }\n\n    var isHTTP = httpsPopupPath != null && httpsIframePath != null; // make sure the site is on https for chrome notifications\n\n    if (window.location.protocol !== 'https:' && document.location.hostname !== 'localhost' && !isHTTP) {\n      _classPrivateFieldLooseBase(this, _logger$8)[_logger$8].error('Make sure you are https or localhost to register for notifications');\n\n      return;\n    } // right now, we only support Chrome V50 & higher & Firefox\n\n\n    if (navigator.userAgent.indexOf('Chrome') !== -1) {\n      var chromeAgent = navigator.userAgent.match(/Chrome\\/(\\d+)/);\n\n      if (chromeAgent == null || parseInt(chromeAgent[1], 10) < 50) {\n        return;\n      }\n    } else if (navigator.userAgent.indexOf('Firefox') !== -1) {\n      var firefoxAgent = navigator.userAgent.match(/Firefox\\/(\\d+)/);\n\n      if (firefoxAgent == null || parseInt(firefoxAgent[1], 10) < 50) {\n        return;\n      }\n    } else if (navigator.userAgent.indexOf('Safari') !== -1) {\n      var safariAgent = navigator.userAgent.match(/Safari\\/(\\d+)/);\n\n      if (safariAgent == null || parseInt(safariAgent[1], 10) < 50) {\n        return;\n      }\n    } else {\n      return;\n    } // we check for the cookie in setUpChromeNotifications() the tokens may have changed\n\n\n    if (!isHTTP) {\n      if (Notification == null) {\n        return;\n      } // handle migrations from other services -> chrome notifications may have already been asked for before\n\n\n      if (Notification.permission === 'granted') {\n        // skip the dialog and register\n        _classPrivateFieldLooseBase(this, _setUpWebPushNotifications)[_setUpWebPushNotifications](subscriptionCallback, serviceWorkerPath, apnsWebPushId, apnsWebPushServiceUrl);\n\n        return;\n      } else if (Notification.permission === 'denied') {\n        // we've lost this profile :'(\n        return;\n      }\n\n      if (skipDialog) {\n        _classPrivateFieldLooseBase(this, _setUpWebPushNotifications)[_setUpWebPushNotifications](subscriptionCallback, serviceWorkerPath, apnsWebPushId, apnsWebPushServiceUrl);\n\n        return;\n      }\n    } // make sure the right parameters are passed\n\n\n    if (!titleText || !bodyText || !okButtonText || !rejectButtonText) {\n      _classPrivateFieldLooseBase(this, _logger$8)[_logger$8].error('Missing input parameters; please specify title, body, ok button and cancel button text');\n\n      return;\n    } // make sure okButtonColor is formatted properly\n\n\n    if (okButtonColor == null || !okButtonColor.match(/^#[a-f\\d]{6}$/i)) {\n      okButtonColor = '#f28046'; // default color for positive button\n    } // make sure the user isn't asked for notifications more than askAgainTimeInSeconds\n\n\n    var now = new Date().getTime() / 1000;\n\n    if (StorageManager$1.getMetaProp('notif_last_time') == null) {\n      StorageManager$1.setMetaProp('notif_last_time', now);\n    } else {\n      if (askAgainTimeInSeconds == null) {\n        // 7 days by default\n        askAgainTimeInSeconds = 7 * 24 * 60 * 60;\n      }\n\n      if (now - StorageManager$1.getMetaProp('notif_last_time') < askAgainTimeInSeconds) {\n        return;\n      } else {\n        // continue asking\n        StorageManager$1.setMetaProp('notif_last_time', now);\n      }\n    }\n\n    if (isHTTP) {\n      // add the https iframe\n      var httpsIframe = document.createElement('iframe');\n      httpsIframe.setAttribute('style', 'display:none;');\n      httpsIframe.setAttribute('src', httpsIframePath);\n      document.body.appendChild(httpsIframe);\n      window.addEventListener('message', function (event) {\n        if (event.data != null) {\n          var obj = {};\n\n          try {\n            obj = JSON.parse(event.data);\n          } catch (e) {\n            // not a call from our iframe\n            return;\n          }\n\n          if (obj.state != null) {\n            if (obj.from === 'ct' && obj.state === 'not') {\n              _classPrivateFieldLooseBase(_this4, _addWizAlertJS)[_addWizAlertJS]().onload = function () {\n                // create our wizrocket popup\n                window.wzrkPermissionPopup.wizAlert({\n                  title: titleText,\n                  body: bodyText,\n                  confirmButtonText: okButtonText,\n                  confirmButtonColor: okButtonColor,\n                  rejectButtonText: rejectButtonText,\n                  hidePoweredByCT: hidePoweredByCT\n                }, function (enabled) {\n                  // callback function\n                  if (enabled) {\n                    // the user accepted on the dialog box\n                    if (typeof okCallback === 'function') {\n                      okCallback();\n                    } // redirect to popup.html\n\n\n                    window.open(httpsPopupPath);\n                  } else {\n                    if (typeof rejectCallback === 'function') {\n                      rejectCallback();\n                    }\n                  }\n\n                  _classPrivateFieldLooseBase(_this4, _removeWizAlertJS)[_removeWizAlertJS]();\n                });\n              };\n            }\n          }\n        }\n      }, false);\n    } else {\n      _classPrivateFieldLooseBase(this, _addWizAlertJS)[_addWizAlertJS]().onload = function () {\n        // create our wizrocket popup\n        window.wzrkPermissionPopup.wizAlert({\n          title: titleText,\n          body: bodyText,\n          confirmButtonText: okButtonText,\n          confirmButtonColor: okButtonColor,\n          rejectButtonText: rejectButtonText,\n          hidePoweredByCT: hidePoweredByCT\n        }, function (enabled) {\n          // callback function\n          if (enabled) {\n            // the user accepted on the dialog box\n            if (typeof okCallback === 'function') {\n              okCallback();\n            }\n\n            _classPrivateFieldLooseBase(_this4, _setUpWebPushNotifications)[_setUpWebPushNotifications](subscriptionCallback, serviceWorkerPath, apnsWebPushId, apnsWebPushServiceUrl);\n          } else {\n            if (typeof rejectCallback === 'function') {\n              rejectCallback();\n            }\n          }\n\n          _classPrivateFieldLooseBase(_this4, _removeWizAlertJS)[_removeWizAlertJS]();\n        });\n      };\n    }\n  };\n\n  var _logger$9 = _classPrivateFieldLooseKey(\"logger\");\n\n  var _api = _classPrivateFieldLooseKey(\"api\");\n\n  var _onloadcalled = _classPrivateFieldLooseKey(\"onloadcalled\");\n\n  var _device$3 = _classPrivateFieldLooseKey(\"device\");\n\n  var _session$3 = _classPrivateFieldLooseKey(\"session\");\n\n  var _account$5 = _classPrivateFieldLooseKey(\"account\");\n\n  var _request$6 = _classPrivateFieldLooseKey(\"request\");\n\n  var _isSpa = _classPrivateFieldLooseKey(\"isSpa\");\n\n  var _previousUrl = _classPrivateFieldLooseKey(\"previousUrl\");\n\n  var _boundCheckPageChanged = _classPrivateFieldLooseKey(\"boundCheckPageChanged\");\n\n  var _processOldValues = _classPrivateFieldLooseKey(\"processOldValues\");\n\n  var _checkPageChanged = _classPrivateFieldLooseKey(\"checkPageChanged\");\n\n  var _pingRequest = _classPrivateFieldLooseKey(\"pingRequest\");\n\n  var _isPingContinuous = _classPrivateFieldLooseKey(\"isPingContinuous\");\n\n  var _overrideDSyncFlag = _classPrivateFieldLooseKey(\"overrideDSyncFlag\");\n\n  var CleverTap = /*#__PURE__*/function () {\n    _createClass(CleverTap, [{\n      key: \"spa\",\n      get: function get() {\n        return _classPrivateFieldLooseBase(this, _isSpa)[_isSpa];\n      },\n      set: function set(value) {\n        var isSpa = value === true;\n\n        if (_classPrivateFieldLooseBase(this, _isSpa)[_isSpa] !== isSpa && _classPrivateFieldLooseBase(this, _onloadcalled)[_onloadcalled] === 1) {\n          // if clevertap.spa is changed after init has been called then update the click listeners\n          if (isSpa) {\n            document.addEventListener('click', _classPrivateFieldLooseBase(this, _boundCheckPageChanged)[_boundCheckPageChanged]);\n          } else {\n            document.removeEventListener('click', _classPrivateFieldLooseBase(this, _boundCheckPageChanged)[_boundCheckPageChanged]);\n          }\n        }\n\n        _classPrivateFieldLooseBase(this, _isSpa)[_isSpa] = isSpa;\n      }\n    }]);\n\n    function CleverTap() {\n      var _clevertap$account,\n          _this = this,\n          _clevertap$account2;\n\n      var clevertap = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n      _classCallCheck(this, CleverTap);\n\n      Object.defineProperty(this, _overrideDSyncFlag, {\n        value: _overrideDSyncFlag2\n      });\n      Object.defineProperty(this, _isPingContinuous, {\n        value: _isPingContinuous2\n      });\n      Object.defineProperty(this, _pingRequest, {\n        value: _pingRequest2\n      });\n      Object.defineProperty(this, _checkPageChanged, {\n        value: _checkPageChanged2\n      });\n      Object.defineProperty(this, _processOldValues, {\n        value: _processOldValues2\n      });\n      Object.defineProperty(this, _logger$9, {\n        writable: true,\n        value: void 0\n      });\n      Object.defineProperty(this, _api, {\n        writable: true,\n        value: void 0\n      });\n      Object.defineProperty(this, _onloadcalled, {\n        writable: true,\n        value: void 0\n      });\n      Object.defineProperty(this, _device$3, {\n        writable: true,\n        value: void 0\n      });\n      Object.defineProperty(this, _session$3, {\n        writable: true,\n        value: void 0\n      });\n      Object.defineProperty(this, _account$5, {\n        writable: true,\n        value: void 0\n      });\n      Object.defineProperty(this, _request$6, {\n        writable: true,\n        value: void 0\n      });\n      Object.defineProperty(this, _isSpa, {\n        writable: true,\n        value: void 0\n      });\n      Object.defineProperty(this, _previousUrl, {\n        writable: true,\n        value: void 0\n      });\n      Object.defineProperty(this, _boundCheckPageChanged, {\n        writable: true,\n        value: _classPrivateFieldLooseBase(this, _checkPageChanged)[_checkPageChanged].bind(this)\n      });\n      this.enablePersonalization = void 0;\n      _classPrivateFieldLooseBase(this, _onloadcalled)[_onloadcalled] = 0;\n      this._isPersonalisationActive = this._isPersonalisationActive.bind(this);\n\n      this.raiseNotificationClicked = function () {};\n\n      _classPrivateFieldLooseBase(this, _logger$9)[_logger$9] = new Logger(logLevels.INFO);\n      _classPrivateFieldLooseBase(this, _account$5)[_account$5] = new Account((_clevertap$account = clevertap.account) === null || _clevertap$account === void 0 ? void 0 : _clevertap$account[0], clevertap.region, clevertap.targetDomain);\n      _classPrivateFieldLooseBase(this, _device$3)[_device$3] = new DeviceManager({\n        logger: _classPrivateFieldLooseBase(this, _logger$9)[_logger$9]\n      });\n      _classPrivateFieldLooseBase(this, _session$3)[_session$3] = new SessionManager({\n        logger: _classPrivateFieldLooseBase(this, _logger$9)[_logger$9],\n        isPersonalisationActive: this._isPersonalisationActive\n      });\n      _classPrivateFieldLooseBase(this, _request$6)[_request$6] = new RequestManager({\n        logger: _classPrivateFieldLooseBase(this, _logger$9)[_logger$9],\n        account: _classPrivateFieldLooseBase(this, _account$5)[_account$5],\n        device: _classPrivateFieldLooseBase(this, _device$3)[_device$3],\n        session: _classPrivateFieldLooseBase(this, _session$3)[_session$3],\n        isPersonalisationActive: this._isPersonalisationActive\n      });\n      this.enablePersonalization = clevertap.enablePersonalization || false;\n      this.event = new EventHandler({\n        logger: _classPrivateFieldLooseBase(this, _logger$9)[_logger$9],\n        request: _classPrivateFieldLooseBase(this, _request$6)[_request$6],\n        isPersonalisationActive: this._isPersonalisationActive\n      }, clevertap.event);\n      this.profile = new ProfileHandler({\n        logger: _classPrivateFieldLooseBase(this, _logger$9)[_logger$9],\n        request: _classPrivateFieldLooseBase(this, _request$6)[_request$6],\n        account: _classPrivateFieldLooseBase(this, _account$5)[_account$5],\n        isPersonalisationActive: this._isPersonalisationActive\n      }, clevertap.profile);\n      this.onUserLogin = new UserLoginHandler({\n        request: _classPrivateFieldLooseBase(this, _request$6)[_request$6],\n        account: _classPrivateFieldLooseBase(this, _account$5)[_account$5],\n        session: _classPrivateFieldLooseBase(this, _session$3)[_session$3],\n        logger: _classPrivateFieldLooseBase(this, _logger$9)[_logger$9],\n        device: _classPrivateFieldLooseBase(this, _device$3)[_device$3]\n      }, clevertap.onUserLogin);\n      this.privacy = new Privacy({\n        request: _classPrivateFieldLooseBase(this, _request$6)[_request$6],\n        account: _classPrivateFieldLooseBase(this, _account$5)[_account$5],\n        logger: _classPrivateFieldLooseBase(this, _logger$9)[_logger$9]\n      }, clevertap.privacy);\n      this.notifications = new NotificationHandler({\n        logger: _classPrivateFieldLooseBase(this, _logger$9)[_logger$9],\n        request: _classPrivateFieldLooseBase(this, _request$6)[_request$6],\n        account: _classPrivateFieldLooseBase(this, _account$5)[_account$5]\n      }, clevertap.notifications);\n      _classPrivateFieldLooseBase(this, _api)[_api] = new CleverTapAPI({\n        logger: _classPrivateFieldLooseBase(this, _logger$9)[_logger$9],\n        request: _classPrivateFieldLooseBase(this, _request$6)[_request$6],\n        device: _classPrivateFieldLooseBase(this, _device$3)[_device$3],\n        session: _classPrivateFieldLooseBase(this, _session$3)[_session$3]\n      });\n      this.spa = clevertap.spa;\n      this.user = new User({\n        isPersonalisationActive: this._isPersonalisationActive\n      });\n      this.session = {\n        getTimeElapsed: function getTimeElapsed() {\n          return _classPrivateFieldLooseBase(_this, _session$3)[_session$3].getTimeElapsed();\n        },\n        getPageCount: function getPageCount() {\n          return _classPrivateFieldLooseBase(_this, _session$3)[_session$3].getPageCount();\n        }\n      };\n\n      this.logout = function () {\n        _classPrivateFieldLooseBase(_this, _logger$9)[_logger$9].debug('logout called');\n\n        StorageManager$1.setInstantDeleteFlagInK();\n      };\n\n      this.clear = function () {\n        _this.onUserLogin.clear();\n      };\n\n      this.getCleverTapID = function () {\n        return _classPrivateFieldLooseBase(_this, _device$3)[_device$3].getGuid();\n      };\n\n      this.setLogLevel = function (l) {\n        _classPrivateFieldLooseBase(_this, _logger$9)[_logger$9].logLevel = Number(l);\n      };\n\n      var _handleEmailSubscription = function _handleEmailSubscription(subscription, reEncoded, fetchGroups) {\n        handleEmailSubscription(subscription, reEncoded, fetchGroups, _classPrivateFieldLooseBase(_this, _account$5)[_account$5], _classPrivateFieldLooseBase(_this, _logger$9)[_logger$9]);\n      };\n\n      var api = _classPrivateFieldLooseBase(this, _api)[_api];\n\n      api.logout = this.logout;\n      api.clear = this.clear;\n\n      api.closeIframe = function (campaignId, divIdIgnored) {\n        closeIframe(campaignId, divIdIgnored, _classPrivateFieldLooseBase(_this, _session$3)[_session$3].sessionId);\n      };\n\n      api.enableWebPush = function (enabled, applicationServerKey) {\n        _this.notifications._enableWebPush(enabled, applicationServerKey);\n      };\n\n      api.tr = function (msg) {\n        _tr(msg, {\n          device: _classPrivateFieldLooseBase(_this, _device$3)[_device$3],\n          session: _classPrivateFieldLooseBase(_this, _session$3)[_session$3],\n          request: _classPrivateFieldLooseBase(_this, _request$6)[_request$6],\n          logger: _classPrivateFieldLooseBase(_this, _logger$9)[_logger$9]\n        });\n      };\n\n      api.setEnum = function (enumVal) {\n        setEnum(enumVal, _classPrivateFieldLooseBase(_this, _logger$9)[_logger$9]);\n      };\n\n      api.is_onloadcalled = function () {\n        return _classPrivateFieldLooseBase(_this, _onloadcalled)[_onloadcalled] === 1;\n      };\n\n      api.subEmail = function (reEncoded) {\n        _handleEmailSubscription('1', reEncoded);\n      };\n\n      api.getEmail = function (reEncoded, withGroups) {\n        _handleEmailSubscription('-1', reEncoded, withGroups);\n      };\n\n      api.unSubEmail = function (reEncoded) {\n        _handleEmailSubscription('0', reEncoded);\n      };\n\n      api.unsubEmailGroups = function (reEncoded) {\n        $ct.unsubGroups = [];\n        var elements = document.getElementsByClassName('ct-unsub-group-input-item');\n\n        for (var i = 0; i < elements.length; i++) {\n          var element = elements[i];\n\n          if (element.name) {\n            var data = {\n              name: element.name,\n              isUnsubscribed: element.checked\n            };\n            $ct.unsubGroups.push(data);\n          }\n        }\n\n        _handleEmailSubscription(GROUP_SUBSCRIPTION_REQUEST_ID, reEncoded);\n      };\n\n      api.setSubscriptionGroups = function (value) {\n        $ct.unsubGroups = value;\n      };\n\n      api.getSubscriptionGroups = function () {\n        return $ct.unsubGroups;\n      };\n\n      api.changeSubscriptionGroups = function (reEncoded, updatedGroups) {\n        api.setSubscriptionGroups(updatedGroups);\n\n        _handleEmailSubscription(GROUP_SUBSCRIPTION_REQUEST_ID, reEncoded);\n      };\n\n      api.setUpdatedCategoryLong = function (profile) {\n        if (profile[categoryLongKey]) {\n          $ct.updatedCategoryLong = profile[categoryLongKey];\n        }\n      };\n\n      window.$CLTP_WR = window.$WZRK_WR = api;\n\n      if ((_clevertap$account2 = clevertap.account) === null || _clevertap$account2 === void 0 ? void 0 : _clevertap$account2[0].id) {\n        // The accountId is present so can init with empty values.\n        // Needed to maintain backward compatability with legacy implementations.\n        // Npm imports/require will need to call init explictly with accountId\n        this.init();\n      }\n    }\n\n    _createClass(CleverTap, [{\n      key: \"raiseNotificationClicked\",\n      value: function raiseNotificationClicked() {}\n    }, {\n      key: \"init\",\n      value: function init(accountId, region, targetDomain) {\n        if (_classPrivateFieldLooseBase(this, _onloadcalled)[_onloadcalled] === 1) {\n          // already initailsed\n          return;\n        }\n\n        StorageManager$1.removeCookie('WZRK_P', window.location.hostname);\n\n        if (!_classPrivateFieldLooseBase(this, _account$5)[_account$5].id) {\n          if (!accountId) {\n            _classPrivateFieldLooseBase(this, _logger$9)[_logger$9].error(EMBED_ERROR);\n\n            return;\n          }\n\n          _classPrivateFieldLooseBase(this, _account$5)[_account$5].id = accountId;\n        }\n\n        _classPrivateFieldLooseBase(this, _session$3)[_session$3].cookieName = SCOOKIE_PREFIX + '_' + _classPrivateFieldLooseBase(this, _account$5)[_account$5].id;\n\n        if (region) {\n          _classPrivateFieldLooseBase(this, _account$5)[_account$5].region = region;\n        }\n\n        if (targetDomain) {\n          _classPrivateFieldLooseBase(this, _account$5)[_account$5].targetDomain = targetDomain;\n        }\n\n        var currLocation = location.href;\n        var urlParams = getURLParams(currLocation.toLowerCase()); // eslint-disable-next-line eqeqeq\n\n        if (typeof urlParams.e !== 'undefined' && urlParams.wzrk_ex == '0') {\n          return;\n        }\n\n        _classPrivateFieldLooseBase(this, _request$6)[_request$6].processBackupEvents();\n\n        _classPrivateFieldLooseBase(this, _processOldValues)[_processOldValues]();\n\n        this.pageChanged();\n\n        if (_classPrivateFieldLooseBase(this, _isSpa)[_isSpa]) {\n          // listen to click on the document and check if URL has changed.\n          document.addEventListener('click', _classPrivateFieldLooseBase(this, _boundCheckPageChanged)[_boundCheckPageChanged]);\n        } else {\n          // remove existing click listeners if any\n          document.removeEventListener('click', _classPrivateFieldLooseBase(this, _boundCheckPageChanged)[_boundCheckPageChanged]);\n        }\n\n        _classPrivateFieldLooseBase(this, _onloadcalled)[_onloadcalled] = 1;\n      }\n    }, {\n      key: \"pageChanged\",\n      value: function pageChanged() {\n        var _this2 = this;\n\n        var currLocation = window.location.href;\n        var urlParams = getURLParams(currLocation.toLowerCase()); // -- update page count\n\n        var obj = _classPrivateFieldLooseBase(this, _session$3)[_session$3].getSessionCookieObject();\n\n        var pgCount = typeof obj.p === 'undefined' ? 0 : obj.p;\n        obj.p = ++pgCount;\n\n        _classPrivateFieldLooseBase(this, _session$3)[_session$3].setSessionCookieObject(obj); // -- update page count\n\n\n        var data = {};\n        var referrerDomain = getDomain(document.referrer);\n\n        if (window.location.hostname !== referrerDomain) {\n          var maxLen = 120;\n\n          if (referrerDomain !== '') {\n            referrerDomain = referrerDomain.length > maxLen ? referrerDomain.substring(0, maxLen) : referrerDomain;\n            data.referrer = referrerDomain;\n          }\n\n          var utmSource = urlParams.utm_source || urlParams.wzrk_source;\n\n          if (typeof utmSource !== 'undefined') {\n            utmSource = utmSource.length > maxLen ? utmSource.substring(0, maxLen) : utmSource;\n            data.us = utmSource; // utm_source\n          }\n\n          var utmMedium = urlParams.utm_medium || urlParams.wzrk_medium;\n\n          if (typeof utmMedium !== 'undefined') {\n            utmMedium = utmMedium.length > maxLen ? utmMedium.substring(0, maxLen) : utmMedium;\n            data.um = utmMedium; // utm_medium\n          }\n\n          var utmCampaign = urlParams.utm_campaign || urlParams.wzrk_campaign;\n\n          if (typeof utmCampaign !== 'undefined') {\n            utmCampaign = utmCampaign.length > maxLen ? utmCampaign.substring(0, maxLen) : utmCampaign;\n            data.uc = utmCampaign; // utm_campaign\n          } // also independently send wzrk_medium to the backend\n\n\n          if (typeof urlParams.wzrk_medium !== 'undefined') {\n            var wm = urlParams.wzrk_medium;\n\n            if (wm.match(/^email$|^social$|^search$/)) {\n              data.wm = wm; // wzrk_medium\n            }\n          }\n        }\n\n        data = _classPrivateFieldLooseBase(this, _request$6)[_request$6].addSystemDataToObject(data, undefined);\n        data.cpg = currLocation;\n        data[CAMP_COOKIE_NAME] = getCampaignObjForLc();\n\n        var pageLoadUrl = _classPrivateFieldLooseBase(this, _account$5)[_account$5].dataPostURL;\n\n        _classPrivateFieldLooseBase(this, _request$6)[_request$6].addFlags(data); // send dsync flag when page = 1\n\n\n        if (parseInt(data.pg) === 1) {\n          _classPrivateFieldLooseBase(this, _overrideDSyncFlag)[_overrideDSyncFlag](data);\n        }\n\n        data.af = {\n          lib: 'web-sdk-v1.1.2'\n        };\n        pageLoadUrl = addToURL(pageLoadUrl, 'type', 'page');\n        pageLoadUrl = addToURL(pageLoadUrl, 'd', compressData(JSON.stringify(data), _classPrivateFieldLooseBase(this, _logger$9)[_logger$9]));\n\n        _classPrivateFieldLooseBase(this, _request$6)[_request$6].saveAndFireRequest(pageLoadUrl, false);\n\n        _classPrivateFieldLooseBase(this, _previousUrl)[_previousUrl] = currLocation;\n        setTimeout(function () {\n          if (pgCount <= 3) {\n            // send ping for up to 3 pages\n            _classPrivateFieldLooseBase(_this2, _pingRequest)[_pingRequest]();\n          }\n\n          if (_classPrivateFieldLooseBase(_this2, _isPingContinuous)[_isPingContinuous]()) {\n            setInterval(function () {\n              _classPrivateFieldLooseBase(_this2, _pingRequest)[_pingRequest]();\n            }, CONTINUOUS_PING_FREQ_IN_MILLIS);\n          }\n        }, FIRST_PING_FREQ_IN_MILLIS);\n      }\n    }, {\n      key: \"_isPersonalisationActive\",\n      value: function _isPersonalisationActive() {\n        return StorageManager$1._isLocalStorageSupported() && this.enablePersonalization;\n      }\n    }]);\n\n    return CleverTap;\n  }();\n\n  var _processOldValues2 = function _processOldValues2() {\n    this.onUserLogin._processOldValues();\n\n    this.privacy._processOldValues();\n\n    this.event._processOldValues();\n\n    this.profile._processOldValues();\n\n    this.notifications._processOldValues();\n  };\n\n  var _checkPageChanged2 = function _checkPageChanged2() {\n    if (_classPrivateFieldLooseBase(this, _previousUrl)[_previousUrl] !== location.href) {\n      this.pageChanged();\n    }\n  };\n\n  var _pingRequest2 = function _pingRequest2() {\n    var pageLoadUrl = _classPrivateFieldLooseBase(this, _account$5)[_account$5].dataPostURL;\n\n    var data = {};\n    data = _classPrivateFieldLooseBase(this, _request$6)[_request$6].addSystemDataToObject(data, undefined);\n    pageLoadUrl = addToURL(pageLoadUrl, 'type', EVT_PING);\n    pageLoadUrl = addToURL(pageLoadUrl, 'd', compressData(JSON.stringify(data), _classPrivateFieldLooseBase(this, _logger$9)[_logger$9]));\n\n    _classPrivateFieldLooseBase(this, _request$6)[_request$6].saveAndFireRequest(pageLoadUrl, false);\n  };\n\n  var _isPingContinuous2 = function _isPingContinuous2() {\n    return typeof window.wzrk_d !== 'undefined' && window.wzrk_d.ping === 'continuous';\n  };\n\n  var _overrideDSyncFlag2 = function _overrideDSyncFlag2(data) {\n    if (this._isPersonalisationActive()) {\n      data.dsync = true;\n    }\n  };\n\n  var clevertap = new CleverTap(window.clevertap);\n  window.clevertap = window.wizrocket = clevertap;\n  return clevertap;\n});","map":{"version":3,"mappings":"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","names":["TARGET_DOMAIN","TARGET_PROTOCOL","DEFAULT_REGION","Account","id","region","targetDomain","_classCallCheck","Object","writable","value","accountId","_classPrivateFieldLooseBase","finalTargetDomain","unsupportedKeyCharRegex","RegExp","unsupportedValueCharRegex","singleQuoteRegex","CLEAR","CHARGED_ID","CHARGEDID_COOKIE_NAME","GCOOKIE_NAME","KCOOKIE_NAME","CAMP_COOKIE_NAME","SCOOKIE_PREFIX","SCOOKIE_EXP_TIME_IN_SECS","EV_COOKIE","META_COOKIE","PR_COOKIE","ARP_COOKIE","LCOOKIE_NAME","GLOBAL","DISPLAY","WEBPUSH_LS_KEY","OPTOUT_KEY","CT_OPTOUT_KEY","OPTOUT_COOKIE_ENDSWITH","USEIP_KEY","LRU_CACHE","LRU_CACHE_SIZE","IS_OUL","EVT_PUSH","EVT_PING","COOKIE_EXPIRY","MAX_TRIES","FIRST_PING_FREQ_IN_MILLIS","CONTINUOUS_PING_FREQ_IN_MILLIS","GROUP_SUBSCRIPTION_REQUEST_ID","categoryLongKey","WZRK_PREFIX","WZRK_ID","NOTIFICATION_VIEWED","NOTIFICATION_CLICKED","FIRE_PUSH_UNREGISTERED","PUSH_SUBSCRIPTION_DATA","SYSTEM_EVENTS","isString","input","String","isObject","prototype","toString","call","isDateObject","_typeof","Date","isObjectEmpty","obj","prop","hasOwnProperty","isConvertibleToNumber","n","isNaN","parseFloat","isFinite","isNumber","test","isValueValid","undefined","removeUnsupportedChars","o","logger","key","sanitizedVal","sanitizedKey","sanitize","length","substring","reportError","val","regex","replace","getToday","today","getFullYear","getMonth","getDay","getNow","Math","floor","getTime","convertToWZRKDate","dateObj","round","setDate","dt","isDateValid","date","matches","exec","d","m","y","composedDate","getDate","StorageManager","_createClass","_isLocalStorageSupported","localStorage","setItem","JSON","stringify","data","getItem","parse","e","removeItem","name","domain","cookieStr","document","cookie","seconds","expires","domainStr","setTime","toGMTString","encodeURIComponent","nameEQ","ca","split","idx","c","charAt","indexOf","decodeURIComponent","window","property","save","createCookie","location","hostname","$ct","globalCache","read","readCookie","trim","err","broadDomain","domainParts","testBroadDomain","testCookieName","removeCookie","tempCookie","metaObj","readFromLSorCookie","wzrkMetaObj","saveToLSorCookie","getMetaProp","setMetaProp","k","flag","reqNo","backupArr","q","debug","respNo","backupMap","gcookie","REQ_N","RESP_N","LRU_cache","globalProfileMap","globalEventsMap","blockRequest","isOptInRequest","webPushEnabled","campaignDivMap","currentSessionId","wiz_counter","notifApi","notifEnabledFromApi","unsubGroups","updatedCategoryLong","LRUCache","max","lruCache","tempLruCache","cache","entry","push","item","saveCacheToLS","allKeys","objToArray","index","temp","keysArr","keysLength","newCache","indexToDelete","splice","CleverTapAPI","request","device","session","global","resume","respNumber","optOutResponse","removeBackup","getAndClearMetaProp","kIdFromLS","guidFromLRUCache","set","lastK","getSecondLastKey","lastGUID","unregisterTokenForGuid","createBroadCookie","manageSession","getSessionCookieObject","s","t","setSessionCookieObject","processingBackup","processBackupEvents","DeviceManager","getGuid","guid","error","DATA_NOT_SENT_TEXT","CLEVERTAP_ERROR_PREFIX","EMBED_ERROR","EVENT_ERROR","GENDER_ERROR","EMPLOYED_ERROR","MARRIED_ERROR","EDUCATION_ERROR","AGE_ERROR","DOB_ERROR","ENUM_FORMAT_ERROR","PHONE_FORMAT_ERROR","_globalChargedId","isEventStructureFlat","eventObj","Array","isArray","isChargedEventStructureValid","chargedObj","itemKey","chargedId","EventHandler","values","isPersonalisationActive","_this","eventsArr","arguments","evtName","evtObj","respObj","firstTime","lastTime","count","eventName","shift","includes","type","unshift","evtData","processEvent","getURLParams","url","urlParams","uri","match","pl","search","decode","replacement","getDomain","a","createElement","href","addToURL","v","getHostName","urlBase64ToUint8Array","base64String","padding","repeat","base64","rawData","atob","processedData","i","charCodeAt","Uint8Array","compressData","dataObject","compressToBase64","compress","uncompressed","context_dictionary","context_dictionaryToCreate","context_c","context_wc","context_w","context_enlargeIn","context_dictSize","context_numBits","context_data_string","context_data_val","context_data_position","ii","f","fromCharCode","pow","getKeyStr","_keyStr","output","chr1","chr2","chr3","enc1","enc2","enc3","enc4","NaN","RequestDispatcher","skipARP","sendOULFlag","skipResARP","_arp","pageLoadUrl","useIP","slice","tries","setTimeout","_fireRequest","clevertap","wizrocket","_window$wizrocket","plugin","ctCbScripts","getElementsByClassName","parentNode","removeChild","setAttribute","async","getElementsByTagName","appendChild","getCampaignObject","campObj","saveCampaignObject","campaignObj","getCampaignObjForLc","resultObj","globalObj","dailyObj","campaignIdArray","keys","dailyC","totalC","campaignId","element","todayC","tc","wmp","tlc","isProfileValid","profileObj","valid","profileKey","profileVal","Age","Phone","processFBUserObj","user","profileData","Name","FBID","gender","Gender","getHighestEducation","eduArr","college","highschool","edu","relationship_status","Married","education","Education","work","Employed","email","Email","birthday","mmddyy","DOB","processGPlusUserObj","displayName","GPID","image","isDefault","Photo","emails","emailIdx","emailObj","organizations","orgObj","yyyymmdd","relationshipStatus","addToLocalProfileMap","override","_custom","closeIframe","divIdIgnored","sessionCampaignObj","divId","getElementById","style","display","arp","jsonMap","console","isOULARP","arpFromStorage","setEnum","enumVal","handleEmailSubscription","subscription","reEncoded","fetchGroups","account","urlParamsAsIs","encodedEmailId","encodedProfileProps","p","emailURL","fireRequest","ProfileHandler","profilesArr","propName","profileArr","outerObj","Site","Facebook","FbProfileObj","GPlusProfileObj","tz","profile","addSystemDataToObject","addFlags","compressedData","dataPostURL","saveAndFireRequest","blockRequeust","UserLoginHandler","addToK","ids","g","kId","anonymousUser","foundInCache","getLastKey","_handleCookieFromCache","gFromCache","get","_device$1","_request$3","_this2","clear","Identity","cookieName","loginArr","pop","processProfile","setInstantDeleteFlagInK","_tr","msg","_device","_session","_request","_logger","_wizCounter","doCampHouseKeeping","targetingMsgJson","wzrk_id","incrCount","excludeFromFreqCaps","currentCount","totalCount","sessionStorage","wmc","campaignSessionLimit","campaignDailyLimit","campaignTotalLimit","totalDailyLimit","totalSessionLimit","efc","parseInt","mdc","tdc","sessionObj","sessionId","campaignSessionCount","totalSessionCount","campaignDailyCount","totalDailyCount","campaignTotalCount","delay","newCampObj","getCookieParams","scookieObj","setupClickEvent","onClick","contentDiv","isLegacy","ctaElement","jsCTAElements","jsFunc","isPreview","preview","onclick","invokeExternalJs","open","func","parent","kv","setupClickUrl","incrementImpression","renderFooterNotification","displayObj","layout","showExitIntent","isBanner","msgDiv","viewHeight","innerHeight","viewWidth","innerWidth","legacy","marginBottom","contentHeight","right","bottomPosition","width","widthPerct","navigator","userAgent","proto","iFrameStyle","body","iframe","borderRadius","br","frameborder","marginheight","marginwidth","scrolling","pointerCss","html","msgContent","css","bgColor","textColor","btnBg","leftTd","btColor","theme","titleText","title","descriptionText","description","imageTd","imageUrl","onClickStr","ifrm","contentWindow","contentDocument","doc","write","close","adjustIFrameHeight","scrollHeight","margin","height","ua","toLowerCase","onload","inDoc","_timer","setInterval","readyState","clearInterval","_callBackCalled","showFooterNotification","notificationCallback","inaObj","msgId","raiseNotificationClicked","raiseNotificationViewed","popupCallback","msgCTkv","wzrkPrefixKey","startsWith","wzrkJson","raisePopupNotificationClicked","notificationData","eventData","wzrkPrefixObj","_iterator","exitintentObj","event","targetObj","clientY","opacityDiv","ctaText","inapp_notifs","targetNotif","wtarget_type","onmouseleave","mergeEventMap","newEvtMap","oldEvtObj","newEvtObj","evpr","eventsMap","events","profileMap","syncExpiry","expires_in","now","inapp_stale","User","visitCount","prevSession","logLevels","DISABLE","ERROR","INFO","DEBUG","Logger","logLevel","wzrkError","message","code","level","ts","WZRK_D","SessionManager","scookieStr","objStr","currentSessionInLS","sessionCount","sessionStart","seqNo","requestTime","RequestManager","backupEvent","fired","ignoreTrim","wzrk_error","pg","rc","lastSyncTime","expirySeconds","dsync","givenGUID","action","payload","registerToken","nowTs","evtDetail","Privacy","privacyArr","privacyObj","optOut","shouldUseIP","NotificationHandler","displayArgs","enabled","applicationServerKey","subscriptionCallback","serviceWorkerPath","apnsWebPushId","apnsServiceUrl","safari","pushNotification","requestPermission","permission","subscriptionData","endpoint","deviceToken","browser","_request$5","_logger$8","info","registrationScope","serviceWorker","register","then","registration","__wzrk_account_id","Promise","resolve","scope","rootDirRegex","isServiceWorkerAtRoot","ready","getRegistrations","serviceWorkerRegistration","filter","subscribeObj","userVisibleOnly","_fcmPublicKey","_this3","pushManager","subscribe","catch","getSubscription","unsubscribe","successful","scriptTag","bodyText","okButtonText","rejectButtonText","okButtonColor","skipDialog","askAgainTimeInSeconds","okCallback","rejectCallback","hidePoweredByCT","httpsPopupPath","httpsIframePath","apnsWebPushServiceUrl","notifObj","isHTTP","protocol","chromeAgent","firefoxAgent","safariAgent","Notification","httpsIframe","addEventListener","state","from","_addWizAlertJS","wzrkPermissionPopup","wizAlert","confirmButtonText","confirmButtonColor","_removeWizAlertJS","_setUpWebPushNotifications","CleverTap","isSpa","removeEventListener","bind","enablePersonalization","_isPersonalisationActive","_clevertap$account","ReqestManager","onUserLogin","privacy","notifications","spa","getTimeElapsed","_session$3","getPageCount","logout","_logger$9","getCleverTapID","_device$3","setLogLevel","l","Number","_handleEmailSubscription","api","enableWebPush","_enableWebPush","tr","is_onloadcalled","_onloadcalled","subEmail","getEmail","withGroups","unSubEmail","unsubEmailGroups","elements","isUnsubscribed","checked","setSubscriptionGroups","getSubscriptionGroups","changeSubscriptionGroups","updatedGroups","setUpdatedCategoryLong","$CLTP_WR","$WZRK_WR","_clevertap$account2","init","currLocation","wzrk_ex","pageChanged","pgCount","referrerDomain","referrer","maxLen","utmSource","utm_source","wzrk_source","us","utmMedium","utm_medium","wzrk_medium","um","utmCampaign","utm_campaign","wzrk_campaign","uc","wm","cpg","af","lib","_pingRequest","_processOldValues","wzrk_d","ping","Clevertap"],"sources":["/Users/sumit.kumar/Documents/React Web/my-react-app/node_modules/clevertap-web-sdk/src/options.js","/Users/sumit.kumar/Documents/React Web/my-react-app/node_modules/clevertap-web-sdk/src/modules/account.js","/Users/sumit.kumar/Documents/React Web/my-react-app/node_modules/clevertap-web-sdk/src/util/constants.js","/Users/sumit.kumar/Documents/React Web/my-react-app/node_modules/clevertap-web-sdk/src/util/datatypes.js","/Users/sumit.kumar/Documents/React Web/my-react-app/node_modules/clevertap-web-sdk/src/util/datetime.js","/Users/sumit.kumar/Documents/React Web/my-react-app/node_modules/clevertap-web-sdk/src/util/storage.js","/Users/sumit.kumar/Documents/React Web/my-react-app/node_modules/clevertap-web-sdk/src/util/lruCache.js","/Users/sumit.kumar/Documents/React Web/my-react-app/node_modules/clevertap-web-sdk/src/modules/api.js","/Users/sumit.kumar/Documents/React Web/my-react-app/node_modules/clevertap-web-sdk/src/modules/device.js","/Users/sumit.kumar/Documents/React Web/my-react-app/node_modules/clevertap-web-sdk/src/util/messages.js","/Users/sumit.kumar/Documents/React Web/my-react-app/node_modules/clevertap-web-sdk/src/util/validator.js","/Users/sumit.kumar/Documents/React Web/my-react-app/node_modules/clevertap-web-sdk/src/modules/event.js","/Users/sumit.kumar/Documents/React Web/my-react-app/node_modules/clevertap-web-sdk/src/util/url.js","/Users/sumit.kumar/Documents/React Web/my-react-app/node_modules/clevertap-web-sdk/src/util/encoder.js","/Users/sumit.kumar/Documents/React Web/my-react-app/node_modules/clevertap-web-sdk/src/util/requestDispatcher.js","/Users/sumit.kumar/Documents/React Web/my-react-app/node_modules/clevertap-web-sdk/src/util/clevertap.js","/Users/sumit.kumar/Documents/React Web/my-react-app/node_modules/clevertap-web-sdk/src/modules/profile.js","/Users/sumit.kumar/Documents/React Web/my-react-app/node_modules/clevertap-web-sdk/src/modules/userLogin.js","/Users/sumit.kumar/Documents/React Web/my-react-app/node_modules/clevertap-web-sdk/src/util/tr.js","/Users/sumit.kumar/Documents/React Web/my-react-app/node_modules/clevertap-web-sdk/src/modules/user.js","/Users/sumit.kumar/Documents/React Web/my-react-app/node_modules/clevertap-web-sdk/src/modules/logger.js","/Users/sumit.kumar/Documents/React Web/my-react-app/node_modules/clevertap-web-sdk/src/modules/session.js","/Users/sumit.kumar/Documents/React Web/my-react-app/node_modules/clevertap-web-sdk/src/modules/request.js","/Users/sumit.kumar/Documents/React Web/my-react-app/node_modules/clevertap-web-sdk/src/modules/privacy.js","/Users/sumit.kumar/Documents/React Web/my-react-app/node_modules/clevertap-web-sdk/src/modules/notification.js","/Users/sumit.kumar/Documents/React Web/my-react-app/node_modules/clevertap-web-sdk/src/clevertap.js","/Users/sumit.kumar/Documents/React Web/my-react-app/node_modules/clevertap-web-sdk/src/main.js"],"sourcesContent":["export const TARGET_DOMAIN = 'clevertap-prod.com'\nexport const TARGET_PROTOCOL = 'https:'\nexport const DEFAULT_REGION = 'eu1'\n","import { DEFAULT_REGION, TARGET_DOMAIN, TARGET_PROTOCOL } from '../options'\n\nexport default class Account {\n  #accountId\n  #region = ''\n  #targetDomain = TARGET_DOMAIN\n\n  constructor ({ id } = {}, region = '', targetDomain = TARGET_DOMAIN) {\n    this.id = id\n    if (region) {\n      this.region = region\n    }\n    if (targetDomain) {\n      this.targetDomain = targetDomain\n    }\n  }\n\n  get id () {\n    return this.#accountId\n  }\n\n  set id (accountId) {\n    this.#accountId = accountId\n  }\n\n  get region () {\n    return this.#region\n  }\n\n  set region (region) {\n    this.#region = region\n  }\n\n  get targetDomain () {\n    return this.#targetDomain\n  }\n\n  set targetDomain (targetDomain) {\n    this.#targetDomain = targetDomain\n  }\n\n  get finalTargetDomain () {\n    if (this.region) {\n      return `${this.region}.${this.targetDomain}`\n    } else {\n      if (this.targetDomain === TARGET_DOMAIN) {\n        return `${DEFAULT_REGION}.${this.targetDomain}`\n      }\n      return this.targetDomain\n    }\n  }\n\n  get dataPostURL () {\n    return `${TARGET_PROTOCOL}//${this.finalTargetDomain}/a?t=96`\n  }\n\n  get recorderURL () {\n    return `${TARGET_PROTOCOL}//${this.finalTargetDomain}/r?r=1`\n  }\n\n  get emailURL () {\n    return `${TARGET_PROTOCOL}//${this.finalTargetDomain}/e?r=1`\n  }\n}\n","export const unsupportedKeyCharRegex = new RegExp('^\\\\s+|\\\\\\.|\\:|\\\\\\$|\\'|\\\"|\\\\\\\\|\\\\s+$', 'g')\nexport const unsupportedValueCharRegex = new RegExp(\"^\\\\s+|\\'|\\\"|\\\\\\\\|\\\\s+$\", 'g')\nexport const doubleQuoteRegex = new RegExp('\\\"', 'g')\nexport const singleQuoteRegex = new RegExp('\\'', 'g')\nexport const CLEAR = 'clear'\nexport const CHARGED_ID = 'Charged ID'\nexport const CHARGEDID_COOKIE_NAME = 'WZRK_CHARGED_ID'\nexport const GCOOKIE_NAME = 'WZRK_G'\nexport const KCOOKIE_NAME = 'WZRK_K'\nexport const CAMP_COOKIE_NAME = 'WZRK_CAMP'\nexport const SCOOKIE_PREFIX = 'WZRK_S'\nexport const SCOOKIE_EXP_TIME_IN_SECS = 60 * 20 // 20 mins\nexport const EV_COOKIE = 'WZRK_EV'\nexport const META_COOKIE = 'WZRK_META'\nexport const PR_COOKIE = 'WZRK_PR'\nexport const ARP_COOKIE = 'WZRK_ARP'\nexport const LCOOKIE_NAME = 'WZRK_L'\nexport const NOTIF_COOKIE_NAME = 'WZRK_N'\nexport const GLOBAL = 'global'\nexport const TOTAL_COUNT = 'tc'\nexport const DISPLAY = 'display'\nexport const UNDEFINED = 'undefined'\nexport const WEBPUSH_LS_KEY = 'WZRK_WPR'\nexport const OPTOUT_KEY = 'optOut'\nexport const CT_OPTOUT_KEY = 'ct_optout'\nexport const OPTOUT_COOKIE_ENDSWITH = ':OO'\nexport const USEIP_KEY = 'useIP'\nexport const LRU_CACHE = 'WZRK_X'\nexport const LRU_CACHE_SIZE = 100\nexport const IS_OUL = 'isOUL'\nexport const EVT_PUSH = 'push'\nexport const EVT_PING = 'ping'\nexport const COOKIE_EXPIRY = 86400 * 365 * 10 // 10 Years in seconds\nexport const MAX_TRIES = 50 // API tries\nexport const FIRST_PING_FREQ_IN_MILLIS = 2 * 60 * 1000 // 2 mins\nexport const CONTINUOUS_PING_FREQ_IN_MILLIS = 5 * 60 * 1000 // 5 mins\nexport const GROUP_SUBSCRIPTION_REQUEST_ID = '2'\nexport const categoryLongKey = 'cUsY'\nexport const WZRK_PREFIX = 'wzrk_'\nexport const WZRK_ID = 'wzrk_id'\nexport const NOTIFICATION_VIEWED = 'Notification Viewed'\nexport const NOTIFICATION_CLICKED = 'Notification Clicked'\nexport const FIRE_PUSH_UNREGISTERED = 'WZRK_FPU'\nexport const PUSH_SUBSCRIPTION_DATA = 'WZRK_PSD' // PUSH SUBSCRIPTION DATA FOR REGISTER/UNREGISTER TOKEN\n\nexport const SYSTEM_EVENTS = [\n  'Stayed',\n  'UTM Visited',\n  'App Launched',\n  'Notification Sent',\n  NOTIFICATION_VIEWED,\n  NOTIFICATION_CLICKED\n]\n","import {\n  unsupportedKeyCharRegex,\n  unsupportedValueCharRegex\n} from './constants'\n\nexport const isString = (input) => {\n  return (typeof input === 'string' || input instanceof String)\n}\n\nexport const isObject = (input) => {\n  // TODO: refine\n  return Object.prototype.toString.call(input) === '[object Object]'\n}\n\nexport const isDateObject = (input) => {\n  return typeof (input) === 'object' && (input instanceof Date)\n}\n\nexport const isObjectEmpty = (obj) => {\n  for (const prop in obj) {\n    if (obj.hasOwnProperty(prop)) { return false }\n  }\n  return true\n}\n\nexport const isConvertibleToNumber = (n) => {\n  return !isNaN(parseFloat(n)) && isFinite(n)\n}\n\nexport const isNumber = (n) => {\n  return /^-?[\\d.]+(?:e-?\\d+)?$/.test(n) && typeof n === 'number'\n}\n\nexport const isValueValid = (value) => {\n  if (value === null || value === undefined || value === 'undefined') {\n    return false\n  }\n  return true\n}\n\nexport const arrayContains = (arr, obj) => {\n  var i = arr.length\n  while (i--) {\n    if (arr[i] === obj) {\n      return true\n    }\n  }\n  return false\n}\n\nexport const removeUnsupportedChars = (o, logger) => {\n  // keys can't be greater than 1024 chars, values can't be greater than 1024 chars\n  if (typeof o === 'object') {\n    for (const key in o) {\n      if (o.hasOwnProperty(key)) {\n        const sanitizedVal = removeUnsupportedChars(o[key], logger)\n        let sanitizedKey\n        sanitizedKey = sanitize(key, unsupportedKeyCharRegex)\n        if (sanitizedKey.length > 1024) {\n          sanitizedKey = sanitizedKey.substring(0, 1024)\n          logger.reportError(520, sanitizedKey + '... length exceeded 1024 chars. Trimmed.')\n        }\n        delete o[key]\n        o[sanitizedKey] = sanitizedVal\n      }\n    }\n  } else {\n    let val\n\n    if (isString(o)) {\n      val = sanitize(o, unsupportedValueCharRegex)\n      if (val.length > 1024) {\n        val = val.substring(0, 1024)\n        logger.reportError(521, val + '... length exceeded 1024 chars. Trimmed.')\n      }\n    } else {\n      val = o\n    }\n    return val\n  }\n  return o\n}\n\nexport const sanitize = (input, regex) => {\n  return input.replace(regex, '')\n}\n","export const getToday = () => {\n  const today = new Date()\n  return today.getFullYear() + '' + today.getMonth() + '' + today.getDay()\n}\n\nexport const getNow = () => {\n  return Math.floor((new Date()).getTime() / 1000)\n}\n\nexport const convertToWZRKDate = (dateObj) => {\n  return ('$D_' + Math.round(dateObj.getTime() / 1000))\n}\n\nexport const setDate = (dt) => {\n  // expecting  yyyymmdd format either as a number or a string\n  if (isDateValid(dt)) {\n    return '$D_' + dt\n  }\n}\n\nexport const isDateValid = (date) => {\n  const matches = /^(\\d{4})(\\d{2})(\\d{2})$/.exec(date)\n  if (matches == null) return false\n  const d = matches[3]\n  const m = matches[2] - 1\n  const y = matches[1]\n  const composedDate = new Date(y, m, d)\n  // eslint-disable-next-line eqeqeq\n  return composedDate.getDate() == d && composedDate.getMonth() == m && composedDate.getFullYear() == y\n}\n","import {\n  GCOOKIE_NAME,\n  META_COOKIE,\n  KCOOKIE_NAME,\n  LCOOKIE_NAME\n} from './constants'\nexport class StorageManager {\n  static save (key, value) {\n    if (!key || !value) {\n      return false\n    }\n    if (this._isLocalStorageSupported()) {\n      localStorage.setItem(key, typeof value === 'string' ? value : JSON.stringify(value))\n      return true\n    }\n  }\n\n  static read (key) {\n    if (!key) {\n      return false\n    }\n    let data = null\n    if (this._isLocalStorageSupported()) {\n      data = localStorage.getItem(key)\n    }\n    if (data != null) {\n      try {\n        data = JSON.parse(data)\n      } catch (e) {}\n    }\n    return data\n  }\n\n  static remove (key) {\n    if (!key) {\n      return false\n    }\n    if (this._isLocalStorageSupported()) {\n      localStorage.removeItem(key)\n      return true\n    }\n  }\n\n  static removeCookie (name, domain) {\n    let cookieStr = name + '=; expires=Thu, 01 Jan 1970 00:00:01 GMT;'\n\n    if (domain) {\n      cookieStr = cookieStr + ' domain=' + domain + '; path=/'\n    }\n\n    document.cookie = cookieStr\n  }\n\n  static createCookie (name, value, seconds, domain) {\n    let expires = ''\n    let domainStr = ''\n    if (seconds) {\n      const date = new Date()\n      date.setTime(date.getTime() + (seconds * 1000))\n\n      expires = '; expires=' + date.toGMTString()\n    }\n\n    if (domain) {\n      domainStr = '; domain=' + domain\n    }\n\n    value = encodeURIComponent(value)\n\n    document.cookie = name + '=' + value + expires + domainStr + '; path=/'\n  }\n\n  static readCookie (name) {\n    const nameEQ = name + '='\n    const ca = document.cookie.split(';')\n    for (let idx = 0; idx < ca.length; idx++) {\n      let c = ca[idx]\n      while (c.charAt(0) === ' ') {\n        c = c.substring(1, c.length)\n      }\n      // eslint-disable-next-line eqeqeq\n      if (c.indexOf(nameEQ) == 0) {\n        return decodeURIComponent(c.substring(nameEQ.length, c.length))\n      }\n    }\n    return null\n  }\n\n  static _isLocalStorageSupported () {\n    return 'localStorage' in window && window.localStorage !== null && typeof window.localStorage.setItem === 'function'\n  }\n\n  static saveToLSorCookie (property, value) {\n    if (value == null) {\n      return\n    }\n    try {\n      if (this._isLocalStorageSupported()) {\n        this.save(property, encodeURIComponent(JSON.stringify(value)))\n      } else {\n        if (property === GCOOKIE_NAME) {\n          this.createCookie(property, encodeURIComponent(value), 0, window.location.hostname)\n        } else {\n          this.createCookie(property, encodeURIComponent(JSON.stringify(value)), 0, window.location.hostname)\n        }\n      }\n      $ct.globalCache[property] = value\n    } catch (e) {}\n  }\n\n  static readFromLSorCookie (property) {\n    let data\n    if ($ct.globalCache.hasOwnProperty(property)) {\n      return $ct.globalCache[property]\n    }\n    if (this._isLocalStorageSupported()) {\n      data = this.read(property)\n    } else {\n      data = this.readCookie(property)\n    }\n\n    if (data !== null && data !== undefined && !(typeof data.trim === 'function' && data.trim() === '')) {\n      let value\n      try {\n        value = JSON.parse(decodeURIComponent(data))\n      } catch (err) {\n        value = decodeURIComponent(data)\n      }\n      $ct.globalCache[property] = value\n      return value\n    }\n  }\n\n  static createBroadCookie (name, value, seconds, domain) {\n    // sets cookie on the base domain. e.g. if domain is baz.foo.bar.com, set cookie on \".bar.com\"\n    // To update an existing \"broad domain\" cookie, we need to know what domain it was actually set on.\n    // since a retrieved cookie never tells which domain it was set on, we need to set another test cookie\n    // to find out which \"broadest\" domain the cookie was set on. Then delete the test cookie, and use that domain\n    // for updating the actual cookie.\n\n    if (domain) {\n      let broadDomain = $ct.broadDomain\n      if (broadDomain == null) { // if we don't know the broadDomain yet, then find out\n        const domainParts = domain.split('.')\n        let testBroadDomain = ''\n        for (let idx = domainParts.length - 1; idx >= 0; idx--) {\n          if (idx === 0) {\n            testBroadDomain = domainParts[idx] + testBroadDomain\n          } else {\n            testBroadDomain = '.' + domainParts[idx] + testBroadDomain\n          }\n\n          // only needed if the cookie already exists and needs to be updated. See note above.\n          if (this.readCookie(name)) {\n            // no guarantee that browser will delete cookie, hence create short lived cookies\n            var testCookieName = 'test_' + name + idx\n            this.createCookie(testCookieName, value, 10, testBroadDomain) // self-destruct after 10 seconds\n            if (!this.readCookie(testCookieName)) { // if test cookie not set, then the actual cookie wouldn't have been set on this domain either.\n              continue\n            } else { // else if cookie set, then delete the test and the original cookie\n              this.removeCookie(testCookieName, testBroadDomain)\n            }\n          }\n\n          this.createCookie(name, value, seconds, testBroadDomain)\n          const tempCookie = this.readCookie(name)\n          // eslint-disable-next-line eqeqeq\n          if (tempCookie == value) {\n            broadDomain = testBroadDomain\n            $ct.broadDomain = broadDomain\n            break\n          }\n        }\n      } else {\n        this.createCookie(name, value, seconds, broadDomain)\n      }\n    } else {\n      this.createCookie(name, value, seconds, domain)\n    }\n  }\n\n  static getMetaProp (property) {\n    const metaObj = this.readFromLSorCookie(META_COOKIE)\n    if (metaObj != null) {\n      return metaObj[property]\n    }\n  }\n\n  static setMetaProp (property, value) {\n    if (this._isLocalStorageSupported()) {\n      let wzrkMetaObj = this.readFromLSorCookie(META_COOKIE)\n      if (wzrkMetaObj == null) {\n        wzrkMetaObj = {}\n      }\n      if (value === undefined) {\n        delete wzrkMetaObj[property]\n      } else {\n        wzrkMetaObj[property] = value\n      }\n      this.saveToLSorCookie(META_COOKIE, wzrkMetaObj)\n    }\n  }\n\n  static getAndClearMetaProp (property) {\n    const value = this.getMetaProp(property)\n    this.setMetaProp(property, undefined)\n    return value\n  }\n\n  static setInstantDeleteFlagInK () {\n    let k = this.readFromLSorCookie(KCOOKIE_NAME)\n    if (k == null) {\n      k = {}\n    }\n    k.flag = true\n    this.saveToLSorCookie(KCOOKIE_NAME, k)\n  }\n\n  static backupEvent (data, reqNo, logger) {\n    let backupArr = this.readFromLSorCookie(LCOOKIE_NAME)\n    if (typeof backupArr === 'undefined') {\n      backupArr = {}\n    }\n    backupArr[reqNo] = { q: data }\n    this.saveToLSorCookie(LCOOKIE_NAME, backupArr)\n    logger.debug(`stored in ${LCOOKIE_NAME} reqNo : ${reqNo} -> ${data}`)\n  }\n\n  static removeBackup (respNo, logger) {\n    const backupMap = this.readFromLSorCookie(LCOOKIE_NAME)\n    if (typeof backupMap !== 'undefined' && backupMap !== null && typeof backupMap[respNo] !== 'undefined') {\n      logger.debug(`del event: ${respNo} data-> ${backupMap[respNo].q}`)\n      delete backupMap[respNo]\n      this.saveToLSorCookie(LCOOKIE_NAME, backupMap)\n    }\n  }\n}\n\nexport const $ct = {\n  globalCache: {\n    gcookie: null,\n    REQ_N: 0,\n    RESP_N: 0\n  },\n  LRU_cache: null,\n  globalProfileMap: undefined,\n  globalEventsMap: undefined,\n  blockRequest: false,\n  isOptInRequest: false,\n  broadDomain: null,\n  webPushEnabled: null,\n  campaignDivMap: {},\n  currentSessionId: null,\n  wiz_counter: 0, // to keep track of number of times we load the body\n  notifApi: {\n    notifEnabledFromApi: false\n  }, // helper variable to handle race condition and check when notifications were called\n  unsubGroups: [],\n  updatedCategoryLong: null\n  // domain: window.location.hostname, url -> getHostName()\n  // gcookie: -> device\n}\n","import { StorageManager } from './storage'\nimport { LRU_CACHE } from './constants'\n\nexport default class LRUCache {\n  #keyOrder\n\n  constructor (max) {\n    this.max = max\n    let lruCache = StorageManager.readFromLSorCookie(LRU_CACHE)\n    if (lruCache) {\n      const tempLruCache = {}\n      this.#keyOrder = []\n      lruCache = lruCache.cache\n      for (const entry in lruCache) {\n        if (lruCache.hasOwnProperty(entry)) {\n          tempLruCache[lruCache[entry][0]] = lruCache[entry][1]\n          this.#keyOrder.push(lruCache[entry][0])\n        }\n      }\n      this.cache = tempLruCache\n    } else {\n      this.cache = {}\n      this.#keyOrder = []\n    }\n  }\n\n  get (key) {\n    const item = this.cache[key]\n    if (item) {\n      this.cache = this.#deleteFromObject(key, this.cache)\n      this.cache[key] = item\n      this.#keyOrder.push(key)\n    }\n    this.saveCacheToLS(this.cache)\n    return item\n  }\n\n  set (key, value) {\n    const item = this.cache[key]\n    const allKeys = this.#keyOrder\n    if (item != null) {\n      this.cache = this.#deleteFromObject(key, this.cache)\n    } else if (allKeys.length === this.max) {\n      this.cache = this.#deleteFromObject(allKeys[0], this.cache)\n    }\n    this.cache[key] = value\n    if (this.#keyOrder[this.#keyOrder - 1] !== key) {\n      this.#keyOrder.push(key)\n    }\n    this.saveCacheToLS(this.cache)\n  }\n\n  saveCacheToLS (cache) {\n    const objToArray = []\n    const allKeys = this.#keyOrder\n    for (const index in allKeys) {\n      if (allKeys.hasOwnProperty(index)) {\n        const temp = []\n        temp.push(allKeys[index])\n        temp.push(cache[allKeys[index]])\n        objToArray.push(temp)\n      }\n    }\n    StorageManager.saveToLSorCookie(LRU_CACHE, { cache: objToArray })\n  }\n\n  getKey (value) {\n    if (value === null) {\n      return null\n    }\n    const allKeys = this.#keyOrder\n    for (const index in allKeys) {\n      if (allKeys.hasOwnProperty(index)) {\n        if (this.cache[allKeys[index]] === value) {\n          return allKeys[index]\n        }\n      }\n    }\n    return null\n  }\n\n  getSecondLastKey () {\n    const keysArr = this.#keyOrder\n    if (keysArr != null && keysArr.length > 1) {\n      return keysArr[keysArr.length - 2]\n    }\n    return -1\n  }\n\n  getLastKey () {\n    const keysLength = this.#keyOrder.length\n    if (keysLength) {\n      return this.#keyOrder[keysLength - 1]\n    }\n  }\n\n  #deleteFromObject (key, obj) {\n    const allKeys = JSON.parse(JSON.stringify(this.#keyOrder))\n    const newCache = {}\n    let indexToDelete\n    for (const index in allKeys) {\n      if (allKeys.hasOwnProperty(index)) {\n        if (allKeys[index] !== key) {\n          newCache[allKeys[index]] = obj[allKeys[index]]\n        } else {\n          indexToDelete = index\n        }\n      }\n    }\n    allKeys.splice(indexToDelete, 1)\n    this.#keyOrder = JSON.parse(JSON.stringify(allKeys))\n    return newCache\n  }\n}\n","import { COOKIE_EXPIRY, FIRE_PUSH_UNREGISTERED, GCOOKIE_NAME, KCOOKIE_NAME, LRU_CACHE_SIZE, USEIP_KEY } from '../util/constants'\nimport { isValueValid } from '../util/datatypes'\nimport { getNow } from '../util/datetime'\nimport LRUCache from '../util/lruCache'\nimport { StorageManager, $ct } from '../util/storage'\n\nexport default class CleverTapAPI {\n  #logger\n  #request\n  #device\n  #session\n\n  constructor ({ logger, request, device, session }) {\n    this.#logger = logger\n    this.#request = request\n    this.#device = device\n    this.#session = session\n  }\n\n  s (global, session, resume, respNumber, optOutResponse) {\n    // call back function used to store global and session ids for the user\n    if (typeof respNumber === 'undefined') {\n      respNumber = 0\n    }\n\n    StorageManager.removeBackup(respNumber, this.#logger)\n\n    if (respNumber > $ct.globalCache.REQ_N) {\n      // request for some other user so ignore\n      return\n    }\n\n    if (!isValueValid(this.#device.gcookie) || resume || typeof optOutResponse === 'boolean') {\n      if (!isValueValid(this.#device.gcookie)) {\n        // clear useIP meta prop\n        StorageManager.getAndClearMetaProp(USEIP_KEY)\n      }\n      this.#logger.debug(`Cookie was ${this.#device.gcookie} set to ${global}`)\n      this.#device.gcookie = global\n\n      if (global && StorageManager._isLocalStorageSupported()) {\n        if ($ct.LRU_CACHE == null) {\n          $ct.LRU_CACHE = new LRUCache(LRU_CACHE_SIZE)\n        }\n\n        const kIdFromLS = StorageManager.readFromLSorCookie(KCOOKIE_NAME)\n        if (kIdFromLS != null && kIdFromLS.id && resume) {\n          const guidFromLRUCache = $ct.LRU_CACHE.cache[kIdFromLS.id]\n          if (!guidFromLRUCache) {\n            StorageManager.saveToLSorCookie(FIRE_PUSH_UNREGISTERED, true)\n            $ct.LRU_CACHE.set(kIdFromLS.id, global)\n          }\n        }\n\n        StorageManager.saveToLSorCookie(GCOOKIE_NAME, global)\n        const lastK = $ct.LRU_CACHE.getSecondLastKey()\n        if (StorageManager.readFromLSorCookie(FIRE_PUSH_UNREGISTERED) && lastK !== -1) {\n          const lastGUID = $ct.LRU_CACHE.cache[lastK]\n          this.#request.unregisterTokenForGuid(lastGUID)\n        }\n      }\n\n      StorageManager.createBroadCookie(GCOOKIE_NAME, global, COOKIE_EXPIRY, window.location.hostname)\n      StorageManager.saveToLSorCookie(GCOOKIE_NAME, global)\n    }\n\n    if (resume) {\n      $ct.blockRequest = false\n      this.#logger.debug('Resumed requests')\n    }\n\n    if (StorageManager._isLocalStorageSupported()) {\n      this.#session.manageSession(session)\n    }\n\n    // session cookie\n    const obj = this.#session.getSessionCookieObject()\n\n    // for the race-condition where two responses come back with different session ids. don't write the older session id.\n    if (typeof obj.s === 'undefined' || obj.s <= session) {\n      obj.s = session\n      obj.t = getNow() // time of last response from server\n      this.#session.setSessionCookieObject(obj)\n    }\n\n    if (resume && !this.#request.processingBackup) {\n      this.#request.processBackupEvents()\n    }\n\n    $ct.globalCache.RESP_N = respNumber\n  }\n}\n","import { isValueValid } from '../util/datatypes'\nimport { StorageManager } from '../util/storage'\nimport { GCOOKIE_NAME, COOKIE_EXPIRY } from '../util/constants'\n\nexport default class DeviceManager {\n  #logger\n  gcookie\n\n  constructor ({ logger }) {\n    this.#logger = logger\n    this.gcookie = this.getGuid()\n  }\n\n  getGuid () {\n    let guid = null\n    if (isValueValid(this.gcookie)) {\n      return this.gcookie\n    }\n    if (StorageManager._isLocalStorageSupported()) {\n      const value = StorageManager.read(GCOOKIE_NAME)\n      if (isValueValid(value)) {\n        try {\n          guid = JSON.parse(decodeURIComponent(value))\n        } catch (e) {\n          this.#logger.debug('Cannot parse Gcookie from localstorage - must be encoded ' + value)\n          // assumming guids are of size 32. supporting both formats.\n          // guid can have encodedURIComponent or be without it.\n          // 1.56e4078ed15749928c042479ec2b4d47 - breaks on JSON.parse(decodeURIComponent())\n          // 2.%2256e4078ed15749928c042479ec2b4d47%22\n          if (value.length === 32) {\n            guid = value\n            StorageManager.saveToLSorCookie(GCOOKIE_NAME, value)\n          } else {\n            this.#logger.error('Illegal guid ' + value)\n          }\n        }\n\n        // Persist to cookie storage if not present there.\n        if (isValueValid(guid)) {\n          StorageManager.createBroadCookie(GCOOKIE_NAME, guid, COOKIE_EXPIRY, window.location.hostname)\n        }\n      }\n    }\n\n    if (!isValueValid(guid)) {\n      guid = StorageManager.readCookie(GCOOKIE_NAME)\n      if (isValueValid(guid) && (guid.indexOf('%') === 0 || guid.indexOf('\\'') === 0 || guid.indexOf('\"') === 0)) {\n        guid = null\n      }\n      if (isValueValid(guid)) {\n        StorageManager.saveToLSorCookie(GCOOKIE_NAME, guid)\n      }\n    }\n\n    return guid\n  }\n}\n","export const DATA_NOT_SENT_TEXT = 'This property has been ignored.'\nexport const INVALID_ACCOUNT = 'Invalid account ID'\nexport const INVALID_EVENT = 'Event structure not valid. Unable to process event'\nexport const CLEVERTAP_ERROR_PREFIX = 'CleverTap error:' // Formerly wzrk_error_txt\nexport const EMBED_ERROR = `${CLEVERTAP_ERROR_PREFIX} Incorrect embed script.`\nexport const EVENT_ERROR = `${CLEVERTAP_ERROR_PREFIX} Event structure not valid. ${DATA_NOT_SENT_TEXT}`\nexport const GENDER_ERROR = `${CLEVERTAP_ERROR_PREFIX} Gender value should be either M or F. ${DATA_NOT_SENT_TEXT}`\nexport const EMPLOYED_ERROR = `${CLEVERTAP_ERROR_PREFIX} Employed value should be either Y or N. ${DATA_NOT_SENT_TEXT}`\nexport const MARRIED_ERROR = `${CLEVERTAP_ERROR_PREFIX} Married value should be either Y or N. ${DATA_NOT_SENT_TEXT}`\nexport const EDUCATION_ERROR = `${CLEVERTAP_ERROR_PREFIX} Education value should be either School, College or Graduate. ${DATA_NOT_SENT_TEXT}`\nexport const AGE_ERROR = `${CLEVERTAP_ERROR_PREFIX} Age value should be a number. ${DATA_NOT_SENT_TEXT}`\nexport const DOB_ERROR = `${CLEVERTAP_ERROR_PREFIX} DOB value should be a Date Object`\nexport const OBJECT_ARRAY_ERROR = `${CLEVERTAP_ERROR_PREFIX} Expecting Object array in profile`\nexport const DATE_FORMAT_ERROR = `${CLEVERTAP_ERROR_PREFIX} setDate(number). number should be formatted as yyyymmdd`\nexport const ENUM_FORMAT_ERROR = `${CLEVERTAP_ERROR_PREFIX} setEnum(value). value should be a string or a number`\nexport const PHONE_FORMAT_ERROR = `${CLEVERTAP_ERROR_PREFIX} Phone number should be formatted as +[country code][number]`\n","import { isObject, isDateObject, isString, isNumber } from './datatypes'\nimport { convertToWZRKDate } from './datetime'\nimport { CHARGED_ID, CHARGEDID_COOKIE_NAME } from './constants'\nimport { StorageManager } from './storage'\n\nlet _globalChargedId\n\nexport const isEventStructureFlat = (eventObj) => {\n  // Events cannot have nested structure or Arrays\n  if (isObject(eventObj)) {\n    for (var key in eventObj) {\n      if (eventObj.hasOwnProperty(key)) {\n        if (isObject(eventObj[key]) || Array.isArray(eventObj[key])) {\n          return false\n        } else if (isDateObject(eventObj[key])) {\n          eventObj[key] = convertToWZRKDate(eventObj[key])\n        }\n      }\n    }\n    return true\n  }\n  return false\n}\n\nexport const isChargedEventStructureValid = (chargedObj, logger) => {\n  if (isObject(chargedObj)) {\n    for (var key in chargedObj) {\n      if (chargedObj.hasOwnProperty(key)) {\n        if (key === 'Items') {\n          if (!Array.isArray(chargedObj[key])) {\n            return false\n          }\n\n          if (chargedObj[key].length > 16) {\n            logger.reportError(522, 'Charged Items exceed 16 limit. Actual count: ' + chargedObj[key].length + '. Additional items will be dropped.')\n          }\n\n          for (var itemKey in chargedObj[key]) {\n            if (chargedObj[key].hasOwnProperty(itemKey)) { // since default array implementation could be overridden - e.g. Teabox site\n              if (!isObject(chargedObj[key][itemKey]) || !isEventStructureFlat(chargedObj[key][itemKey])) {\n                return false\n              }\n            }\n          }\n        } else {\n          if (isObject(chargedObj[key]) || Array.isArray(chargedObj[key])) {\n            return false\n          } else if (isDateObject(chargedObj[key])) {\n            chargedObj[key] = convertToWZRKDate(chargedObj[key])\n          }\n        }\n      }\n    }\n\n    if (isString(chargedObj[CHARGED_ID]) || isNumber(chargedObj[CHARGED_ID])) {\n      // save charged Id\n      const chargedId = chargedObj[CHARGED_ID] + '' // casting chargedId to string\n\n      if (typeof _globalChargedId === 'undefined') {\n        _globalChargedId = StorageManager.readFromLSorCookie(CHARGEDID_COOKIE_NAME)\n      }\n      if (typeof _globalChargedId !== 'undefined' && _globalChargedId.trim() === chargedId.trim()) {\n        // drop event- duplicate charged id\n        logger.error('Duplicate charged Id - Dropped' + chargedObj)\n        return false\n      }\n      _globalChargedId = chargedId\n      StorageManager.saveToLSorCookie(CHARGEDID_COOKIE_NAME, chargedId)\n    }\n    return true\n  } // if object (chargedObject)\n  return false\n}\n","import { isString, isObject, sanitize } from '../util/datatypes'\nimport { EVENT_ERROR } from '../util/messages'\nimport { EV_COOKIE, SYSTEM_EVENTS, unsupportedKeyCharRegex } from '../util/constants'\nimport { isChargedEventStructureValid, isEventStructureFlat } from '../util/validator'\nimport { StorageManager, $ct } from '../util/storage'\n\nexport default class EventHandler extends Array {\n  #logger\n  #oldValues\n  #request\n  #isPersonalisationActive\n\n  constructor ({ logger, request, isPersonalisationActive }, values) {\n    super()\n    this.#logger = logger\n    this.#oldValues = values\n    this.#request = request\n    this.#isPersonalisationActive = isPersonalisationActive\n  }\n\n  push (...eventsArr) {\n    this.#processEventArray(eventsArr)\n    return 0\n  }\n\n  _processOldValues () {\n    if (this.#oldValues) {\n      this.#processEventArray(this.#oldValues)\n    }\n    this.#oldValues = null\n  }\n\n  #processEventArray (eventsArr) {\n    if (Array.isArray(eventsArr)) {\n      while (eventsArr.length > 0) {\n        var eventName = eventsArr.shift()\n        if (!isString(eventName)) {\n          this.#logger.error(EVENT_ERROR)\n          continue\n        }\n\n        if (eventName.length > 1024) {\n          eventName = eventName.substring(0, 1024)\n          this.#logger.reportError(510, eventName + '... length exceeded 1024 chars. Trimmed.')\n        }\n\n        if (SYSTEM_EVENTS.includes(eventName)) {\n          this.#logger.reportError(513, eventName + ' is a restricted system event. It cannot be used as an event name.')\n          continue\n        }\n\n        const data = {}\n        data.type = 'event'\n        data.evtName = sanitize(eventName, unsupportedKeyCharRegex)\n\n        if (eventsArr.length !== 0) {\n          const eventObj = eventsArr.shift()\n          if (!isObject(eventObj)) {\n            // put it back if it is not an object\n            eventsArr.unshift(eventObj)\n          } else {\n            // check Charged Event vs. other events.\n            if (eventName === 'Charged') {\n              if (!isChargedEventStructureValid(eventObj, this.#logger)) {\n                this.#logger.reportError(511, 'Charged event structure invalid. Not sent.')\n                continue\n              }\n            } else {\n              if (!isEventStructureFlat(eventObj)) {\n                this.#logger.reportError(512, eventName + ' event structure invalid. Not sent.')\n                continue\n              }\n            }\n            data.evtData = eventObj\n          }\n        }\n\n        this.#request.processEvent(data)\n      }\n    }\n  }\n\n  getDetails (evtName) {\n    if (!this.#isPersonalisationActive()) {\n      return\n    }\n    if (typeof $ct.globalEventsMap === 'undefined') {\n      $ct.globalEventsMap = StorageManager.readFromLSorCookie(EV_COOKIE)\n    }\n    if (typeof $ct.globalEventsMap === 'undefined') {\n      return\n    }\n    const evtObj = $ct.globalEventsMap[evtName]\n    const respObj = {}\n    if (typeof evtObj !== 'undefined') {\n      respObj.firstTime = new Date(evtObj[1] * 1000)\n      respObj.lastTime = new Date(evtObj[2] * 1000)\n      respObj.count = evtObj[0]\n      return respObj\n    }\n  }\n}\n","export const getURLParams = (url) => {\n  const urlParams = {}\n  const idx = url.indexOf('?')\n\n  if (idx > 1) {\n    const uri = url.substring(idx + 1)\n    let match\n    const pl = /\\+/g // Regex for replacing addition symbol with a space\n    const search = /([^&=]+)=?([^&]*)/g\n    const decode = function (s) {\n      let replacement = s.replace(pl, ' ')\n      try {\n        replacement = decodeURIComponent(replacement)\n      } catch (e) {\n        // eat\n      }\n      return replacement\n    }\n    match = search.exec(uri)\n    while (match) {\n      urlParams[decode(match[1])] = decode(match[2])\n      match = search.exec(uri)\n    }\n  }\n  return urlParams\n}\n\nexport const getDomain = (url) => {\n  if (url === '') return ''\n  var a = document.createElement('a')\n  a.href = url\n  return a.hostname\n}\n\nexport const addToURL = (url, k, v) => {\n  return url + '&' + k + '=' + encodeURIComponent(v)\n}\n\nexport const getHostName = () => {\n  return window.location.hostname\n}\n","/* eslint-disable */\nexport const urlBase64ToUint8Array = (base64String) => {\n  let padding = '='.repeat((4 - base64String.length % 4) % 4)\n  let base64 = (base64String + padding)\n      .replace(/\\-/g, '+')\n      .replace(/_/g, '/')\n\n  let rawData = window.atob(base64)\n  let processedData = []\n  for (let i=0; i<rawData.length; i++) {\n    processedData.push(rawData.charCodeAt(i))\n  }\n  return new Uint8Array(processedData)\n}\n\nexport const compressData = (dataObject, logger) => {\n  logger && typeof logger.debug === 'function' && logger.debug('dobj:' + dataObject)\n  return compressToBase64(dataObject)\n}\n\nexport const compress = (uncompressed) => {\n  if (uncompressed == null) return ''\n  let i, value,\n      context_dictionary = {},\n      context_dictionaryToCreate = {},\n      context_c = '',\n      context_wc = '',\n      context_w = '',\n      context_enlargeIn = 2, // Compensate for the first entry which should not count\n      context_dictSize = 3,\n      context_numBits = 2,\n      context_data_string = '',\n      context_data_val = 0,\n      context_data_position = 0,\n      ii,\n      f = String.fromCharCode\n\n  for (ii = 0; ii < uncompressed.length; ii += 1) {\n    context_c = uncompressed.charAt(ii)\n    if (!Object.prototype.hasOwnProperty.call(context_dictionary, context_c)) {\n      context_dictionary[context_c] = context_dictSize++\n      context_dictionaryToCreate[context_c] = true\n    }\n\n    context_wc = context_w + context_c\n    if (Object.prototype.hasOwnProperty.call(context_dictionary, context_wc)) {\n      context_w = context_wc\n    } else {\n      if (Object.prototype.hasOwnProperty.call(context_dictionaryToCreate, context_w)) {\n        if (context_w.charCodeAt(0) < 256) {\n          for (i = 0; i < context_numBits; i++) {\n            context_data_val = (context_data_val << 1)\n            if (context_data_position == 15) {\n              context_data_position = 0\n              context_data_string += f(context_data_val)\n              context_data_val = 0\n            } else {\n              context_data_position++\n            }\n          }\n          value = context_w.charCodeAt(0)\n          for (i = 0; i < 8; i++) {\n            context_data_val = (context_data_val << 1) | (value & 1)\n            if (context_data_position == 15) {\n              context_data_position = 0\n              context_data_string += f(context_data_val)\n              context_data_val = 0\n            } else {\n              context_data_position++\n            }\n            value = value >> 1\n          }\n        } else {\n          value = 1\n          for (i = 0; i < context_numBits; i++) {\n            context_data_val = (context_data_val << 1) | value\n            if (context_data_position == 15) {\n              context_data_position = 0\n              context_data_string += f(context_data_val)\n              context_data_val = 0\n            } else {\n              context_data_position++\n            }\n            value = 0\n          }\n          value = context_w.charCodeAt(0)\n          for (i = 0; i < 16; i++) {\n            context_data_val = (context_data_val << 1) | (value & 1)\n            if (context_data_position == 15) {\n              context_data_position = 0\n              context_data_string += f(context_data_val)\n              context_data_val = 0\n            } else {\n              context_data_position++\n            }\n            value = value >> 1\n          }\n        }\n        context_enlargeIn--\n        if (context_enlargeIn == 0) {\n          context_enlargeIn = Math.pow(2, context_numBits)\n          context_numBits++\n        }\n        delete context_dictionaryToCreate[context_w]\n      } else {\n        value = context_dictionary[context_w];\n        for (i = 0; i < context_numBits; i++) {\n          context_data_val = (context_data_val << 1) | (value & 1)\n          if (context_data_position == 15) {\n            context_data_position = 0;\n            context_data_string += f(context_data_val)\n            context_data_val = 0\n          } else {\n            context_data_position++\n          }\n          value = value >> 1\n        }\n\n\n      }\n      context_enlargeIn--\n      if (context_enlargeIn == 0) {\n        context_enlargeIn = Math.pow(2, context_numBits)\n        context_numBits++\n      }\n      // Add wc to the dictionary.\n      context_dictionary[context_wc] = context_dictSize++\n      context_w = String(context_c)\n    }\n  }\n\n  // Output the code for w.\n  if (context_w !== '') {\n    if (Object.prototype.hasOwnProperty.call(context_dictionaryToCreate, context_w)) {\n      if (context_w.charCodeAt(0) < 256) {\n        for (i = 0; i < context_numBits; i++) {\n          context_data_val = (context_data_val << 1)\n          if (context_data_position == 15) {\n            context_data_position = 0\n            context_data_string += f(context_data_val)\n            context_data_val = 0\n          } else {\n            context_data_position++\n          }\n        }\n        value = context_w.charCodeAt(0)\n        for (i = 0; i < 8; i++) {\n          context_data_val = (context_data_val << 1) | (value & 1)\n          if (context_data_position == 15) {\n            context_data_position = 0\n            context_data_string += f(context_data_val)\n            context_data_val = 0\n          } else {\n            context_data_position++\n          }\n          value = value >> 1\n        }\n      } else {\n        value = 1\n        for (i = 0; i < context_numBits; i++) {\n          context_data_val = (context_data_val << 1) | value\n          if (context_data_position == 15) {\n            context_data_position = 0\n            context_data_string += f(context_data_val)\n            context_data_val = 0\n          } else {\n            context_data_position++\n          }\n          value = 0\n        }\n        value = context_w.charCodeAt(0);\n        for (i = 0; i < 16; i++) {\n          context_data_val = (context_data_val << 1) | (value & 1)\n          if (context_data_position == 15) {\n            context_data_position = 0\n            context_data_string += f(context_data_val)\n            context_data_val = 0\n          } else {\n            context_data_position++\n          }\n          value = value >> 1\n        }\n      }\n      context_enlargeIn--\n      if (context_enlargeIn == 0) {\n        context_enlargeIn = Math.pow(2, context_numBits)\n        context_numBits++\n      }\n      delete context_dictionaryToCreate[context_w]\n    } else {\n      value = context_dictionary[context_w]\n      for (i = 0; i < context_numBits; i++) {\n        context_data_val = (context_data_val << 1) | (value & 1)\n        if (context_data_position == 15) {\n          context_data_position = 0\n          context_data_string += f(context_data_val)\n          context_data_val = 0\n        } else {\n          context_data_position++\n        }\n        value = value >> 1\n      }\n\n\n    }\n    context_enlargeIn--\n    if (context_enlargeIn == 0) {\n      context_enlargeIn = Math.pow(2, context_numBits)\n      context_numBits++\n    }\n  }\n\n  // Mark the end of the stream\n  value = 2\n  for (i = 0; i < context_numBits; i++) {\n    context_data_val = (context_data_val << 1) | (value & 1)\n    if (context_data_position == 15) {\n      context_data_position = 0\n      context_data_string += f(context_data_val)\n      context_data_val = 0\n    } else {\n      context_data_position++\n    }\n    value = value >> 1\n  }\n\n  // Flush the last char\n  while (true) {\n    context_data_val = (context_data_val << 1)\n    if (context_data_position == 15) {\n      context_data_string += f(context_data_val)\n      break\n    } else context_data_position++\n  }\n  return context_data_string\n}\n\nexport const getKeyStr = () => {\n  let key = ''\n  let i = 0\n\n  for (i = 0; i <= 25; i++) {\n    key = key + String.fromCharCode(i + 65)\n  }\n\n  for (i = 0; i <= 25; i++) {\n    key = key + String.fromCharCode(i + 97)\n  }\n\n  for (i = 0; i < 10; i++) {\n    key = key + i\n  }\n\n  return key + '+/='\n}\n\nconst _keyStr = getKeyStr()\n\nexport const convertToFormattedHex = (byte_arr) => {\n  let hex_str = '',\n      i,\n      len,\n      tmp_hex\n\n  if (!Array.isArray(byte_arr)) {\n    return false\n  }\n\n  len = byte_arr.length\n\n  for (i = 0; i < len; ++i) {\n    if (byte_arr[i] < 0) {\n      byte_arr[i] = byte_arr[i] + 256\n    }\n    if (byte_arr[i] === undefined) {\n      byte_arr[i] = 0\n    }\n    tmp_hex = byte_arr[i].toString(16)\n\n    if (tmp_hex.length == 1) tmp_hex = '0' + tmp_hex // Add leading zero.\n\n    //        beautification - needed if you're printing this in the console, else keep commented\n    //        if ((i + 1) % 16 === 0) {\n    //          tmp_hex += \"\\n\";\n    //        } else {\n    //          tmp_hex += \" \";\n    //        }\n\n    hex_str += tmp_hex\n  }\n\n  return hex_str.trim()\n}\n\nexport const convertStringToHex = (s) => {\n  let byte_arr = []\n  for (let i = 0; i < s.length; i++) {\n    let value = s.charCodeAt(i)\n    byte_arr.push(value & 255)\n    byte_arr.push((value >> 8) & 255)\n  }\n  return convertToFormattedHex(byte_arr)\n}\n\nexport const compressToBase64 = (input) => {\n  if (input == null) return ''\n  var output = ''\n  var chr1, chr2, chr3, enc1, enc2, enc3, enc4\n  var i = 0\n\n  input = compress(input)\n\n  while (i < input.length * 2) {\n\n    if (i % 2 == 0) {\n      chr1 = input.charCodeAt(i / 2) >> 8\n      chr2 = input.charCodeAt(i / 2) & 255\n      if (i / 2 + 1 < input.length)\n        chr3 = input.charCodeAt(i / 2 + 1) >> 8\n      else\n        chr3 = NaN\n    } else {\n      chr1 = input.charCodeAt((i - 1) / 2) & 255\n      if ((i + 1) / 2 < input.length) {\n        chr2 = input.charCodeAt((i + 1) / 2) >> 8\n        chr3 = input.charCodeAt((i + 1) / 2) & 255\n      } else\n        chr2 = chr3 = NaN\n    }\n    i += 3\n\n    enc1 = chr1 >> 2;\n    enc2 = ((chr1 & 3) << 4) | (chr2 >> 4)\n    enc3 = ((chr2 & 15) << 2) | (chr3 >> 6)\n    enc4 = chr3 & 63\n\n    if (isNaN(chr2)) {\n      enc3 = enc4 = 64\n    } else if (isNaN(chr3)) {\n      enc4 = 64\n    }\n\n    output = output +\n      _keyStr.charAt(enc1) + _keyStr.charAt(enc2) +\n      _keyStr.charAt(enc3) + _keyStr.charAt(enc4)\n\n  }\n\n  return output\n}\n","import { ARP_COOKIE, MAX_TRIES, OPTOUT_COOKIE_ENDSWITH, USEIP_KEY } from './constants'\nimport { isString, isValueValid } from './datatypes'\nimport { compressData } from './encoder'\nimport { StorageManager, $ct } from './storage'\nimport { addToURL } from './url'\n\nexport default class RequestDispatcher {\n  static logger\n  static device\n\n  static #fireRequest (url, tries, skipARP, sendOULFlag) {\n    if (this.#dropRequestDueToOptOut()) {\n      this.logger.debug('req dropped due to optout cookie: ' + this.device.gcookie)\n      return\n    }\n\n    if (!isValueValid(this.device.gcookie) &&\n    ($ct.globalCache.RESP_N < $ct.globalCache.REQ_N - 1) &&\n    tries < MAX_TRIES) {\n      setTimeout(() => {\n        this.logger.debug(`retrying fire request for url: ${url}, tries: ${tries}`)\n        this.#fireRequest(url, tries + 1, skipARP, sendOULFlag)\n      }, 50)\n      return\n    }\n\n    if (!sendOULFlag) {\n      if (isValueValid(this.device.gcookie)) {\n        // add cookie to url\n        url = addToURL(url, 'gc', this.device.gcookie)\n      }\n      url = this.#addARPToRequest(url, skipARP)\n    }\n\n    url = this.#addUseIPToRequest(url)\n    url = addToURL(url, 'r', new Date().getTime()) // add epoch to beat caching of the URL\n    // TODO: Figure out a better way to handle plugin check\n    if (window.clevertap?.hasOwnProperty('plugin') || window.wizrocket?.hasOwnProperty('plugin')) {\n      // used to add plugin name in request parameter\n      const plugin = window.clevertap.plugin || window.wizrocket.plugin\n      url = addToURL(url, 'ct_pl', plugin)\n    }\n    if (url.indexOf('chrome-extension:') !== -1) {\n      url = url.replace('chrome-extension:', 'https:')\n    }\n\n    // TODO: Try using Function constructor instead of appending script.\n    var ctCbScripts = document.getElementsByClassName('ct-jp-cb')\n    while (ctCbScripts[0]) {\n      ctCbScripts[0].parentNode.removeChild(ctCbScripts[0])\n    }\n    const s = document.createElement('script')\n    s.setAttribute('type', 'text/javascript')\n    s.setAttribute('src', url)\n    s.setAttribute('class', 'ct-jp-cb')\n    s.setAttribute('rel', 'nofollow')\n    s.async = true\n\n    document.getElementsByTagName('head')[0].appendChild(s)\n    this.logger.debug('req snt -> url: ' + url)\n  }\n\n  static fireRequest (url, skipARP, sendOULFlag) {\n    this.#fireRequest(url, 1, skipARP, sendOULFlag)\n  }\n\n  static #dropRequestDueToOptOut () {\n    if ($ct.isOptInRequest || !isValueValid(this.device.gcookie) || !isString(this.device.gcookie)) {\n      $ct.isOptInRequest = false\n      return false\n    }\n    return this.device.gcookie.slice(-3) === OPTOUT_COOKIE_ENDSWITH\n  }\n\n  static #addUseIPToRequest (pageLoadUrl) {\n    var useIP = StorageManager.getMetaProp(USEIP_KEY)\n    if (typeof useIP !== 'boolean') {\n      useIP = false\n    }\n    return addToURL(pageLoadUrl, USEIP_KEY, useIP ? 'true' : 'false')\n  };\n\n  static #addARPToRequest (url, skipResARP) {\n    if (skipResARP === true) {\n      const _arp = {}\n      _arp.skipResARP = true\n      return addToURL(url, 'arp', compressData(JSON.stringify(_arp), this.logger))\n    }\n    if (StorageManager._isLocalStorageSupported() && typeof localStorage.getItem(ARP_COOKIE) !== 'undefined' && localStorage.getItem(ARP_COOKIE) !== null) {\n      return addToURL(url, 'arp', compressData(JSON.stringify(StorageManager.readFromLSorCookie(ARP_COOKIE)), this.logger))\n    }\n    return url\n  }\n}\n","// CleverTap specific utilities\n\nimport {\n  StorageManager,\n  $ct\n} from './storage'\nimport {\n  CAMP_COOKIE_NAME,\n  singleQuoteRegex,\n  PR_COOKIE,\n  ARP_COOKIE,\n  IS_OUL,\n  categoryLongKey\n} from './constants'\nimport {\n  GENDER_ERROR,\n  EMPLOYED_ERROR,\n  MARRIED_ERROR,\n  EDUCATION_ERROR,\n  AGE_ERROR,\n  DOB_ERROR,\n  PHONE_FORMAT_ERROR,\n  ENUM_FORMAT_ERROR\n} from './messages'\nimport {\n  getToday,\n  convertToWZRKDate,\n  setDate,\n  getNow\n} from './datetime'\nimport {\n  isObject,\n  isDateObject,\n  isConvertibleToNumber,\n  isObjectEmpty,\n  isString,\n  isNumber\n} from './datatypes'\nimport { addToURL, getURLParams } from './url'\nimport { compressData } from './encoder'\nimport RequestDispatcher from './requestDispatcher'\n\nexport const getCampaignObject = () => {\n  let campObj = {}\n  if (StorageManager._isLocalStorageSupported()) {\n    campObj = StorageManager.read(CAMP_COOKIE_NAME)\n    if (campObj != null) {\n      campObj = JSON.parse(decodeURIComponent(campObj).replace(singleQuoteRegex, '\\\"'))\n    } else {\n      campObj = {}\n    }\n  }\n  return campObj\n}\n\nexport const saveCampaignObject = (campaignObj) => {\n  if (StorageManager._isLocalStorageSupported()) {\n    const campObj = JSON.stringify(campaignObj)\n    StorageManager.save(CAMP_COOKIE_NAME, encodeURIComponent(campObj))\n  }\n}\n\nexport const getCampaignObjForLc = () => {\n  let campObj = {}\n  if (StorageManager._isLocalStorageSupported()) {\n    campObj = getCampaignObject()\n    let resultObj = []\n    const globalObj = campObj.global\n    const today = getToday()\n    const dailyObj = campObj[today]\n    if (typeof globalObj !== 'undefined') {\n      const campaignIdArray = Object.keys(globalObj)\n      for (const index in campaignIdArray) {\n        if (campaignIdArray.hasOwnProperty(index)) {\n          let dailyC = 0\n          let totalC = 0\n          const campaignId = campaignIdArray[index]\n          if (campaignId === 'tc') {\n            continue\n          }\n          if (typeof dailyObj !== 'undefined' && typeof dailyObj[campaignId] !== 'undefined') {\n            dailyC = dailyObj[campaignId]\n          }\n          if (typeof globalObj !== 'undefined' && typeof globalObj[campaignId] !== 'undefined') {\n            totalC = globalObj[campaignId]\n          }\n          const element = [campaignId, dailyC, totalC]\n          resultObj.push(element)\n        }\n      }\n    }\n    let todayC = 0\n    if (typeof dailyObj !== 'undefined' && typeof dailyObj.tc !== 'undefined') {\n      todayC = dailyObj.tc\n    }\n    resultObj = {\n      wmp: todayC,\n      tlc: resultObj\n    }\n    return resultObj\n  }\n}\n\nexport const isProfileValid = (profileObj, { logger }) => {\n  let valid = false\n  if (isObject(profileObj)) {\n    for (const profileKey in profileObj) {\n      if (profileObj.hasOwnProperty(profileKey)) {\n        valid = true\n        let profileVal = profileObj[profileKey]\n\n        if (profileVal == null) {\n          delete profileObj[profileKey]\n          continue\n        }\n        if (profileKey === 'Gender' && !profileVal.match(/^M$|^F$/)) {\n          valid = false\n          logger.error(GENDER_ERROR)\n        }\n\n        if (profileKey === 'Employed' && !profileVal.match(/^Y$|^N$/)) {\n          valid = false\n          logger.error(EMPLOYED_ERROR)\n        }\n\n        if (profileKey === 'Married' && !profileVal.match(/^Y$|^N$/)) {\n          valid = false\n          logger.error(MARRIED_ERROR)\n        }\n\n        if (profileKey === 'Education' && !profileVal.match(/^School$|^College$|^Graduate$/)) {\n          valid = false\n          logger.error(EDUCATION_ERROR)\n        }\n\n        if (profileKey === 'Age' && profileVal != null) {\n          if (isConvertibleToNumber(profileVal)) {\n            profileObj.Age = +profileVal\n          } else {\n            valid = false\n            logger.error(AGE_ERROR)\n          }\n        }\n        // dob will come in like this - $dt_19470815 or dateObject\n        if (profileKey === 'DOB') {\n          if (((!(/^\\$D_/).test(profileVal) || (profileVal + '').length !== 11)) && !isDateObject(profileVal)) {\n            valid = false\n            logger.error(DOB_ERROR)\n          }\n\n          if (isDateObject(profileVal)) {\n            profileObj[profileKey] = convertToWZRKDate(profileVal)\n          }\n        } else if (isDateObject(profileVal)) {\n          profileObj[profileKey] = convertToWZRKDate(profileVal)\n        }\n\n        if (profileKey === 'Phone' && !isObjectEmpty(profileVal)) {\n          if (profileVal.length > 8 && (profileVal.charAt(0) === '+')) { // valid phone number\n            profileVal = profileVal.substring(1, profileVal.length)\n            if (isConvertibleToNumber(profileVal)) {\n              profileObj.Phone = +profileVal\n            } else {\n              valid = false\n              logger.error(PHONE_FORMAT_ERROR + '. Removed.')\n            }\n          } else {\n            valid = false\n            logger.error(PHONE_FORMAT_ERROR + '. Removed.')\n          }\n        }\n\n        if (!valid) {\n          delete profileObj[profileKey]\n        }\n      }\n    }\n  }\n  return valid\n}\n\nexport const processFBUserObj = (user) => {\n  const profileData = {}\n  profileData.Name = user.name\n  if (user.id != null) {\n    profileData.FBID = user.id + ''\n  }\n  // Feb 2014 - FB announced over 58 gender options, hence we specifically look for male or female. Rest we don't care.\n  if (user.gender === 'male') {\n    profileData.Gender = 'M'\n  } else if (user.gender === 'female') {\n    profileData.Gender = 'F'\n  } else {\n    profileData.Gender = 'O'\n  }\n\n  const getHighestEducation = function (eduArr) {\n    if (eduArr != null) {\n      let college = ''\n      let highschool = ''\n\n      for (let i = 0; i < eduArr.length; i++) {\n        const edu = eduArr[i]\n        if (edu.type != null) {\n          const type = edu.type\n          if (type === 'Graduate School') {\n            return 'Graduate'\n          } else if (type === 'College') {\n            college = '1'\n          } else if (type === 'High School') {\n            highschool = '1'\n          }\n        }\n      }\n\n      if (college === '1') {\n        return 'College'\n      } else if (highschool === '1') {\n        return 'School'\n      }\n    }\n  }\n\n  if (user.relationship_status != null) {\n    profileData.Married = 'N'\n    if (user.relationship_status === 'Married') {\n      profileData.Married = 'Y'\n    }\n  }\n\n  const edu = getHighestEducation(user.education)\n  if (edu != null) {\n    profileData.Education = edu\n  }\n\n  const work = (user.work != null) ? user.work.length : 0\n  if (work > 0) {\n    profileData.Employed = 'Y'\n  } else {\n    profileData.Employed = 'N'\n  }\n\n  if (user.email != null) {\n    profileData.Email = user.email\n  }\n\n  if (user.birthday != null) {\n    const mmddyy = user.birthday.split('/') // comes in as \"08/15/1947\"\n    profileData.DOB = setDate(mmddyy[2] + mmddyy[0] + mmddyy[1])\n  }\n  return profileData\n}\n\nexport const processGPlusUserObj = (user, { logger }) => {\n  const profileData = {}\n  if (user.displayName != null) {\n    profileData.Name = user.displayName\n  }\n  if (user.id != null) {\n    profileData.GPID = user.id + ''\n  }\n\n  if (user.gender != null) {\n    if (user.gender === 'male') {\n      profileData.Gender = 'M'\n    } else if (user.gender === 'female') {\n      profileData.Gender = 'F'\n    } else if (user.gender === 'other') {\n      profileData.Gender = 'O'\n    }\n  }\n\n  if (user.image != null) {\n    if (user.image.isDefault === false) {\n      profileData.Photo = user.image.url.split('?sz')[0]\n    }\n  }\n\n  if (user.emails != null) {\n    for (let emailIdx = 0; emailIdx < user.emails.length; emailIdx++) {\n      const emailObj = user.emails[emailIdx]\n      if (emailObj.type === 'account') {\n        profileData.Email = emailObj.value\n      }\n    }\n  }\n\n  if (user.organizations != null) {\n    profileData.Employed = 'N'\n    for (let i = 0; i < user.organizations.length; i++) {\n      const orgObj = user.organizations[i]\n      if (orgObj.type === 'work') {\n        profileData.Employed = 'Y'\n      }\n    }\n  }\n\n  if (user.birthday != null) {\n    const yyyymmdd = user.birthday.split('-') // comes in as \"1976-07-27\"\n    profileData.DOB = setDate(yyyymmdd[0] + yyyymmdd[1] + yyyymmdd[2])\n  }\n\n  if (user.relationshipStatus != null) {\n    profileData.Married = 'N'\n    if (user.relationshipStatus === 'married') {\n      profileData.Married = 'Y'\n    }\n  }\n  logger.debug('gplus usr profile ' + JSON.stringify(profileData))\n\n  return profileData\n}\n\nexport const addToLocalProfileMap = (profileObj, override) => {\n  if (StorageManager._isLocalStorageSupported()) {\n    if ($ct.globalProfileMap == null) {\n      $ct.globalProfileMap = StorageManager.readFromLSorCookie(PR_COOKIE)\n      if ($ct.globalProfileMap == null) {\n        $ct.globalProfileMap = {}\n      }\n    }\n\n    // Move props from custom bucket to outside.\n    if (profileObj._custom != null) {\n      const keys = profileObj._custom\n      for (const key in keys) {\n        if (keys.hasOwnProperty(key)) {\n          profileObj[key] = keys[key]\n        }\n      }\n      delete profileObj._custom\n    }\n\n    for (const prop in profileObj) {\n      if (profileObj.hasOwnProperty(prop)) {\n        if ($ct.globalProfileMap.hasOwnProperty(prop) && !override) {\n          continue\n        }\n        $ct.globalProfileMap[prop] = profileObj[prop]\n      }\n    }\n    if ($ct.globalProfileMap._custom != null) {\n      delete $ct.globalProfileMap._custom\n    }\n    StorageManager.saveToLSorCookie(PR_COOKIE, $ct.globalProfileMap)\n  }\n}\n\nexport const closeIframe = (campaignId, divIdIgnored, currentSessionId) => {\n  if (campaignId != null && campaignId !== '-1') {\n    if (StorageManager._isLocalStorageSupported()) {\n      const campaignObj = getCampaignObject()\n\n      let sessionCampaignObj = campaignObj[currentSessionId]\n      if (sessionCampaignObj == null) {\n        sessionCampaignObj = {}\n        campaignObj[currentSessionId] = sessionCampaignObj\n      }\n      sessionCampaignObj[campaignId] = 'dnd'\n      saveCampaignObject(campaignObj)\n    }\n  }\n  if ($ct.campaignDivMap != null) {\n    const divId = $ct.campaignDivMap[campaignId]\n    if (divId != null) {\n      document.getElementById(divId).style.display = 'none'\n      if (divId === 'intentPreview') {\n        if (document.getElementById('intentOpacityDiv') != null) {\n          document.getElementById('intentOpacityDiv').style.display = 'none'\n        }\n      }\n    }\n  }\n}\n\nexport const arp = (jsonMap) => {\n  // For unregister calls dont set arp in LS\n  if (jsonMap.skipResARP != null && jsonMap.skipResARP) {\n    console.debug('Update ARP Request rejected', jsonMap)\n    return null\n  }\n\n  const isOULARP = !!((jsonMap[IS_OUL] != null && jsonMap[IS_OUL] === true))\n\n  if (StorageManager._isLocalStorageSupported()) {\n    try {\n      let arpFromStorage = StorageManager.readFromLSorCookie(ARP_COOKIE)\n      if (arpFromStorage == null || isOULARP) {\n        arpFromStorage = {}\n      }\n\n      for (const key in jsonMap) {\n        if (jsonMap.hasOwnProperty(key)) {\n          if (jsonMap[key] === -1) {\n            delete arpFromStorage[key]\n          } else {\n            arpFromStorage[key] = jsonMap[key]\n          }\n        }\n      }\n      StorageManager.saveToLSorCookie(ARP_COOKIE, arpFromStorage)\n    } catch (e) {\n      console.error('Unable to parse ARP JSON: ' + e)\n    }\n  }\n}\n\nexport const getWrappedLink = (link, targetId, type, request, account, logger) => {\n  let data = {}\n  data.sendTo = link\n  data.targetId = targetId\n  data.epoch = getNow()\n\n  if (type != null) {\n    data.type = type\n  } else {\n    data.type = 'view'\n  }\n\n  data = request.addSystemDataToObject(data, undefined)\n  return addToURL(account.recorderURL, 'd', compressData(JSON.stringify(data), logger))\n}\n\nexport const getMessageTemplate = () => {\n  return `<div class=\"notice-message\">\n    <a href=\"[RECORDER_HREF]\" class=\"box\">\n      <div class=\"avatar\"><span class=\"fa [ICON] fa-4x fa-fw\"></span></div>\n      <div class=\"info\">\n        <div class=\"title\">[TITLE]</div>\n        <div class=\"clearfix\"></div>\n        <div class=\"text\">[TEXT]</div>\n      </div>\n      <div class=\"clearfix\"></div>\n    </a>\n  </div>\n  <div class=\"clearfix\"></div>`\n}\n\nexport const getMessageHeadTemplate = () => {\n  return `<head>\n    <base target=\"_parent\" />\n    <link rel=\"stylesheet\" href=\"http://static.clevertap.com/fa/font-awesome.css\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <style>\n    [STYLE]\n    </style>\n  </head>`\n}\n\nexport const setEnum = (enumVal, logger) => {\n  if (isString(enumVal) || isNumber(enumVal)) {\n    return '$E_' + enumVal\n  }\n  logger.error(ENUM_FORMAT_ERROR)\n}\n\nexport const handleEmailSubscription = (subscription, reEncoded, fetchGroups, account, logger) => {\n  const urlParamsAsIs = getURLParams(location.href) // can't use url_params as it is in lowercase above\n  const encodedEmailId = urlParamsAsIs.e\n  const encodedProfileProps = urlParamsAsIs.p\n\n  if (typeof encodedEmailId !== 'undefined') {\n    const data = {}\n    data.id = account.id // accountId\n    data.unsubGroups = $ct.unsubGroups // unsubscribe groups\n\n    if ($ct.updatedCategoryLong) {\n      data[categoryLongKey] = $ct.updatedCategoryLong\n    }\n\n    let url = account.emailURL\n    if (fetchGroups) {\n      url = addToURL(url, 'fetchGroups', fetchGroups)\n    }\n    if (reEncoded) {\n      url = addToURL(url, 'encoded', reEncoded)\n    }\n    url = addToURL(url, 'e', encodedEmailId)\n    url = addToURL(url, 'd', compressData(JSON.stringify(data), logger))\n    if (encodedProfileProps) {\n      url = addToURL(url, 'p', encodedProfileProps)\n    }\n\n    if (subscription !== '-1') {\n      url = addToURL(url, 'sub', subscription)\n    }\n\n    RequestDispatcher.fireRequest(url)\n  }\n}\n","import {\n  isObjectEmpty\n} from '../util/datatypes'\nimport {\n  isProfileValid,\n  processFBUserObj,\n  processGPlusUserObj,\n  addToLocalProfileMap\n} from '../util/clevertap'\nimport {\n  EVT_PUSH,\n  PR_COOKIE\n} from '../util/constants'\nimport {\n  addToURL\n} from '../util/url'\nimport {\n  $ct\n} from '../util/storage'\nimport { compressData } from '../util/encoder'\nexport default class ProfileHandler extends Array {\n  #logger\n  #request\n  #account\n  #oldValues\n  #isPersonalisationActive\n\n  constructor ({\n    logger,\n    request,\n    account,\n    isPersonalisationActive\n  }, values) {\n    super()\n    this.#logger = logger\n    this.#request = request\n    this.#account = account\n    this.#oldValues = values\n    this.#isPersonalisationActive = isPersonalisationActive\n  }\n\n  push (...profilesArr) {\n    this.#processProfileArray(profilesArr)\n    return 0\n  }\n\n  _processOldValues () {\n    if (this.#oldValues) {\n      this.#processProfileArray(this.#oldValues)\n    }\n    this.#oldValues = null\n  }\n\n  getAttribute (propName) {\n    if (!this.#isPersonalisationActive()) {\n      return\n    }\n    if ($ct.globalProfileMap == null) {\n      $ct.globalProfileMap = StorageManager.readFromLSorCookie(PR_COOKIE)\n    }\n    if ($ct.globalProfileMap != null) {\n      return $ct.globalProfileMap[propName]\n    }\n  }\n\n  #processProfileArray (profileArr) {\n    if (Array.isArray(profileArr) && profileArr.length > 0) {\n      for (const index in profileArr) {\n        if (profileArr.hasOwnProperty(index)) {\n          const outerObj = profileArr[index]\n          let data = {}\n          let profileObj\n          if (outerObj.Site != null) { // organic data from the site\n            profileObj = outerObj.Site\n            if (isObjectEmpty(profileObj) || !isProfileValid(profileObj, {\n              logger: this.#logger\n            })) {\n              return\n            }\n          } else if (outerObj.Facebook != null) { // fb connect data\n            const FbProfileObj = outerObj.Facebook\n            // make sure that the object contains any data at all\n\n            if (!isObjectEmpty(FbProfileObj) && (!FbProfileObj.error)) {\n              profileObj = processFBUserObj(FbProfileObj)\n            }\n          } else if (outerObj['Google Plus'] != null) {\n            const GPlusProfileObj = outerObj['Google Plus']\n            if (!isObjectEmpty(GPlusProfileObj) && (!GPlusProfileObj.error)) {\n              profileObj = processGPlusUserObj(GPlusProfileObj, { logger: this.#logger })\n            }\n          }\n          if (profileObj != null && (!isObjectEmpty(profileObj))) { // profile got set from above\n            data.type = 'profile'\n            if (profileObj.tz == null) {\n              // try to auto capture user timezone if not present\n              profileObj.tz = new Date().toString().match(/([A-Z]+[\\+-][0-9]+)/)[1]\n            }\n\n            data.profile = profileObj\n            addToLocalProfileMap(profileObj, true)\n            data = this.#request.addSystemDataToObject(data, undefined)\n\n            this.#request.addFlags(data)\n            const compressedData = compressData(JSON.stringify(data), this.#logger)\n\n            let pageLoadUrl = this.#account.dataPostURL\n            pageLoadUrl = addToURL(pageLoadUrl, 'type', EVT_PUSH)\n            pageLoadUrl = addToURL(pageLoadUrl, 'd', compressedData)\n\n            this.#request.saveAndFireRequest(pageLoadUrl, $ct.blockRequeust)\n          }\n        }\n      }\n    }\n  }\n}\n","import {\n  isObject,\n  isObjectEmpty\n} from '../util/datatypes'\nimport {\n  KCOOKIE_NAME,\n  GCOOKIE_NAME,\n  EVT_PUSH,\n  LRU_CACHE_SIZE,\n  IS_OUL,\n  CAMP_COOKIE_NAME,\n  CHARGEDID_COOKIE_NAME,\n  PR_COOKIE,\n  EV_COOKIE,\n  ARP_COOKIE,\n  CLEAR,\n  META_COOKIE,\n  FIRE_PUSH_UNREGISTERED\n} from '../util/constants'\nimport {\n  StorageManager,\n  $ct\n} from '../util/storage'\nimport LRUCache from '../util/lruCache'\nimport {\n  compressData\n} from '../util/encoder'\nimport {\n  addToURL,\n  getHostName\n} from '../util/url'\nimport {\n  isProfileValid,\n  processFBUserObj,\n  processGPlusUserObj,\n  addToLocalProfileMap\n} from '../util/clevertap'\n\nexport default class UserLoginHandler extends Array {\n  #request\n  #logger\n  #account\n  #session\n  #oldValues\n  #device\n\n  constructor ({\n    request,\n    account,\n    session,\n    logger,\n    device\n  },\n  values) {\n    super()\n    this.#request = request\n    this.#account = account\n    this.#session = session\n    this.#logger = logger\n    this.#oldValues = values\n    this.#device = device\n  }\n\n  #processOUL (profileArr) {\n    let sendOULFlag = true\n    StorageManager.saveToLSorCookie(FIRE_PUSH_UNREGISTERED, sendOULFlag)\n    const addToK = (ids) => {\n      let k = StorageManager.readFromLSorCookie(KCOOKIE_NAME)\n      const g = StorageManager.readFromLSorCookie(GCOOKIE_NAME)\n      let kId\n      if (k == null) {\n        k = {}\n        kId = ids\n      } else { /* check if already exists */\n        kId = k.id\n        let anonymousUser = false\n        let foundInCache = false\n        if (kId == null) {\n          kId = ids[0]\n          anonymousUser = true\n        }\n\n        if ($ct.LRU_CACHE == null && StorageManager._isLocalStorageSupported()) {\n          $ct.LRU_CACHE = new LRUCache(LRU_CACHE_SIZE)\n        }\n\n        if (anonymousUser) {\n          if ((g) != null) {\n            $ct.LRU_CACHE.set(kId, g)\n            $ct.blockRequeust = false\n          }\n        } else {\n          for (const idx in ids) {\n            if (ids.hasOwnProperty(idx)) {\n              const id = ids[idx]\n              if ($ct.LRU_CACHE.cache[id]) {\n                kId = id\n                foundInCache = true\n                break\n              }\n            }\n          }\n        }\n\n        if (foundInCache) {\n          if (kId !== $ct.LRU_CACHE.getLastKey()) {\n            // New User found\n            this.#handleCookieFromCache()\n          } else {\n            sendOULFlag = false\n            StorageManager.saveToLSorCookie(FIRE_PUSH_UNREGISTERED, sendOULFlag)\n          }\n          const gFromCache = $ct.LRU_CACHE.get(kId)\n          $ct.LRU_CACHE.set(kId, gFromCache)\n          StorageManager.saveToLSorCookie(GCOOKIE_NAME, gFromCache)\n          this.#device.gcookie = gFromCache\n\n          const lastK = $ct.LRU_CACHE.getSecondLastKey()\n          if (StorageManager.readFromLSorCookie(FIRE_PUSH_UNREGISTERED) && lastK !== -1) {\n            // CACHED OLD USER FOUND. TRANSFER PUSH TOKEN TO THIS USER\n            const lastGUID = $ct.LRU_CACHE.cache[lastK]\n            this.#request.unregisterTokenForGuid(lastGUID)\n          }\n        } else {\n          if (!anonymousUser) {\n            this.clear()\n          } else {\n            if ((g) != null) {\n              this.#device.gcookie = g\n              StorageManager.saveToLSorCookie(GCOOKIE_NAME, g)\n              sendOULFlag = false\n            }\n          }\n          StorageManager.saveToLSorCookie(FIRE_PUSH_UNREGISTERED, false)\n          kId = ids[0]\n        }\n      }\n      k.id = kId\n      StorageManager.saveToLSorCookie(KCOOKIE_NAME, k)\n    }\n\n    if (Array.isArray(profileArr) && profileArr.length > 0) {\n      for (const index in profileArr) {\n        if (profileArr.hasOwnProperty(index)) {\n          const outerObj = profileArr[index]\n          let data = {}\n          let profileObj\n          if (outerObj.Site != null) { // organic data from the site\n            profileObj = outerObj.Site\n            if (isObjectEmpty(profileObj) || !isProfileValid(profileObj, {\n              logger: this.#logger\n            })) {\n              return\n            }\n          } else if (outerObj.Facebook != null) { // fb connect data\n            const FbProfileObj = outerObj.Facebook\n            // make sure that the object contains any data at all\n\n            if (!isObjectEmpty(FbProfileObj) && (!FbProfileObj.error)) {\n              profileObj = processFBUserObj(FbProfileObj)\n            }\n          } else if (outerObj['Google Plus'] != null) {\n            const GPlusProfileObj = outerObj['Google Plus']\n            if (isObjectEmpty(GPlusProfileObj) && (!GPlusProfileObj.error)) {\n              profileObj = processGPlusUserObj(GPlusProfileObj, { logger: this.#logger })\n            }\n          }\n          if (profileObj != null && (!isObjectEmpty(profileObj))) { // profile got set from above\n            data.type = 'profile'\n            if (profileObj.tz == null) {\n              // try to auto capture user timezone if not present\n              profileObj.tz = new Date().toString().match(/([A-Z]+[\\+-][0-9]+)/)[1]\n            }\n\n            data.profile = profileObj\n            const ids = []\n            if (StorageManager._isLocalStorageSupported()) {\n              if (profileObj.Identity != null) {\n                ids.push(profileObj.Identity)\n              }\n              if (profileObj.Email != null) {\n                ids.push(profileObj.Email)\n              }\n              if (profileObj.GPID != null) {\n                ids.push('GP:' + profileObj.GPID)\n              }\n              if (profileObj.FBID != null) {\n                ids.push('FB:' + profileObj.FBID)\n              }\n              if (ids.length > 0) {\n                addToK(ids)\n              }\n            }\n            addToLocalProfileMap(profileObj, true)\n            data = this.#request.addSystemDataToObject(data, undefined)\n\n            this.#request.addFlags(data)\n            // Adding 'isOUL' flag in true for OUL cases which.\n            // This flag tells LC to create a new arp object.\n            // Also we will receive the same flag in response arp which tells to delete existing arp object.\n            if (sendOULFlag) {\n              data[IS_OUL] = true\n            }\n\n            const compressedData = compressData(JSON.stringify(data), this.#logger)\n\n            let pageLoadUrl = this.#account.dataPostURL\n            pageLoadUrl = addToURL(pageLoadUrl, 'type', EVT_PUSH)\n            pageLoadUrl = addToURL(pageLoadUrl, 'd', compressedData)\n\n            // Whenever sendOULFlag is true then dont send arp and gcookie (guid in memory in the request)\n            // Also when this flag is set we will get another flag from LC in arp which tells us to delete arp\n            // stored in the cache and replace it with the response arp.\n            this.#request.saveAndFireRequest(pageLoadUrl, $ct.blockRequeust, sendOULFlag)\n          }\n        }\n      }\n    }\n  }\n\n  clear () {\n    this.#logger.debug('clear called. Reset flag has been set.')\n    this.#deleteUser()\n    StorageManager.setMetaProp(CLEAR, true)\n  }\n\n  #handleCookieFromCache () {\n    $ct.blockRequeust = false\n    console.debug('Block request is false')\n    if (StorageManager._isLocalStorageSupported()) {\n      delete localStorage[PR_COOKIE]\n      delete localStorage[EV_COOKIE]\n      delete localStorage[META_COOKIE]\n      delete localStorage[ARP_COOKIE]\n      delete localStorage[CAMP_COOKIE_NAME]\n      delete localStorage[CHARGEDID_COOKIE_NAME]\n    }\n    StorageManager.removeCookie(CAMP_COOKIE_NAME, getHostName())\n    StorageManager.removeCookie(this.#session.cookieName, $ct.broadDomain)\n    StorageManager.removeCookie(ARP_COOKIE, $ct.broadDomain)\n    this.#session.setSessionCookieObject('')\n  }\n\n  #deleteUser () {\n    $ct.blockRequeust = true\n    this.#logger.debug('Block request is true')\n    $ct.globalCache = {}\n    if (StorageManager._isLocalStorageSupported()) {\n      delete localStorage[GCOOKIE_NAME]\n      delete localStorage[KCOOKIE_NAME]\n      delete localStorage[PR_COOKIE]\n      delete localStorage[EV_COOKIE]\n      delete localStorage[META_COOKIE]\n      delete localStorage[ARP_COOKIE]\n      delete localStorage[CAMP_COOKIE_NAME]\n      delete localStorage[CHARGEDID_COOKIE_NAME]\n    }\n    StorageManager.removeCookie(GCOOKIE_NAME, $ct.broadDomain)\n    StorageManager.removeCookie(CAMP_COOKIE_NAME, getHostName())\n    StorageManager.removeCookie(KCOOKIE_NAME, getHostName())\n    StorageManager.removeCookie(this.#session.cookieName, $ct.broadDomain)\n    StorageManager.removeCookie(ARP_COOKIE, $ct.broadDomain)\n    this.#device.gcookie = null\n    this.#session.setSessionCookieObject('')\n  }\n\n  #processLoginArray (loginArr) {\n    if (Array.isArray(loginArr) && loginArr.length > 0) {\n      const profileObj = loginArr.pop()\n      const processProfile = profileObj != null && isObject(profileObj) &&\n          ((profileObj.Site != null && Object.keys(profileObj.Site).length > 0) ||\n              (profileObj.Facebook != null && Object.keys(profileObj.Facebook).length > 0) ||\n              (profileObj['Google Plus'] != null && Object.keys(profileObj['Google Plus']).length > 0))\n      if (processProfile) {\n        StorageManager.setInstantDeleteFlagInK()\n        try {\n          this.#processOUL([profileObj])\n        } catch (e) {\n          this.#logger.debug(e)\n        }\n      } else {\n        this.#logger.error('Profile object is in incorrect format')\n      }\n    }\n  }\n\n  push (...profilesArr) {\n    this.#processLoginArray(profilesArr)\n    return 0\n  }\n\n  _processOldValues () {\n    if (this.#oldValues) {\n      this.#processLoginArray(this.#oldValues)\n    }\n    this.#oldValues = null\n  }\n}\n","import {\n  addToLocalProfileMap,\n  arp,\n  getCampaignObject,\n  saveCampaignObject,\n  closeIframe\n} from './clevertap'\n\nimport {\n  CAMP_COOKIE_NAME,\n  DISPLAY,\n  GLOBAL,\n  EV_COOKIE,\n  NOTIFICATION_VIEWED,\n  NOTIFICATION_CLICKED,\n  WZRK_PREFIX,\n  WZRK_ID\n} from './constants'\n\nimport {\n  getNow,\n  getToday\n} from './datetime'\n\nimport {\n  compressToBase64\n} from './encoder'\n\nimport { StorageManager, $ct } from './storage'\nimport RequestDispatcher from './requestDispatcher'\n\nconst _tr = (msg, {\n  device,\n  session,\n  request,\n  logger\n}) => {\n  const _device = device\n  const _session = session\n  const _request = request\n  const _logger = logger\n  let _wizCounter = 0\n\n  const doCampHouseKeeping = (targetingMsgJson) => {\n    const campaignId = targetingMsgJson.wzrk_id.split('_')[0]\n    const today = getToday()\n\n    const incrCount = (obj, campaignId, excludeFromFreqCaps) => {\n      let currentCount = 0\n      let totalCount = 0\n      if (obj[campaignId] != null) {\n        currentCount = obj[campaignId]\n      }\n      currentCount++\n      if (obj.tc != null) {\n        totalCount = obj.tc\n      }\n      // if exclude from caps then dont add to total counts\n      if (excludeFromFreqCaps < 0) {\n        totalCount++\n      }\n\n      obj.tc = totalCount\n      obj[campaignId] = currentCount\n    }\n\n    if (StorageManager._isLocalStorageSupported()) {\n      delete sessionStorage[CAMP_COOKIE_NAME]\n      const campObj = getCampaignObject()\n\n      // global session limit. default is 1\n      if (targetingMsgJson[DISPLAY].wmc == null) {\n        targetingMsgJson[DISPLAY].wmc = 1\n      }\n\n      var excludeFromFreqCaps = -1\n      let campaignSessionLimit = -1\n      let campaignDailyLimit = -1\n      let campaignTotalLimit = -1\n      let totalDailyLimit = -1\n      let totalSessionLimit = -1\n\n      if (targetingMsgJson[DISPLAY].efc != null) {\n        excludeFromFreqCaps = parseInt(targetingMsgJson[DISPLAY].efc, 10)\n      }\n      if (targetingMsgJson[DISPLAY].mdc != null) {\n        campaignSessionLimit = parseInt(targetingMsgJson[DISPLAY].mdc, 10)\n      }\n      if (targetingMsgJson[DISPLAY].tdc != null) {\n        campaignDailyLimit = parseInt(targetingMsgJson[DISPLAY].tdc, 10)\n      }\n      if (targetingMsgJson[DISPLAY].tlc != null) {\n        campaignTotalLimit = parseInt(targetingMsgJson[DISPLAY].tlc, 10)\n      }\n      if (targetingMsgJson[DISPLAY].wmp != null) {\n        totalDailyLimit = parseInt(targetingMsgJson[DISPLAY].wmp, 10)\n      }\n      if (targetingMsgJson[DISPLAY].wmc != null) {\n        totalSessionLimit = parseInt(targetingMsgJson[DISPLAY].wmc, 10)\n      }\n\n      // session level capping\n      let sessionObj = campObj[_session.sessionId]\n      if (sessionObj) {\n        const campaignSessionCount = sessionObj[campaignId]\n        const totalSessionCount = sessionObj.tc\n        // dnd\n        if (campaignSessionCount === 'dnd') {\n          return false\n        }\n\n        // session\n        if (totalSessionLimit > 0 && totalSessionCount >= totalSessionLimit && excludeFromFreqCaps < 0) {\n          return false\n        }\n        // campaign session\n        if (campaignSessionLimit > 0 && campaignSessionCount >= campaignSessionLimit) {\n          return false\n        }\n      } else {\n        sessionObj = {}\n        campObj[_session.sessionId] = sessionObj\n      }\n\n      // daily level capping\n      var dailyObj = campObj[today]\n      if (dailyObj != null) {\n        const campaignDailyCount = dailyObj[campaignId]\n        const totalDailyCount = dailyObj.tc\n        // daily\n        if (totalDailyLimit > 0 && totalDailyCount >= totalDailyLimit && excludeFromFreqCaps < 0) {\n          return false\n        }\n        // campaign daily\n        if (campaignDailyLimit > 0 && campaignDailyCount >= campaignDailyLimit) {\n          return false\n        }\n      } else {\n        dailyObj = {}\n        campObj[today] = dailyObj\n      }\n\n      var globalObj = campObj[GLOBAL]\n      if (globalObj != null) {\n        const campaignTotalCount = globalObj[campaignId]\n        // campaign total\n        if (campaignTotalLimit > 0 && campaignTotalCount >= campaignTotalLimit) {\n          return false\n        }\n      } else {\n        globalObj = {}\n        campObj[GLOBAL] = globalObj\n      }\n    }\n    // delay\n    if (targetingMsgJson[DISPLAY].delay != null && targetingMsgJson[DISPLAY].delay > 0) {\n      const delay = targetingMsgJson[DISPLAY].delay\n      targetingMsgJson[DISPLAY].delay = 0\n      setTimeout(_tr, delay * 1000, msg, {\n        device: _device,\n        session: _session,\n        request: _request,\n        logger: _logger\n      })\n      return false\n    }\n    const sessionObj = _session.getSessionCookieObject()\n\n    incrCount(sessionObj, campaignId, excludeFromFreqCaps)\n    incrCount(dailyObj, campaignId, excludeFromFreqCaps)\n    incrCount(globalObj, campaignId, excludeFromFreqCaps)\n\n    // get ride of stale sessions and day entries\n    const newCampObj = {}\n    newCampObj[_session.sessionId] = sessionObj\n    newCampObj[today] = dailyObj\n    newCampObj[GLOBAL] = globalObj\n    saveCampaignObject(newCampObj)\n  }\n\n  const getCookieParams = () => {\n    const gcookie = _device.getGuid()\n    const scookieObj = _session.getSessionCookieObject()\n    return '&t=wc&d=' + encodeURIComponent(compressToBase64(gcookie + '|' + scookieObj.p + '|' + scookieObj.s))\n  }\n\n  const setupClickEvent = (onClick, targetingMsgJson, contentDiv, divId, isLegacy) => {\n    if (onClick !== '' && onClick != null) {\n      let ctaElement\n      let jsCTAElements\n      if (isLegacy) {\n        ctaElement = contentDiv\n      } else {\n        jsCTAElements = contentDiv.getElementsByClassName('jsCT_CTA')\n        if (jsCTAElements != null && jsCTAElements.length === 1) {\n          ctaElement = jsCTAElements[0]\n        }\n      }\n      const jsFunc = targetingMsgJson.display.jsFunc\n      const isPreview = targetingMsgJson.display.preview\n      if (isPreview == null) {\n        onClick += getCookieParams()\n      }\n\n      if (ctaElement != null) {\n        ctaElement.onclick = () => {\n          // invoke js function call\n          if (jsFunc != null) {\n            // track notification clicked event\n            if (isPreview == null) {\n              RequestDispatcher.fireRequest(onClick)\n            }\n            invokeExternalJs(jsFunc, targetingMsgJson)\n            // close iframe. using -1 for no campaignId\n            closeIframe('-1', divId, _session.sessionId)\n            return\n          }\n          // pass on the gcookie|page|scookieId for capturing the click event\n          if (targetingMsgJson.display.window === 1) {\n            window.open(onClick, '_blank')\n          } else {\n            window.location = onClick\n          }\n        }\n      }\n    }\n  }\n\n  const invokeExternalJs = (jsFunc, targetingMsgJson) => {\n    const func = window.parent[jsFunc]\n    if (typeof func === 'function') {\n      if (targetingMsgJson.display.kv != null) {\n        func(targetingMsgJson.display.kv)\n      } else {\n        func()\n      }\n    }\n  }\n\n  const setupClickUrl = (onClick, targetingMsgJson, contentDiv, divId, isLegacy) => {\n    incrementImpression(targetingMsgJson)\n    setupClickEvent(onClick, targetingMsgJson, contentDiv, divId, isLegacy)\n  }\n\n  const incrementImpression = (targetingMsgJson) => {\n    const data = {}\n    data.type = 'event'\n    data.evtName = NOTIFICATION_VIEWED\n    data.evtData = { [WZRK_ID]: targetingMsgJson.wzrk_id }\n    _request.processEvent(data)\n  }\n\n  const renderFooterNotification = (targetingMsgJson) => {\n    const campaignId = targetingMsgJson.wzrk_id.split('_')[0]\n    const displayObj = targetingMsgJson.display\n\n    if (displayObj.layout === 1) {\n      return showExitIntent(undefined, targetingMsgJson)\n    }\n    if (doCampHouseKeeping(targetingMsgJson) === false) {\n      return\n    }\n\n    const divId = 'wizParDiv' + displayObj.layout\n\n    if (document.getElementById(divId) != null) {\n      return\n    }\n    $ct.campaignDivMap[campaignId] = divId\n    const isBanner = displayObj.layout === 2\n    const msgDiv = document.createElement('div')\n    msgDiv.id = divId\n    const viewHeight = window.innerHeight\n    const viewWidth = window.innerWidth\n    let legacy = false\n\n    if (!isBanner) {\n      const marginBottom = viewHeight * 5 / 100\n      var contentHeight = 10\n      let right = viewWidth * 5 / 100\n      let bottomPosition = contentHeight + marginBottom\n      let width = viewWidth * 30 / 100 + 20\n      let widthPerct = 'width:30%;'\n      // for small devices  - mobile phones\n      if ((/mobile/i.test(navigator.userAgent) || (/mini/i.test(navigator.userAgent))) && /iPad/i.test(navigator.userAgent) === false) {\n        width = viewWidth * 85 / 100 + 20\n        right = viewWidth * 5 / 100\n        bottomPosition = viewHeight * 5 / 100\n        widthPerct = 'width:80%;'\n        // medium devices - tablets\n      } else if ('ontouchstart' in window || (/tablet/i.test(navigator.userAgent))) {\n        width = viewWidth * 50 / 100 + 20\n        right = viewWidth * 5 / 100\n        bottomPosition = viewHeight * 5 / 100\n        widthPerct = 'width:50%;'\n      }\n      // legacy footer notif\n      if (displayObj.proto == null) {\n        legacy = true\n        msgDiv.setAttribute('style', 'display:block;overflow:hidden; bottom:' + bottomPosition + 'px !important;width:' + width + 'px !important;right:' + right + 'px !important;position:fixed;z-index:2147483647;')\n      } else {\n        msgDiv.setAttribute('style', widthPerct + displayObj.iFrameStyle)\n      }\n    } else {\n      msgDiv.setAttribute('style', displayObj.iFrameStyle)\n    }\n    document.body.appendChild(msgDiv)\n    const iframe = document.createElement('iframe')\n\n    const borderRadius = displayObj.br === false ? '0' : '8'\n\n    iframe.frameborder = '0px'\n    iframe.marginheight = '0px'\n    iframe.marginwidth = '0px'\n    iframe.scrolling = 'no'\n    iframe.id = 'wiz-iframe'\n    const onClick = targetingMsgJson.display.onClick\n    let pointerCss = ''\n    if (onClick !== '' && onClick != null) {\n      pointerCss = 'cursor:pointer;'\n    }\n\n    let html\n    // direct html\n    if (targetingMsgJson.msgContent.type === 1) {\n      html = targetingMsgJson.msgContent.html\n      html = html.replace(/##campaignId##/g, campaignId)\n    } else {\n      const css = '' +\n        '<style type=\"text/css\">' +\n        'body{margin:0;padding:0;}' +\n        '#contentDiv.wzrk{overflow:hidden;padding:0;text-align:center;' + pointerCss + '}' +\n        '#contentDiv.wzrk td{padding:15px 10px;}' +\n        '.wzrkPPtitle{font-weight: bold;font-size: 16px;font-family:arial;padding-bottom:10px;word-break: break-word;}' +\n        '.wzrkPPdscr{font-size: 14px;font-family:arial;line-height:16px;word-break: break-word;display:inline-block;}' +\n        '.PL15{padding-left:15px;}' +\n        '.wzrkPPwarp{margin:20px 20px 0 5px;padding:0px;border-radius: ' + borderRadius + 'px;box-shadow: 1px 1px 5px #888888;}' +\n        'a.wzrkClose{cursor:pointer;position: absolute;top: 11px;right: 11px;z-index: 2147483647;font-size:19px;font-family:arial;font-weight:bold;text-decoration: none;width: 25px;/*height: 25px;*/text-align: center; -webkit-appearance: none; line-height: 25px;' +\n        'background: #353535;border: #fff 2px solid;border-radius: 100%;box-shadow: #777 2px 2px 2px;color:#fff;}' +\n        'a:hover.wzrkClose{background-color:#d1914a !important;color:#fff !important; -webkit-appearance: none;}' +\n        'td{vertical-align:top;}' +\n        'td.imgTd{border-top-left-radius:8px;border-bottom-left-radius:8px;}' +\n        '</style>'\n\n      let bgColor, textColor, btnBg, leftTd, btColor\n      if (targetingMsgJson.display.theme === 'dark') {\n        bgColor = '#2d2d2e'\n        textColor = '#eaeaea'\n        btnBg = '#353535'\n        leftTd = '#353535'\n        btColor = '#ffffff'\n      } else {\n        bgColor = '#ffffff'\n        textColor = '#000000'\n        leftTd = '#f4f4f4'\n        btnBg = '#a5a6a6'\n        btColor = '#ffffff'\n      }\n      const titleText = targetingMsgJson.msgContent.title\n      const descriptionText = targetingMsgJson.msgContent.description\n      let imageTd = ''\n      if (targetingMsgJson.msgContent.imageUrl != null && targetingMsgJson.msgContent.imageUrl !== '') {\n        imageTd = \"<td class='imgTd' style='background-color:\" + leftTd + \"'><img src='\" + targetingMsgJson.msgContent.imageUrl + \"' height='60' width='60'></td>\"\n      }\n      const onClickStr = 'parent.$WZRK_WR.closeIframe(' + campaignId + \",'\" + divId + \"');\"\n      const title = \"<div class='wzrkPPwarp' style='color:\" + textColor + ';background-color:' + bgColor + \";'>\" +\n        \"<a href='javascript:void(0);' onclick=\" + onClickStr + \" class='wzrkClose' style='background-color:\" + btnBg + ';color:' + btColor + \"'>&times;</a>\" +\n        \"<div id='contentDiv' class='wzrk'>\" +\n        \"<table cellpadding='0' cellspacing='0' border='0'>\" +\n        // \"<tr><td colspan='2'></td></tr>\"+\n        '<tr>' + imageTd + \"<td style='vertical-align:top;'>\" +\n        \"<div class='wzrkPPtitle' style='color:\" + textColor + \"'>\" + titleText + '</div>'\n      const body = \"<div class='wzrkPPdscr' style='color:\" + textColor + \"'>\" + descriptionText + '<div></td></tr></table></div>'\n      html = css + title + body\n    }\n\n    iframe.setAttribute('style', 'z-index: 2147483647; display:block; width: 100% !important; border:0px !important; border-color:none !important;')\n    msgDiv.appendChild(iframe)\n    const ifrm = (iframe.contentWindow) ? iframe.contentWindow : (iframe.contentDocument.document) ? iframe.contentDocument.document : iframe.contentDocument\n    const doc = ifrm.document\n\n    doc.open()\n    doc.write(html)\n    doc.close()\n\n    const adjustIFrameHeight = () => {\n      // adjust iframe and body height of html inside correctly\n      contentHeight = document.getElementById('wiz-iframe').contentDocument.getElementById('contentDiv').scrollHeight\n      if (displayObj['custom-editor'] !== true && !isBanner) {\n        contentHeight += 25\n      }\n      document.getElementById('wiz-iframe').contentDocument.body.style.margin = '0px'\n      document.getElementById('wiz-iframe').style.height = contentHeight + 'px'\n    }\n\n    const ua = navigator.userAgent.toLowerCase()\n    if (ua.indexOf('safari') !== -1) {\n      if (ua.indexOf('chrome') > -1) {\n        iframe.onload = () => {\n          adjustIFrameHeight()\n          const contentDiv = document.getElementById('wiz-iframe').contentDocument.getElementById('contentDiv')\n          setupClickUrl(onClick, targetingMsgJson, contentDiv, divId, legacy)\n        }\n      } else {\n        let inDoc = iframe.contentDocument || iframe.contentWindow\n        if (inDoc.document) inDoc = inDoc.document\n        // safari iphone 7+ needs this.\n        adjustIFrameHeight()\n        const _timer = setInterval(() => {\n          if (inDoc.readyState === 'complete') {\n            clearInterval(_timer)\n            // adjust iframe and body height of html inside correctly\n            adjustIFrameHeight()\n            const contentDiv = document.getElementById('wiz-iframe').contentDocument.getElementById('contentDiv')\n            setupClickUrl(onClick, targetingMsgJson, contentDiv, divId, legacy)\n          }\n        }, 10)\n      }\n    } else {\n      iframe.onload = () => {\n        // adjust iframe and body height of html inside correctly\n        adjustIFrameHeight()\n        const contentDiv = document.getElementById('wiz-iframe').contentDocument.getElementById('contentDiv')\n        setupClickUrl(onClick, targetingMsgJson, contentDiv, divId, legacy)\n      }\n    }\n  }\n\n  let _callBackCalled = false\n\n  const showFooterNotification = (targetingMsgJson) => {\n    let onClick = targetingMsgJson.display.onClick\n\n    // TODO: Needs wizrocket as a global variable\n    if (window.clevertap.hasOwnProperty('notificationCallback') &&\n      typeof window.clevertap.notificationCallback !== 'undefined' &&\n      typeof window.clevertap.notificationCallback === 'function') {\n      const notificationCallback = window.clevertap.notificationCallback\n\n      if (!_callBackCalled) {\n        const inaObj = {}\n        inaObj.msgContent = targetingMsgJson.msgContent\n        inaObj.msgId = targetingMsgJson.wzrk_id\n        if (targetingMsgJson.display.kv != null) {\n          inaObj.kv = targetingMsgJson.display.kv\n        }\n\n        window.clevertap.raiseNotificationClicked = () => {\n          if (onClick !== '' && onClick != null) {\n            const jsFunc = targetingMsgJson.display.jsFunc\n            onClick += getCookieParams()\n\n            // invoke js function call\n            if (jsFunc != null) {\n              // track notification clicked event\n              RequestDispatcher.fireRequest(onClick)\n              invokeExternalJs(jsFunc, targetingMsgJson)\n              return\n            }\n            // pass on the gcookie|page|scookieId for capturing the click event\n            if (targetingMsgJson.display.window === 1) {\n              window.open(onClick, '_blank')\n            } else {\n              window.location = onClick\n            }\n          }\n        }\n        window.clevertap.raiseNotificationViewed = () => {\n          incrementImpression(targetingMsgJson)\n        }\n        notificationCallback(inaObj)\n        _callBackCalled = true\n      }\n    } else {\n      renderFooterNotification(targetingMsgJson)\n\n      if (window.clevertap.hasOwnProperty('popupCallback') &&\n        typeof window.clevertap.popupCallback !== 'undefined' &&\n        typeof window.clevertap.popupCallback === 'function') {\n        const popupCallback = window.clevertap.popupCallback\n\n        const inaObj = {}\n        inaObj.msgContent = targetingMsgJson.msgContent\n        inaObj.msgId = targetingMsgJson.wzrk_id\n\n        var msgCTkv = []\n        for (var wzrkPrefixKey in targetingMsgJson) {\n          // ADD WZRK PREFIX KEY VALUE PAIRS\n          if (wzrkPrefixKey.startsWith(WZRK_PREFIX) && wzrkPrefixKey !== WZRK_ID) {\n            const wzrkJson = { [wzrkPrefixKey]: targetingMsgJson[wzrkPrefixKey] }\n            msgCTkv.push(wzrkJson)\n          }\n        }\n\n        if (msgCTkv.length > 0) {\n          inaObj.msgCTkv = msgCTkv\n        }\n        if (targetingMsgJson.display.kv != null) {\n          inaObj.kv = targetingMsgJson.display.kv\n        }\n\n        // PUBLIC API TO RECORD CLICKED EVENT\n        window.clevertap.raisePopupNotificationClicked = (notificationData) => {\n          if (!notificationData || !notificationData.msgId) { return }\n\n          const eventData = {}\n          eventData.type = 'event'\n          eventData.evtName = NOTIFICATION_CLICKED\n          eventData.evtData = { [WZRK_ID]: notificationData.msgId }\n\n          // WZRK PREFIX KEY VALUE PAIRS\n          if (notificationData.msgCTkv) {\n            for (var wzrkPrefixObj of notificationData.msgCTkv) {\n              eventData.evtData = { ...eventData.evtData, ...wzrkPrefixObj }\n            }\n          }\n\n          _request.processEvent(eventData)\n        }\n        popupCallback(inaObj)\n      }\n    }\n  }\n  let exitintentObj\n  const showExitIntent = (event, targetObj) => {\n    let targetingMsgJson\n    if (event != null && event.clientY > 0) {\n      return\n    }\n    if (targetObj == null) {\n      targetingMsgJson = exitintentObj\n    } else {\n      targetingMsgJson = targetObj\n    }\n\n    if (document.getElementById('intentPreview') != null) {\n      return\n    }\n    // dont show exit intent on tablet/mobile - only on desktop\n    if (targetingMsgJson.display.layout == null &&\n      ((/mobile/i.test(navigator.userAgent)) || (/mini/i.test(navigator.userAgent)) || (/iPad/i.test(navigator.userAgent)) ||\n        ('ontouchstart' in window) || (/tablet/i.test(navigator.userAgent)))) {\n      return\n    }\n\n    const campaignId = targetingMsgJson.wzrk_id.split('_')[0]\n    if (doCampHouseKeeping(targetingMsgJson) === false) {\n      return\n    }\n\n    $ct.campaignDivMap[campaignId] = 'intentPreview'\n    let legacy = false\n    const opacityDiv = document.createElement('div')\n    opacityDiv.id = 'intentOpacityDiv'\n    opacityDiv.setAttribute('style', 'position: fixed;top: 0;bottom: 0;left: 0;width: 100%;height: 100%;z-index: 2147483646;background: rgba(0,0,0,0.7);')\n    document.body.appendChild(opacityDiv)\n\n    const msgDiv = document.createElement('div')\n    msgDiv.id = 'intentPreview'\n\n    if (targetingMsgJson.display.proto == null) {\n      legacy = true\n      msgDiv.setAttribute('style', 'display:block;overflow:hidden;top:55% !important;left:50% !important;position:fixed;z-index:2147483647;width:600px !important;height:600px !important;margin:-300px 0 0 -300px !important;')\n    } else {\n      msgDiv.setAttribute('style', targetingMsgJson.display.iFrameStyle)\n    }\n    document.body.appendChild(msgDiv)\n    const iframe = document.createElement('iframe')\n    const borderRadius = targetingMsgJson.display.br === false ? '0' : '8'\n    iframe.frameborder = '0px'\n    iframe.marginheight = '0px'\n    iframe.marginwidth = '0px'\n    iframe.scrolling = 'no'\n    iframe.id = 'wiz-iframe-intent'\n    const onClick = targetingMsgJson.display.onClick\n    let pointerCss = ''\n    if (onClick !== '' && onClick != null) {\n      pointerCss = 'cursor:pointer;'\n    }\n    let html\n    // direct html\n    if (targetingMsgJson.msgContent.type === 1) {\n      html = targetingMsgJson.msgContent.html\n      html = html.replace(/##campaignId##/g, campaignId)\n    } else {\n      const css = '' +\n        '<style type=\"text/css\">' +\n        'body{margin:0;padding:0;}' +\n        '#contentDiv.wzrk{overflow:hidden;padding:0 0 20px 0;text-align:center;' + pointerCss + '}' +\n        '#contentDiv.wzrk td{padding:15px 10px;}' +\n        '.wzrkPPtitle{font-weight: bold;font-size: 24px;font-family:arial;word-break: break-word;padding-top:20px;}' +\n        '.wzrkPPdscr{font-size: 14px;font-family:arial;line-height:16px;word-break: break-word;display:inline-block;padding:20px 20px 0 20px;line-height:20px;}' +\n        '.PL15{padding-left:15px;}' +\n        '.wzrkPPwarp{margin:20px 20px 0 5px;padding:0px;border-radius: ' + borderRadius + 'px;box-shadow: 1px 1px 5px #888888;}' +\n        'a.wzrkClose{cursor:pointer;position: absolute;top: 11px;right: 11px;z-index: 2147483647;font-size:19px;font-family:arial;font-weight:bold;text-decoration: none;width: 25px;/*height: 25px;*/text-align: center; -webkit-appearance: none; line-height: 25px;' +\n        'background: #353535;border: #fff 2px solid;border-radius: 100%;box-shadow: #777 2px 2px 2px;color:#fff;}' +\n        'a:hover.wzrkClose{background-color:#d1914a !important;color:#fff !important; -webkit-appearance: none;}' +\n        '#contentDiv .button{padding-top:20px;}' +\n        '#contentDiv .button a{font-size: 14px;font-weight:bold;font-family:arial;text-align:center;display:inline-block;text-decoration:none;padding:0 30px;height:40px;line-height:40px;background:#ea693b;color:#fff;border-radius:4px;-webkit-border-radius:4px;-moz-border-radius:4px;}' +\n        '</style>'\n\n      let bgColor, textColor, btnBg, btColor\n      if (targetingMsgJson.display.theme === 'dark') {\n        bgColor = '#2d2d2e'\n        textColor = '#eaeaea'\n        btnBg = '#353535'\n        btColor = '#ffffff'\n      } else {\n        bgColor = '#ffffff'\n        textColor = '#000000'\n        btnBg = '#a5a6a6'\n        btColor = '#ffffff'\n      }\n      const titleText = targetingMsgJson.msgContent.title\n      const descriptionText = targetingMsgJson.msgContent.description\n      let ctaText = ''\n      if (targetingMsgJson.msgContent.ctaText != null && targetingMsgJson.msgContent.ctaText !== '') {\n        ctaText = \"<div class='button'><a href='#'>\" + targetingMsgJson.msgContent.ctaText + '</a></div>'\n      }\n\n      let imageTd = ''\n      if (targetingMsgJson.msgContent.imageUrl != null && targetingMsgJson.msgContent.imageUrl !== '') {\n        imageTd = \"<div style='padding-top:20px;'><img src='\" + targetingMsgJson.msgContent.imageUrl + \"' width='500' alt=\" + titleText + ' /></div>'\n      }\n      const onClickStr = 'parent.$WZRK_WR.closeIframe(' + campaignId + \",'intentPreview');\"\n      const title = \"<div class='wzrkPPwarp' style='color:\" + textColor + ';background-color:' + bgColor + \";'>\" +\n        \"<a href='javascript:void(0);' onclick=\" + onClickStr + \" class='wzrkClose' style='background-color:\" + btnBg + ';color:' + btColor + \"'>&times;</a>\" +\n        \"<div id='contentDiv' class='wzrk'>\" +\n        \"<div class='wzrkPPtitle' style='color:\" + textColor + \"'>\" + titleText + '</div>'\n      const body = \"<div class='wzrkPPdscr' style='color:\" + textColor + \"'>\" + descriptionText + '</div>' + imageTd + ctaText +\n        '</div></div>'\n      html = css + title + body\n    }\n    iframe.setAttribute('style', 'z-index: 2147483647; display:block; height: 100% !important; width: 100% !important;min-height:80px !important;border:0px !important; border-color:none !important;')\n    msgDiv.appendChild(iframe)\n    const ifrm = (iframe.contentWindow) ? iframe.contentWindow : (iframe.contentDocument.document) ? iframe.contentDocument.document : iframe.contentDocument\n    const doc = ifrm.document\n\n    doc.open()\n    doc.write(html)\n    doc.close()\n\n    const contentDiv = document.getElementById('wiz-iframe-intent').contentDocument.getElementById('contentDiv')\n    setupClickUrl(onClick, targetingMsgJson, contentDiv, 'intentPreview', legacy)\n  }\n\n  if (!document.body) {\n    if (_wizCounter < 6) {\n      _wizCounter++\n      setTimeout(_tr, 1000, msg, {\n        device: _device,\n        session: _session,\n        request: _request,\n        logger: _logger\n      })\n    }\n    return\n  }\n  if (msg.inapp_notifs != null) {\n    for (let index = 0; index < msg.inapp_notifs.length; index++) {\n      const targetNotif = msg.inapp_notifs[index]\n      if (targetNotif.display.wtarget_type == null || targetNotif.display.wtarget_type === 0) {\n        showFooterNotification(targetNotif)\n      } else if (targetNotif.display.wtarget_type === 1) { // if display['wtarget_type']==1 then exit intent\n        exitintentObj = targetNotif\n        window.document.body.onmouseleave = showExitIntent\n      }\n    }\n  }\n\n  const mergeEventMap = (newEvtMap) => {\n    if ($ct.globalEventsMap == null) {\n      $ct.globalEventsMap = StorageManager.readFromLSorCookie(EV_COOKIE)\n      if ($ct.globalEventsMap == null) {\n        $ct.globalEventsMap = newEvtMap\n        return\n      }\n    }\n    for (const key in newEvtMap) {\n      if (newEvtMap.hasOwnProperty(key)) {\n        const oldEvtObj = $ct.globalEventsMap[key]\n        const newEvtObj = newEvtMap[key]\n        if ($ct.globalEventsMap[key] != null) {\n          if (newEvtObj[0] != null && newEvtObj[0] > oldEvtObj[0]) {\n            $ct.globalEventsMap[key] = newEvtObj\n          }\n        } else {\n          $ct.globalEventsMap[key] = newEvtObj\n        }\n      }\n    }\n  }\n\n  if (StorageManager._isLocalStorageSupported()) {\n    try {\n      if (msg.evpr != null) {\n        const eventsMap = msg.evpr.events\n        const profileMap = msg.evpr.profile\n        const syncExpiry = msg.evpr.expires_in\n        const now = getNow()\n        StorageManager.setMetaProp('lsTime', now)\n        StorageManager.setMetaProp('exTs', syncExpiry)\n        mergeEventMap(eventsMap)\n        StorageManager.saveToLSorCookie(EV_COOKIE, $ct.globalEventsMap)\n        if ($ct.globalProfileMap == null) {\n          addToLocalProfileMap(profileMap, true)\n        } else {\n          addToLocalProfileMap(profileMap, false)\n        }\n      }\n      if (msg.arp != null) {\n        arp(msg.arp)\n      }\n      if (msg.inapp_stale != null) {\n        const campObj = getCampaignObject()\n        const globalObj = campObj.global\n        if (globalObj != null) {\n          for (const idx in msg.inapp_stale) {\n            if (msg.inapp_stale.hasOwnProperty(idx)) {\n              delete globalObj[msg.inapp_stale[idx]]\n            }\n          }\n        }\n        saveCampaignObject(campObj)\n      }\n    } catch (e) {\n      _logger.error('Unable to persist evrp/arp: ' + e)\n    }\n  }\n}\n\nexport default _tr\n","import {\n  StorageManager\n} from '../util/storage'\nexport default class User {\n  #isPersonalisationActive\n\n  constructor ({\n    isPersonalisationActive\n  }) {\n    this.#isPersonalisationActive = isPersonalisationActive\n  }\n\n  getTotalVisits () {\n    if (!this.#isPersonalisationActive()) {\n      return\n    }\n    let visitCount = StorageManager.getMetaProp('sc')\n    if (visitCount == null) {\n      visitCount = 1\n    }\n    return visitCount\n  }\n\n  getLastVisit () {\n    if (!this.#isPersonalisationActive()) {\n      return\n    }\n    const prevSession = StorageManager.getMetaProp('ps')\n    if (prevSession != null) {\n      return new Date(prevSession * 1000)\n    }\n  }\n}\n","import {\n  CLEVERTAP_ERROR_PREFIX\n} from '../util/messages'\n\nexport const logLevels = {\n  DISABLE: 0,\n  ERROR: 1,\n  INFO: 2,\n  DEBUG: 3\n}\n\nexport class Logger {\n  #logLevel\n  wzrkError = {}\n  constructor (logLevel) {\n    this.#logLevel = logLevel == null ? logLevel : logLevels.INFO\n    this.wzrkError = {}\n  }\n\n  get logLevel () {\n    return this.#logLevel\n  }\n\n  set logLevel (logLevel) {\n    this.#logLevel = logLevel\n  }\n\n  error (message) {\n    if (this.#logLevel >= logLevels.ERROR) {\n      this.#log('error', message)\n    }\n  }\n\n  info (message) {\n    if (this.#logLevel >= logLevels.INFO) {\n      this.#log('log', message)\n    }\n  }\n\n  debug (message) {\n    if (this.#logLevel >= logLevels.DEBUG || this.#isLegacyDebug) {\n      this.#log('debug', message)\n    }\n  }\n\n  reportError (code, description) {\n    this.wzrkError.c = code\n    this.wzrkError.d = description\n    this.error(`${CLEVERTAP_ERROR_PREFIX} ${code}: ${description}`)\n  }\n\n  #log (level, message) {\n    if (window.console) {\n      try {\n        const ts = new Date().getTime()\n        console[level](`CleverTap [${ts}]: ${message}`)\n      } catch (e) {}\n    }\n  }\n\n  get #isLegacyDebug () {\n    return (typeof sessionStorage !== 'undefined' && sessionStorage.WZRK_D === '')\n  }\n}\n\nexport default {\n  Logger,\n  logLevels\n}\n","import { singleQuoteRegex, SCOOKIE_EXP_TIME_IN_SECS } from '../util/constants'\nimport { isObject } from '../util/datatypes'\nimport { getNow } from '../util/datetime'\nimport { StorageManager } from '../util/storage'\nimport { getHostName } from '../util/url'\n\nexport default class SessionManager {\n  #logger\n  #sessionId\n  #isPersonalisationActive\n  cookieName // SCOOKIE_NAME\n  scookieObj\n\n  constructor ({\n    logger,\n    isPersonalisationActive\n  }) {\n    this.sessionId = StorageManager.getMetaProp('cs')\n    this.#logger = logger\n    this.#isPersonalisationActive = isPersonalisationActive\n  }\n\n  get sessionId () {\n    return this.#sessionId\n  }\n\n  set sessionId (sessionId) {\n    this.#sessionId = sessionId\n  }\n\n  getSessionCookieObject () {\n    let scookieStr = StorageManager.readCookie(this.cookieName)\n    let obj = {}\n\n    if (scookieStr != null) {\n      // converting back single quotes to double for JSON parsing - http://www.iandevlin.com/blog/2012/04/html5/cookies-json-localstorage-and-opera\n      scookieStr = scookieStr.replace(singleQuoteRegex, '\"')\n\n      obj = JSON.parse(scookieStr)\n      if (!isObject(obj)) {\n        obj = {}\n      } else {\n        if (typeof obj.t !== 'undefined') { // check time elapsed since last request\n          const lastTime = obj.t\n          const now = getNow()\n          if ((now - lastTime) > (SCOOKIE_EXP_TIME_IN_SECS + 60)) {\n            // adding 60 seconds to compensate for in-journey requests\n            // ideally the cookie should've died after SCOOKIE_EXP_TIME_IN_SECS but it's still around as we can read\n            // hence we shouldn't use it.\n            obj = {}\n          }\n        }\n      }\n    }\n    this.scookieObj = obj\n    return obj\n  }\n\n  setSessionCookieObject (obj) {\n    const objStr = JSON.stringify(obj)\n    StorageManager.createBroadCookie(this.cookieName, objStr, SCOOKIE_EXP_TIME_IN_SECS, getHostName())\n  }\n\n  manageSession (session) {\n    // first time. check if current session id in localstorage is same\n    // if not same then prev = current and current = this new session\n    if (typeof this.sessionId === 'undefined' || this.sessionId !== session) {\n      const currentSessionInLS = StorageManager.getMetaProp('cs')\n      // if sessionId in meta is undefined - set current to both\n      if (typeof currentSessionInLS === 'undefined') {\n        StorageManager.setMetaProp('ps', session)\n        StorageManager.setMetaProp('cs', session)\n        StorageManager.setMetaProp('sc', 1)\n      } else if (currentSessionInLS !== session) {\n        // not same as session in local storage. new session\n        StorageManager.setMetaProp('ps', currentSessionInLS)\n        StorageManager.setMetaProp('cs', session)\n        let sessionCount = StorageManager.getMetaProp('sc')\n        if (typeof sessionCount === 'undefined') {\n          sessionCount = 0\n        }\n        StorageManager.setMetaProp('sc', sessionCount + 1)\n      }\n      this.sessionId = session\n    }\n  }\n\n  getTimeElapsed () {\n    if (!this.#isPersonalisationActive()) {\n      return\n    }\n    if (this.scookieObj != null) { // TODO: check logic?\n      this.scookieObj = this.getSessionCookieObject()\n    }\n    const sessionStart = this.scookieObj.s\n    if (sessionStart != null) {\n      const ts = getNow()\n      return Math.floor(ts - sessionStart)\n    }\n  }\n\n  getPageCount () {\n    if (!this.#isPersonalisationActive()) {\n      return\n    }\n\n    if (this.scookieObj != null) { // TODO: check logic\n      this.scookieObj = this.getSessionCookieObject()\n    }\n    return this.scookieObj.p\n  }\n}\n","import { CAMP_COOKIE_NAME, CLEAR, EVT_PUSH, EV_COOKIE, FIRE_PUSH_UNREGISTERED, LCOOKIE_NAME, PUSH_SUBSCRIPTION_DATA, WEBPUSH_LS_KEY } from '../util/constants'\nimport { isObjectEmpty, isValueValid, removeUnsupportedChars } from '../util/datatypes'\nimport { getNow } from '../util/datetime'\nimport { compressData } from '../util/encoder'\nimport RequestDispatcher from '../util/requestDispatcher'\nimport { StorageManager, $ct } from '../util/storage'\nimport { addToURL } from '../util/url'\nimport { getCampaignObjForLc } from '../util/clevertap'\n\nlet seqNo = 0\nlet requestTime = 0\n\nexport default class RequestManager {\n  #logger\n  #account\n  #device\n  #session\n  #isPersonalisationActive\n  #clearCookie = false\n  processingBackup = false\n\n  constructor ({ logger, account, device, session, isPersonalisationActive }) {\n    this.#logger = logger\n    this.#account = account\n    this.#device = device\n    this.#session = session\n    this.#isPersonalisationActive = isPersonalisationActive\n\n    RequestDispatcher.logger = logger\n    RequestDispatcher.device = device\n  }\n\n  processBackupEvents () {\n    const backupMap = StorageManager.readFromLSorCookie(LCOOKIE_NAME)\n    if (typeof backupMap === 'undefined' || backupMap === null) {\n      return\n    }\n    this.processingBackup = true\n    for (const idx in backupMap) {\n      if (backupMap.hasOwnProperty(idx)) {\n        const backupEvent = backupMap[idx]\n        if (typeof backupEvent.fired === 'undefined') {\n          this.#logger.debug('Processing backup event : ' + backupEvent.q)\n          if (typeof backupEvent.q !== 'undefined') {\n            RequestDispatcher.fireRequest(backupEvent.q)\n          }\n          backupEvent.fired = true\n        }\n      }\n    }\n\n    StorageManager.saveToLSorCookie(LCOOKIE_NAME, backupMap)\n    this.processingBackup = false\n  }\n\n  addSystemDataToObject (dataObject, ignoreTrim) {\n    // ignore trim for chrome notifications; undefined everywhere else\n    if (typeof ignoreTrim === 'undefined') {\n      dataObject = removeUnsupportedChars(dataObject, this.#logger)\n    }\n\n    if (!isObjectEmpty(this.#logger.wzrkError)) {\n      dataObject.wzrk_error = this.#logger.wzrkError\n      this.#logger.wzrkError = {}\n    }\n\n    dataObject.id = this.#account.id\n\n    if (isValueValid(this.#device.gcookie)) {\n      dataObject.g = this.#device.gcookie\n    }\n\n    const obj = this.#session.getSessionCookieObject()\n    dataObject.s = obj.s // session cookie\n    dataObject.pg = (typeof obj.p === 'undefined') ? 1 : obj.p // Page count\n\n    return dataObject\n  }\n\n  addFlags (data) {\n    // check if cookie should be cleared.\n    this.#clearCookie = StorageManager.getAndClearMetaProp(CLEAR)\n    if (this.#clearCookie !== undefined && this.#clearCookie) {\n      data.rc = true\n      this.#logger.debug('reset cookie sent in request and cleared from meta for future requests.')\n    }\n    if (this.#isPersonalisationActive()) {\n      const lastSyncTime = StorageManager.getMetaProp('lsTime')\n      const expirySeconds = StorageManager.getMetaProp('exTs')\n\n      // dsync not found in local storage - get data from server\n      if (typeof lastSyncTime === 'undefined' || typeof expirySeconds === 'undefined') {\n        data.dsync = true\n        return\n      }\n      const now = getNow()\n      // last sync time has expired - get fresh data from server\n      if (lastSyncTime + expirySeconds < now) {\n        data.dsync = true\n      }\n    }\n  }\n\n  saveAndFireRequest (url, override, sendOULFlag) {\n    const now = getNow()\n    url = addToURL(url, 'rn', ++$ct.globalCache.REQ_N)\n    const data = url + '&i=' + now + '&sn=' + seqNo\n    StorageManager.backupEvent(data, $ct.globalCache.REQ_N, this.#logger)\n\n    if (!$ct.blockRequest || override || (this.#clearCookie !== undefined && this.#clearCookie)) {\n      if (now === requestTime) {\n        seqNo++\n      } else {\n        requestTime = now\n        seqNo = 0\n      }\n\n      RequestDispatcher.fireRequest(data, false, sendOULFlag)\n    } else {\n      this.#logger.debug(`Not fired due to block request - ${$ct.blockRequest} or clearCookie - ${this.#clearCookie}`)\n    }\n  }\n\n  unregisterTokenForGuid (givenGUID) {\n    const data = {}\n    data.type = 'data'\n    if (isValueValid(givenGUID)) {\n      data.g = givenGUID\n    }\n    data.action = 'unregister'\n    data.id = this.#account.id\n\n    const obj = this.#session.getSessionCookieObject()\n\n    data.s = obj.s // session cookie\n    const compressedData = compressData(JSON.stringify(data), this.#logger)\n\n    let pageLoadUrl = this.#account.dataPostURL\n    pageLoadUrl = addToURL(pageLoadUrl, 'type', 'data')\n    pageLoadUrl = addToURL(pageLoadUrl, 'd', compressedData)\n\n    StorageManager.saveToLSorCookie(FIRE_PUSH_UNREGISTERED, false)\n    RequestDispatcher.fireRequest(pageLoadUrl, true)\n\n    // REGISTER TOKEN\n    const payload = StorageManager.readFromLSorCookie(PUSH_SUBSCRIPTION_DATA)\n    this.registerToken(payload)\n  }\n\n  registerToken (payload) {\n    if (!payload) return\n\n    payload = this.addSystemDataToObject(payload, true)\n    payload = JSON.stringify(payload)\n    let pageLoadUrl = this.#account.dataPostURL\n    pageLoadUrl = addToURL(pageLoadUrl, 'type', 'data')\n    pageLoadUrl = addToURL(pageLoadUrl, 'd', compressData(payload, this.#logger))\n    RequestDispatcher.fireRequest(pageLoadUrl)\n    // set in localstorage\n    StorageManager.save(WEBPUSH_LS_KEY, 'ok')\n  }\n\n  processEvent (data) {\n    this.#addToLocalEventMap(data.evtName)\n    data = this.addSystemDataToObject(data, undefined)\n    this.addFlags(data)\n    data[CAMP_COOKIE_NAME] = getCampaignObjForLc()\n    const compressedData = compressData(JSON.stringify(data), this.#logger)\n    let pageLoadUrl = this.#account.dataPostURL\n    pageLoadUrl = addToURL(pageLoadUrl, 'type', EVT_PUSH)\n    pageLoadUrl = addToURL(pageLoadUrl, 'd', compressedData)\n\n    this.saveAndFireRequest(pageLoadUrl, false)\n  }\n\n  #addToLocalEventMap (evtName) {\n    if (StorageManager._isLocalStorageSupported()) {\n      if (typeof $ct.globalEventsMap === 'undefined') {\n        $ct.globalEventsMap = StorageManager.readFromLSorCookie(EV_COOKIE)\n        if (typeof $ct.globalEventsMap === 'undefined') {\n          $ct.globalEventsMap = {}\n        }\n      }\n\n      const nowTs = getNow()\n      let evtDetail = $ct.globalEventsMap[evtName]\n      if (typeof evtDetail !== 'undefined') {\n        evtDetail[2] = nowTs\n        evtDetail[0]++\n      } else {\n        evtDetail = []\n        evtDetail.push(1)\n        evtDetail.push(nowTs)\n        evtDetail.push(nowTs)\n      }\n      $ct.globalEventsMap[evtName] = evtDetail\n      StorageManager.saveToLSorCookie(EV_COOKIE, $ct.globalEventsMap)\n    }\n  }\n}\n","import {\n  isObjectEmpty\n} from '../util/datatypes'\nimport {\n  EVT_PUSH,\n  USEIP_KEY,\n  OPTOUT_KEY,\n  CT_OPTOUT_KEY\n} from '../util/constants'\nimport {\n  StorageManager,\n  $ct\n} from '../util/storage'\nimport {\n  compressData\n} from '../util/encoder'\nimport {\n  addToURL\n} from '../util/url'\n\nexport default class Privacy extends Array {\n  #request\n  #account\n  #oldValues\n  #logger\n\n  constructor ({\n    request,\n    account,\n    logger\n  },\n  values) {\n    super()\n    this.#logger = logger\n    this.#request = request\n    this.#account = account\n    this.#oldValues = values\n  }\n\n  push (...privacyArr) {\n    this.#processPrivacyArray(privacyArr)\n    return 0\n  }\n\n  _processOldValues () {\n    if (this.#oldValues) {\n      this.#processPrivacyArray(this.#oldValues)\n    }\n    this.#oldValues = null\n  }\n\n  #processPrivacyArray (privacyArr) {\n    if (Array.isArray(privacyArr) && privacyArr.length > 0) {\n      const privacyObj = privacyArr[0]\n      let data = {}\n      const profileObj = {}\n      var optOut = false\n\n      if (privacyObj.hasOwnProperty(OPTOUT_KEY)) {\n        optOut = privacyObj[OPTOUT_KEY]\n        if (typeof optOut === 'boolean') {\n          profileObj[CT_OPTOUT_KEY] = optOut\n          // should be true when user wants to opt in\n          $ct.isOptInRequest = !optOut\n        }\n      }\n      if (privacyObj.hasOwnProperty(USEIP_KEY)) {\n        const useIP = privacyObj[USEIP_KEY]\n        const shouldUseIP = (typeof useIP === 'boolean') ? useIP : false\n        StorageManager.setMetaProp(USEIP_KEY, shouldUseIP)\n      }\n      if (!isObjectEmpty(profileObj)) {\n        data.type = 'profile'\n        data.profile = profileObj\n        data = this.#request.addSystemDataToObject(data, undefined)\n        const compressedData = compressData(JSON.stringify(data), this.#logger)\n        let pageLoadUrl = this.#account.dataPostURL\n        pageLoadUrl = addToURL(pageLoadUrl, 'type', EVT_PUSH)\n        pageLoadUrl = addToURL(pageLoadUrl, 'd', compressedData)\n        pageLoadUrl = addToURL(pageLoadUrl, OPTOUT_KEY, optOut ? 'true' : 'false')\n        this.#request.saveAndFireRequest(pageLoadUrl, $ct.blockRequeust)\n      }\n    }\n  }\n}\n","import { StorageManager, $ct } from '../util/storage'\nimport { isObject } from '../util/datatypes'\nimport {\n  PUSH_SUBSCRIPTION_DATA\n} from '../util/constants'\nimport {\n  urlBase64ToUint8Array\n} from '../util/encoder'\n\nexport default class NotificationHandler extends Array {\n  #oldValues\n  #logger\n  #request\n  #account\n  #wizAlertJSPath\n  #fcmPublicKey\n\n  constructor ({\n    logger,\n    session,\n    request,\n    account\n  }, values) {\n    super()\n    this.#wizAlertJSPath = 'https://d2r1yp2w7bby2u.cloudfront.net/js/wzrk_dialog.min.js'\n    this.#fcmPublicKey = null\n    this.#oldValues = values\n    this.#logger = logger\n    this.#request = request\n    this.#account = account\n  }\n\n  push (...displayArgs) {\n    this.#setUpWebPush(displayArgs)\n    return 0\n  }\n\n  _processOldValues () {\n    if (this.#oldValues) {\n      this.#setUpWebPush(this.#oldValues)\n    }\n    this.#oldValues = null\n  }\n\n  #setUpWebPush (displayArgs) {\n    if ($ct.webPushEnabled && displayArgs.length > 0) {\n      this.#handleNotificationRegistration(displayArgs)\n    } else if ($ct.webPushEnabled == null && displayArgs.length > 0) {\n      $ct.notifApi.notifEnabledFromApi = true\n      $ct.notifApi.displayArgs = displayArgs.slice()\n    } else if ($ct.webPushEnabled === false && displayArgs.length > 0) {\n      this.#logger.error('Make sure push notifications are fully enabled and integrated')\n    }\n  }\n\n  #setUpWebPushNotifications (subscriptionCallback, serviceWorkerPath, apnsWebPushId, apnsServiceUrl) {\n    if (navigator.userAgent.indexOf('Chrome') !== -1 || navigator.userAgent.indexOf('Firefox') !== -1) {\n      this.#setUpChromeFirefoxNotifications(subscriptionCallback, serviceWorkerPath)\n    } else if (navigator.userAgent.indexOf('Safari') !== -1) {\n      this.#setUpSafariNotifications(subscriptionCallback, apnsWebPushId, apnsServiceUrl)\n    }\n  }\n\n  #setApplicationServerKey (applicationServerKey) {\n    this.#fcmPublicKey = applicationServerKey\n  }\n\n  #setUpSafariNotifications (subscriptionCallback, apnsWebPushId, apnsServiceUrl) {\n    // ensure that proper arguments are passed\n    if (typeof apnsWebPushId === 'undefined') {\n      this.#logger.error('Ensure that APNS Web Push ID is supplied')\n    }\n    if (typeof apnsServiceUrl === 'undefined') {\n      this.#logger.error('Ensure that APNS Web Push service path is supplied')\n    }\n    if ('safari' in window && 'pushNotification' in window.safari) {\n      window.safari.pushNotification.requestPermission(\n        apnsServiceUrl,\n        apnsWebPushId, {}, (subscription) => {\n          if (subscription.permission === 'granted') {\n            const subscriptionData = JSON.parse(JSON.stringify(subscription))\n            subscriptionData.endpoint = subscription.deviceToken\n            subscriptionData.browser = 'Safari'\n            StorageManager.saveToLSorCookie(PUSH_SUBSCRIPTION_DATA, subscriptionData)\n\n            this.#request.registerToken(subscriptionData)\n            this.#logger.info('Safari Web Push registered. Device Token: ' + subscription.deviceToken)\n          } else if (subscription.permission === 'denied') {\n            this.#logger.info('Error subscribing to Safari web push')\n          }\n        })\n    }\n  }\n\n  /**\n   * Sets up a service worker for WebPush(chrome/Firefox) push notifications and sends the data to LC\n   */\n  #setUpChromeFirefoxNotifications (subscriptionCallback, serviceWorkerPath) {\n    let registrationScope = ''\n\n    if ('serviceWorker' in navigator) {\n      navigator.serviceWorker.register(serviceWorkerPath).then((registration) => {\n        if (typeof __wzrk_account_id !== 'undefined') { // eslint-disable-line\n          // shopify accounts , since the service worker is not at root, serviceWorker.ready is never resolved.\n          // hence add a timeout and hope serviceWroker is ready within that time.\n          return new Promise(resolve => setTimeout(() => resolve(registration), 5000))\n        }\n        registrationScope = registration.scope\n\n        // IF SERVICE WORKER IS AT ROOT, RETURN THE READY PROMISE\n        // ELSE IF CHROME RETURN PROMISE AFTER 5 SECONDS\n        // OR getRegistrations PROMISE IF ITS FIREFOX\n        const rootDirRegex = /^(\\.?)(\\/?)([^/]*).js$/\n        const isServiceWorkerAtRoot = rootDirRegex.test(serviceWorkerPath)\n        if (isServiceWorkerAtRoot) {\n          return navigator.serviceWorker.ready\n        } else {\n          if (navigator.userAgent.indexOf('Chrome') !== -1) {\n            return new Promise(resolve => setTimeout(() => resolve(registration), 5000))\n          } else {\n            return navigator.serviceWorker.getRegistrations()\n          }\n        }\n      }).then((serviceWorkerRegistration) => {\n        // ITS AN ARRAY IN CASE OF FIREFOX, SO USE THE REGISTRATION WITH PROPER SCOPE\n        if (navigator.userAgent.indexOf('Firefox') !== -1 && Array.isArray(serviceWorkerRegistration)) {\n          serviceWorkerRegistration = serviceWorkerRegistration.filter((i) => i.scope === registrationScope)[0]\n        }\n        const subscribeObj = { userVisibleOnly: true }\n\n        if (this.#fcmPublicKey != null) {\n          subscribeObj.applicationServerKey = urlBase64ToUint8Array(this.#fcmPublicKey)\n        }\n\n        serviceWorkerRegistration.pushManager.subscribe(subscribeObj)\n          .then((subscription) => {\n            this.#logger.info('Service Worker registered. Endpoint: ' + subscription.endpoint)\n\n            // convert the subscription keys to strings; this sets it up nicely for pushing to LC\n            const subscriptionData = JSON.parse(JSON.stringify(subscription))\n\n            // remove the common chrome/firefox endpoint at the beginning of the token\n            if (navigator.userAgent.indexOf('Chrome') !== -1) {\n              subscriptionData.endpoint = subscriptionData.endpoint.split('/').pop()\n              subscriptionData.browser = 'Chrome'\n            } else if (navigator.userAgent.indexOf('Firefox') !== -1) {\n              subscriptionData.endpoint = subscriptionData.endpoint.split('/').pop()\n              subscriptionData.browser = 'Firefox'\n            }\n            StorageManager.saveToLSorCookie(PUSH_SUBSCRIPTION_DATA, subscriptionData)\n\n            // var shouldSendToken = typeof sessionObj['p'] === STRING_CONSTANTS.UNDEFINED || sessionObj['p'] === 1\n            //     || sessionObj['p'] === 2 || sessionObj['p'] === 3 || sessionObj['p'] === 4 || sessionObj['p'] === 5;\n            const shouldSendToken = true\n            if (shouldSendToken) {\n              this.#request.registerToken(subscriptionData)\n            }\n\n            if (typeof subscriptionCallback !== 'undefined' && typeof subscriptionCallback === 'function') {\n              subscriptionCallback()\n            }\n          }).catch((error) => {\n            this.#logger.error('Error subscribing: ' + error)\n            // unsubscribe from webpush if error\n            serviceWorkerRegistration.pushManager.getSubscription().then((subscription) => {\n              if (subscription !== null) {\n                subscription.unsubscribe().then((successful) => {\n                  // You've successfully unsubscribed\n                  this.#logger.info('Unsubscription successful')\n                }).catch((e) => {\n                  // Unsubscription failed\n                  this.#logger.error('Error unsubscribing: ' + e)\n                })\n              }\n            })\n          })\n      }).catch((err) => {\n        this.#logger.error('error registering service worker: ' + err)\n      })\n    }\n  }\n\n  #addWizAlertJS () {\n    const scriptTag = document.createElement('script')\n    scriptTag.setAttribute('type', 'text/javascript')\n    scriptTag.setAttribute('id', 'wzrk-alert-js')\n    scriptTag.setAttribute('src', this.#wizAlertJSPath)\n\n    // add the script tag to the end of the body\n    document.getElementsByTagName('body')[0].appendChild(scriptTag)\n\n    return scriptTag\n  }\n\n  #removeWizAlertJS () {\n    const scriptTag = document.getElementById('wzrk-alert-js')\n    scriptTag.parentNode.removeChild(scriptTag)\n  }\n\n  #handleNotificationRegistration (displayArgs) {\n    // make sure everything is specified\n    let titleText\n    let bodyText\n    let okButtonText\n    let rejectButtonText\n    let okButtonColor\n    let skipDialog\n    let askAgainTimeInSeconds\n    let okCallback\n    let rejectCallback\n    let subscriptionCallback\n    let hidePoweredByCT\n    let serviceWorkerPath\n    let httpsPopupPath\n    let httpsIframePath\n    let apnsWebPushId\n    let apnsWebPushServiceUrl\n\n    if (displayArgs.length === 1) {\n      if (isObject(displayArgs[0])) {\n        const notifObj = displayArgs[0]\n        titleText = notifObj.titleText\n        bodyText = notifObj.bodyText\n        okButtonText = notifObj.okButtonText\n        rejectButtonText = notifObj.rejectButtonText\n        okButtonColor = notifObj.okButtonColor\n        skipDialog = notifObj.skipDialog\n        askAgainTimeInSeconds = notifObj.askAgainTimeInSeconds\n        okCallback = notifObj.okCallback\n        rejectCallback = notifObj.rejectCallback\n        subscriptionCallback = notifObj.subscriptionCallback\n        hidePoweredByCT = notifObj.hidePoweredByCT\n        serviceWorkerPath = notifObj.serviceWorkerPath\n        httpsPopupPath = notifObj.httpsPopupPath\n        httpsIframePath = notifObj.httpsIframePath\n        apnsWebPushId = notifObj.apnsWebPushId\n        apnsWebPushServiceUrl = notifObj.apnsWebPushServiceUrl\n      }\n    } else {\n      titleText = displayArgs[0]\n      bodyText = displayArgs[1]\n      okButtonText = displayArgs[2]\n      rejectButtonText = displayArgs[3]\n      okButtonColor = displayArgs[4]\n      skipDialog = displayArgs[5]\n      askAgainTimeInSeconds = displayArgs[6]\n    }\n\n    if (skipDialog == null) {\n      skipDialog = false\n    }\n\n    if (hidePoweredByCT == null) {\n      hidePoweredByCT = false\n    }\n\n    if (serviceWorkerPath == null) {\n      serviceWorkerPath = '/clevertap_sw.js'\n    }\n\n    // ensure that the browser supports notifications\n    if (typeof navigator.serviceWorker === 'undefined') {\n      return\n    }\n\n    const isHTTP = httpsPopupPath != null && httpsIframePath != null\n\n    // make sure the site is on https for chrome notifications\n    if (window.location.protocol !== 'https:' && document.location.hostname !== 'localhost' && !isHTTP) {\n      this.#logger.error('Make sure you are https or localhost to register for notifications')\n      return\n    }\n\n    // right now, we only support Chrome V50 & higher & Firefox\n    if (navigator.userAgent.indexOf('Chrome') !== -1) {\n      const chromeAgent = navigator.userAgent.match(/Chrome\\/(\\d+)/)\n      if (chromeAgent == null || parseInt(chromeAgent[1], 10) < 50) { return }\n    } else if (navigator.userAgent.indexOf('Firefox') !== -1) {\n      const firefoxAgent = navigator.userAgent.match(/Firefox\\/(\\d+)/)\n      if (firefoxAgent == null || parseInt(firefoxAgent[1], 10) < 50) { return }\n    } else if (navigator.userAgent.indexOf('Safari') !== -1) {\n      const safariAgent = navigator.userAgent.match(/Safari\\/(\\d+)/)\n      if (safariAgent == null || parseInt(safariAgent[1], 10) < 50) { return }\n    } else {\n      return\n    }\n\n    // we check for the cookie in setUpChromeNotifications() the tokens may have changed\n\n    if (!isHTTP) {\n      if (Notification == null) {\n        return\n      }\n      // handle migrations from other services -> chrome notifications may have already been asked for before\n      if (Notification.permission === 'granted') {\n        // skip the dialog and register\n        this.#setUpWebPushNotifications(subscriptionCallback, serviceWorkerPath, apnsWebPushId, apnsWebPushServiceUrl)\n        return\n      } else if (Notification.permission === 'denied') {\n        // we've lost this profile :'(\n        return\n      }\n\n      if (skipDialog) {\n        this.#setUpWebPushNotifications(subscriptionCallback, serviceWorkerPath, apnsWebPushId, apnsWebPushServiceUrl)\n        return\n      }\n    }\n\n    // make sure the right parameters are passed\n    if (!titleText || !bodyText || !okButtonText || !rejectButtonText) {\n      this.#logger.error('Missing input parameters; please specify title, body, ok button and cancel button text')\n      return\n    }\n\n    // make sure okButtonColor is formatted properly\n    if (okButtonColor == null || !okButtonColor.match(/^#[a-f\\d]{6}$/i)) {\n      okButtonColor = '#f28046' // default color for positive button\n    }\n\n    // make sure the user isn't asked for notifications more than askAgainTimeInSeconds\n    const now = new Date().getTime() / 1000\n    if ((StorageManager.getMetaProp('notif_last_time')) == null) {\n      StorageManager.setMetaProp('notif_last_time', now)\n    } else {\n      if (askAgainTimeInSeconds == null) {\n        // 7 days by default\n        askAgainTimeInSeconds = 7 * 24 * 60 * 60\n      }\n\n      if (now - StorageManager.getMetaProp('notif_last_time') < askAgainTimeInSeconds) {\n        return\n      } else {\n        // continue asking\n        StorageManager.setMetaProp('notif_last_time', now)\n      }\n    }\n\n    if (isHTTP) {\n      // add the https iframe\n      const httpsIframe = document.createElement('iframe')\n      httpsIframe.setAttribute('style', 'display:none;')\n      httpsIframe.setAttribute('src', httpsIframePath)\n      document.body.appendChild(httpsIframe)\n      window.addEventListener('message', (event) => {\n        if (event.data != null) {\n          let obj = {}\n          try {\n            obj = JSON.parse(event.data)\n          } catch (e) {\n            // not a call from our iframe\n            return\n          }\n          if (obj.state != null) {\n            if (obj.from === 'ct' && obj.state === 'not') {\n              this.#addWizAlertJS().onload = () => {\n                // create our wizrocket popup\n                window.wzrkPermissionPopup.wizAlert({\n                  title: titleText,\n                  body: bodyText,\n                  confirmButtonText: okButtonText,\n                  confirmButtonColor: okButtonColor,\n                  rejectButtonText: rejectButtonText,\n                  hidePoweredByCT: hidePoweredByCT\n                }, (enabled) => { // callback function\n                  if (enabled) {\n                    // the user accepted on the dialog box\n                    if (typeof okCallback === 'function') {\n                      okCallback()\n                    }\n                    // redirect to popup.html\n                    window.open(httpsPopupPath)\n                  } else {\n                    if (typeof rejectCallback === 'function') {\n                      rejectCallback()\n                    }\n                  }\n                  this.#removeWizAlertJS()\n                })\n              }\n            }\n          }\n        }\n      }, false)\n    } else {\n      this.#addWizAlertJS().onload = () => {\n        // create our wizrocket popup\n        window.wzrkPermissionPopup.wizAlert({\n          title: titleText,\n          body: bodyText,\n          confirmButtonText: okButtonText,\n          confirmButtonColor: okButtonColor,\n          rejectButtonText: rejectButtonText,\n          hidePoweredByCT: hidePoweredByCT\n        }, (enabled) => { // callback function\n          if (enabled) {\n            // the user accepted on the dialog box\n            if (typeof okCallback === 'function') {\n              okCallback()\n            }\n            this.#setUpWebPushNotifications(subscriptionCallback, serviceWorkerPath, apnsWebPushId, apnsWebPushServiceUrl)\n          } else {\n            if (typeof rejectCallback === 'function') {\n              rejectCallback()\n            }\n          }\n          this.#removeWizAlertJS()\n        })\n      }\n    }\n  }\n\n  _enableWebPush (enabled, applicationServerKey) {\n    $ct.webPushEnabled = enabled\n    if (applicationServerKey != null) {\n      this.#setApplicationServerKey(applicationServerKey)\n    }\n    if ($ct.webPushEnabled && $ct.notifApi.notifEnabledFromApi) {\n      this.#handleNotificationRegistration($ct.notifApi.displayArgs)\n    } else if (!$ct.webPushEnabled && $ct.notifApi.notifEnabledFromApi) {\n      this.#logger.error('Ensure that web push notifications are fully enabled and integrated before requesting them')\n    }\n  }\n}\n","import Account from './modules/account'\nimport CleverTapAPI from './modules/api'\nimport DeviceManager from './modules/device'\nimport EventHandler from './modules/event'\nimport ProfileHandler from './modules/profile'\nimport UserLoginHandler from './modules/userLogin'\nimport _tr from './util/tr'\nimport User from './modules/user'\nimport { Logger, logLevels } from './modules/logger'\nimport SessionManager from './modules/session'\nimport ReqestManager from './modules/request'\nimport {\n  CAMP_COOKIE_NAME,\n  SCOOKIE_PREFIX,\n  EVT_PING,\n  FIRST_PING_FREQ_IN_MILLIS,\n  CONTINUOUS_PING_FREQ_IN_MILLIS,\n  GROUP_SUBSCRIPTION_REQUEST_ID,\n  categoryLongKey\n} from './util/constants'\nimport { EMBED_ERROR } from './util/messages'\nimport { StorageManager, $ct } from './util/storage'\nimport { addToURL, getDomain, getURLParams } from './util/url'\nimport { getCampaignObjForLc, setEnum, handleEmailSubscription, closeIframe } from './util/clevertap'\nimport { compressData } from './util/encoder'\nimport Privacy from './modules/privacy'\nimport NotificationHandler from './modules/notification'\n\nexport default class CleverTap {\n  #logger\n  #api\n  #onloadcalled\n  #device\n  #session\n  #account\n  #request\n  #isSpa\n  #previousUrl\n  #boundCheckPageChanged = this.#checkPageChanged.bind(this)\n  enablePersonalization\n\n  get spa () {\n    return this.#isSpa\n  }\n\n  set spa (value) {\n    const isSpa = value === true\n    if (this.#isSpa !== isSpa && this.#onloadcalled === 1) {\n      // if clevertap.spa is changed after init has been called then update the click listeners\n      if (isSpa) {\n        document.addEventListener('click', this.#boundCheckPageChanged)\n      } else {\n        document.removeEventListener('click', this.#boundCheckPageChanged)\n      }\n    }\n    this.#isSpa = isSpa\n  }\n\n  constructor (clevertap = {}) {\n    this.#onloadcalled = 0\n    this._isPersonalisationActive = this._isPersonalisationActive.bind(this)\n    this.raiseNotificationClicked = () => {}\n    this.#logger = new Logger(logLevels.INFO)\n    this.#account = new Account(clevertap.account?.[0], clevertap.region, clevertap.targetDomain)\n    this.#device = new DeviceManager({ logger: this.#logger })\n    this.#session = new SessionManager({\n      logger: this.#logger,\n      isPersonalisationActive: this._isPersonalisationActive\n    })\n    this.#request = new ReqestManager({\n      logger: this.#logger,\n      account: this.#account,\n      device: this.#device,\n      session: this.#session,\n      isPersonalisationActive: this._isPersonalisationActive\n    })\n    this.enablePersonalization = clevertap.enablePersonalization || false\n    this.event = new EventHandler({\n      logger: this.#logger,\n      request: this.#request,\n      isPersonalisationActive: this._isPersonalisationActive\n    }, clevertap.event)\n\n    this.profile = new ProfileHandler({\n      logger: this.#logger,\n      request: this.#request,\n      account: this.#account,\n      isPersonalisationActive: this._isPersonalisationActive\n    }, clevertap.profile)\n\n    this.onUserLogin = new UserLoginHandler({\n      request: this.#request,\n      account: this.#account,\n      session: this.#session,\n      logger: this.#logger,\n      device: this.#device\n    }, clevertap.onUserLogin)\n\n    this.privacy = new Privacy({\n      request: this.#request,\n      account: this.#account,\n      logger: this.#logger\n    }, clevertap.privacy)\n\n    this.notifications = new NotificationHandler({\n      logger: this.#logger,\n      request: this.#request,\n      account: this.#account\n    }, clevertap.notifications)\n\n    this.#api = new CleverTapAPI({\n      logger: this.#logger,\n      request: this.#request,\n      device: this.#device,\n      session: this.#session\n    })\n\n    this.spa = clevertap.spa\n\n    this.user = new User({\n      isPersonalisationActive: this._isPersonalisationActive\n    })\n\n    this.session = {\n      getTimeElapsed: () => {\n        return this.#session.getTimeElapsed()\n      },\n      getPageCount: () => {\n        return this.#session.getPageCount()\n      }\n    }\n\n    this.logout = () => {\n      this.#logger.debug('logout called')\n      StorageManager.setInstantDeleteFlagInK()\n    }\n\n    this.clear = () => {\n      this.onUserLogin.clear()\n    }\n\n    this.getCleverTapID = () => {\n      return this.#device.getGuid()\n    }\n\n    this.setLogLevel = (l) => {\n      this.#logger.logLevel = Number(l)\n    }\n\n    const _handleEmailSubscription = (subscription, reEncoded, fetchGroups) => {\n      handleEmailSubscription(subscription, reEncoded, fetchGroups, this.#account, this.#logger)\n    }\n\n    const api = this.#api\n    api.logout = this.logout\n    api.clear = this.clear\n    api.closeIframe = (campaignId, divIdIgnored) => {\n      closeIframe(campaignId, divIdIgnored, this.#session.sessionId)\n    }\n    api.enableWebPush = (enabled, applicationServerKey) => {\n      this.notifications._enableWebPush(enabled, applicationServerKey)\n    }\n    api.tr = (msg) => {\n      _tr(msg, {\n        device: this.#device,\n        session: this.#session,\n        request: this.#request,\n        logger: this.#logger\n      })\n    }\n    api.setEnum = (enumVal) => {\n      setEnum(enumVal, this.#logger)\n    }\n    api.is_onloadcalled = () => {\n      return (this.#onloadcalled === 1)\n    }\n    api.subEmail = (reEncoded) => {\n      _handleEmailSubscription('1', reEncoded)\n    }\n    api.getEmail = (reEncoded, withGroups) => {\n      _handleEmailSubscription('-1', reEncoded, withGroups)\n    }\n    api.unSubEmail = (reEncoded) => {\n      _handleEmailSubscription('0', reEncoded)\n    }\n    api.unsubEmailGroups = (reEncoded) => {\n      $ct.unsubGroups = []\n      const elements = document.getElementsByClassName('ct-unsub-group-input-item')\n\n      for (let i = 0; i < elements.length; i++) {\n        const element = elements[i]\n        if (element.name) {\n          const data = { name: element.name, isUnsubscribed: element.checked }\n          $ct.unsubGroups.push(data)\n        }\n      }\n\n      _handleEmailSubscription(GROUP_SUBSCRIPTION_REQUEST_ID, reEncoded)\n    }\n    api.setSubscriptionGroups = (value) => {\n      $ct.unsubGroups = value\n    }\n    api.getSubscriptionGroups = () => {\n      return $ct.unsubGroups\n    }\n    api.changeSubscriptionGroups = (reEncoded, updatedGroups) => {\n      api.setSubscriptionGroups(updatedGroups)\n      _handleEmailSubscription(GROUP_SUBSCRIPTION_REQUEST_ID, reEncoded)\n    }\n    api.setUpdatedCategoryLong = (profile) => {\n      if (profile[categoryLongKey]) {\n        $ct.updatedCategoryLong = profile[categoryLongKey]\n      }\n    }\n    window.$CLTP_WR = window.$WZRK_WR = api\n\n    if (clevertap.account?.[0].id) {\n      // The accountId is present so can init with empty values.\n      // Needed to maintain backward compatability with legacy implementations.\n      // Npm imports/require will need to call init explictly with accountId\n      this.init()\n    }\n  }\n\n  raiseNotificationClicked () {\n\n  }\n\n  init (accountId, region, targetDomain) {\n    if (this.#onloadcalled === 1) {\n      // already initailsed\n      return\n    }\n    StorageManager.removeCookie('WZRK_P', window.location.hostname)\n    if (!this.#account.id) {\n      if (!accountId) {\n        this.#logger.error(EMBED_ERROR)\n        return\n      }\n      this.#account.id = accountId\n    }\n    this.#session.cookieName = SCOOKIE_PREFIX + '_' + this.#account.id\n\n    if (region) {\n      this.#account.region = region\n    }\n    if (targetDomain) {\n      this.#account.targetDomain = targetDomain\n    }\n\n    const currLocation = location.href\n    const urlParams = getURLParams(currLocation.toLowerCase())\n\n    // eslint-disable-next-line eqeqeq\n    if (typeof urlParams.e !== 'undefined' && urlParams.wzrk_ex == '0') {\n      return\n    }\n\n    this.#request.processBackupEvents()\n    this.#processOldValues()\n\n    this.pageChanged()\n\n    if (this.#isSpa) {\n      // listen to click on the document and check if URL has changed.\n      document.addEventListener('click', this.#boundCheckPageChanged)\n    } else {\n      // remove existing click listeners if any\n      document.removeEventListener('click', this.#boundCheckPageChanged)\n    }\n    this.#onloadcalled = 1\n  }\n\n  #processOldValues () {\n    this.onUserLogin._processOldValues()\n    this.privacy._processOldValues()\n    this.event._processOldValues()\n    this.profile._processOldValues()\n    this.notifications._processOldValues()\n  }\n\n  #checkPageChanged () {\n    if (this.#previousUrl !== location.href) {\n      this.pageChanged()\n    }\n  }\n\n  pageChanged () {\n    const currLocation = window.location.href\n    const urlParams = getURLParams(currLocation.toLowerCase())\n    // -- update page count\n    const obj = this.#session.getSessionCookieObject()\n    let pgCount = (typeof obj.p === 'undefined') ? 0 : obj.p\n    obj.p = ++pgCount\n    this.#session.setSessionCookieObject(obj)\n    // -- update page count\n\n    let data = {}\n    let referrerDomain = getDomain(document.referrer)\n\n    if (window.location.hostname !== referrerDomain) {\n      const maxLen = 120\n      if (referrerDomain !== '') {\n        referrerDomain = referrerDomain.length > maxLen ? referrerDomain.substring(0, maxLen) : referrerDomain\n        data.referrer = referrerDomain\n      }\n\n      let utmSource = urlParams.utm_source || urlParams.wzrk_source\n      if (typeof utmSource !== 'undefined') {\n        utmSource = utmSource.length > maxLen ? utmSource.substring(0, maxLen) : utmSource\n        data.us = utmSource // utm_source\n      }\n\n      let utmMedium = urlParams.utm_medium || urlParams.wzrk_medium\n      if (typeof utmMedium !== 'undefined') {\n        utmMedium = utmMedium.length > maxLen ? utmMedium.substring(0, maxLen) : utmMedium\n        data.um = utmMedium // utm_medium\n      }\n\n      let utmCampaign = urlParams.utm_campaign || urlParams.wzrk_campaign\n      if (typeof utmCampaign !== 'undefined') {\n        utmCampaign = utmCampaign.length > maxLen ? utmCampaign.substring(0, maxLen) : utmCampaign\n        data.uc = utmCampaign // utm_campaign\n      }\n\n      // also independently send wzrk_medium to the backend\n      if (typeof urlParams.wzrk_medium !== 'undefined') {\n        const wm = urlParams.wzrk_medium\n        if (wm.match(/^email$|^social$|^search$/)) {\n          data.wm = wm // wzrk_medium\n        }\n      }\n    }\n\n    data = this.#request.addSystemDataToObject(data, undefined)\n    data.cpg = currLocation\n\n    data[CAMP_COOKIE_NAME] = getCampaignObjForLc()\n    let pageLoadUrl = this.#account.dataPostURL\n    this.#request.addFlags(data)\n    // send dsync flag when page = 1\n    if (parseInt(data.pg) === 1) {\n      this.#overrideDSyncFlag(data)\n    }\n    data.af = { lib: 'web-sdk-v$$PACKAGE_VERSION$$' }\n    pageLoadUrl = addToURL(pageLoadUrl, 'type', 'page')\n    pageLoadUrl = addToURL(pageLoadUrl, 'd', compressData(JSON.stringify(data), this.#logger))\n\n    this.#request.saveAndFireRequest(pageLoadUrl, false)\n\n    this.#previousUrl = currLocation\n    setTimeout(() => {\n      if (pgCount <= 3) {\n        // send ping for up to 3 pages\n        this.#pingRequest()\n      }\n\n      if (this.#isPingContinuous()) {\n        setInterval(() => {\n          this.#pingRequest()\n        }, CONTINUOUS_PING_FREQ_IN_MILLIS)\n      }\n    }, FIRST_PING_FREQ_IN_MILLIS)\n  }\n\n  #pingRequest () {\n    let pageLoadUrl = this.#account.dataPostURL\n    let data = {}\n    data = this.#request.addSystemDataToObject(data, undefined)\n    pageLoadUrl = addToURL(pageLoadUrl, 'type', EVT_PING)\n    pageLoadUrl = addToURL(pageLoadUrl, 'd', compressData(JSON.stringify(data), this.#logger))\n\n    this.#request.saveAndFireRequest(pageLoadUrl, false)\n  }\n\n  #isPingContinuous () {\n    return (typeof window.wzrk_d !== 'undefined' && window.wzrk_d.ping === 'continuous')\n  }\n\n  _isPersonalisationActive () {\n    return StorageManager._isLocalStorageSupported() && this.enablePersonalization\n  }\n\n  #overrideDSyncFlag (data) {\n    if (this._isPersonalisationActive()) {\n      data.dsync = true\n    }\n  }\n}\n","import Clevertap from './clevertap'\n\nconst clevertap = new Clevertap(window.clevertap)\n\nwindow.clevertap = window.wizrocket = clevertap\n\nexport default clevertap\n"]},"metadata":{},"sourceType":"script"}